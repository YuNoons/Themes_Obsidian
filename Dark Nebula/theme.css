/* ==========================================================================
   Расширенная цветовая система Dark Nebula
   Версия: 2.1.1
   ========================================================================== */

:root {
  /* ==================== СИСТЕМА ЦВЕТОВЫХ ПРОСТРАНСТВ ==================== */
  --color-space-primary: oklch;
  --color-space-fallback: hsl;
  
  /* ==================== БАЗОВЫЕ ЦВЕТА ФОНА ==================== */
  --background-primary: oklch(15% 0.02 280) !important;
  --background-primary-alt: oklch(12% 0.02 280) !important;
  --background-secondary: oklch(18% 0.03 280) !important;
  --background-secondary-alt: oklch(14% 0.02 280) !important;
  
  /* ==================== ДИНАМИЧЕСКИЕ ЦВЕТОВЫЕ СХЕМЫ ==================== */
  
  /* Системные переменные для динамического управления */
  --accent-hue-primary: 280;
  --accent-hue-secondary: 190;
  --accent-hue-tertiary: 335;
  --accent-saturation: 85%;
  --accent-lightness: 65%;
  
  /* Автоматическая генерация акцентных цветов */
  --accent-primary: oklch(
    var(--accent-lightness) 
    var(--accent-saturation) 
    var(--accent-hue-primary)
  ) !important;
  
  --accent-secondary: oklch(
    calc(var(--accent-lightness) + 10%)
    calc(var(--accent-saturation) - 10%)
    var(--accent-hue-secondary)
  ) !important;
  
  --accent-tertiary: oklch(
    calc(var(--accent-lightness) + 5%)
    calc(var(--accent-saturation) - 15%)
    var(--accent-hue-tertiary)
  ) !important;
}

/* ==================== ЦВЕТОВЫЕ СХЕМЫ ==================== */

/* Основная схема (фиолетовые тона) */
[data-color-scheme="default"] {
  --accent-hue-primary: 280;
  --accent-hue-secondary: 190;
  --accent-hue-tertiary: 335;
}

/* Теплая схема */
[data-color-scheme="warm"] {
  --accent-hue-primary: 25;
  --accent-hue-secondary: 45;
  --accent-hue-tertiary: 350;
}

/* Холодная схема */
[data-color-scheme="cool"] {
  --accent-hue-primary: 200;
  --accent-hue-secondary: 160;
  --accent-hue-tertiary: 280;
}

/* Монохромная схема */
[data-color-scheme="monochrome"] {
  --accent-saturation: 5%;
  --accent-hue-primary: 280;
  --accent-hue-secondary: 280;
  --accent-hue-tertiary: 280;
}

/* ==================== СИСТЕМА ПОЛУТОНОВ ==================== */

:root {
  /* Полутона основного акцентного цвета */
  --accent-primary-10: oklch(10% var(--accent-saturation) var(--accent-hue-primary));
  --accent-primary-20: oklch(20% var(--accent-saturation) var(--accent-hue-primary));
  --accent-primary-40: oklch(40% var(--accent-saturation) var(--accent-hue-primary));
  --accent-primary-60: oklch(60% var(--accent-saturation) var(--accent-hue-primary));
  --accent-primary-80: oklch(80% var(--accent-saturation) var(--accent-hue-primary));
  
  /* Адаптивные цвета текста */
  --text-normal: oklch(95% 0.02 var(--accent-hue-primary));
  --text-muted: oklch(75% 0.03 var(--accent-hue-primary));
  --text-faint: oklch(55% 0.03 var(--accent-hue-primary));
}

/* ==================== СИСТЕМА ГРАДИЕНТОВ ==================== */

:root {
  --gradient-primary: linear-gradient(
    135deg,
    var(--accent-primary),
    var(--accent-secondary),
    var(--accent-tertiary)
  );
  
  --gradient-background: linear-gradient(
    135deg,
    var(--background-primary),
    var(--background-primary-alt),
    var(--background-secondary)
  );
}

/* ==================== ОБРАБОТКА ОШИБОК И FALLBACKS ==================== */

@supports not (color: oklch(0% 0 0)) {
  :root {
    /* Fallback для браузеров без поддержки OKLCH */
    --background-primary: hsl(280, 50%, 10%);
    --background-primary-alt: hsl(280, 50%, 8%);
    --accent-primary: hsl(280, 85%, 65%);
    --accent-secondary: hsl(190, 75%, 75%);
    --accent-tertiary: hsl(335, 70%, 70%);
  }
}

/* ==================== ПЛАВНЫЕ ПЕРЕХОДЫ ==================== */

:root {
  transition: --accent-hue-primary 0.6s cubic-bezier(0.4, 0, 0.2, 1),
              --accent-hue-secondary 0.6s cubic-bezier(0.4, 0, 0.2, 1),
              --accent-hue-tertiary 0.6s cubic-bezier(0.4, 0, 0.2, 1),
              --accent-saturation 0.4s ease-in-out;
}

/* ==========================================================================
   Конец расширенной цветовой системы
   ========================================================================== */
   
   /* ==========================================================================
   Семантическая цветовая система и система статусов
   Версия: 2.1.1
   ========================================================================== */

:root {
  /* ==================== СЕМАНТИЧЕСКИЕ БАЗОВЫЕ ЦВЕТА ==================== */
  
  /* Успех - основан на доступных зеленых тонах */
  --semantic-success-hue: 140;
  --semantic-success-base: oklch(75% 0.2 var(--semantic-success-hue));
  
  /* Предупреждение - доступные желто-оранжевые тона */
  --semantic-warning-hue: 75;
  --semantic-warning-base: oklch(80% 0.18 var(--semantic-warning-hue));
  
  /* Ошибка - доступные красные тона */
  --semantic-error-hue: 25;
  --semantic-error-base: oklch(75% 0.2 var(--semantic-error-hue));
  
  /* Информация - доступные синие тона */
  --semantic-info-hue: 230;
  --semantic-info-base: oklch(85% 0.15 var(--semantic-info-hue));
  
  /* ==================== СЕМАНТИЧЕСКИЕ ЦВЕТА ДЛЯ ИНТЕРФЕЙСА ==================== */
  
  /* Основные семантические цвета */
  --semantic-success: color-mix(
    in oklch, 
    var(--semantic-success-base), 
    var(--text-normal) 10%
  ) !important;
  
  --semantic-warning: color-mix(
    in oklch, 
    var(--semantic-warning-base), 
    var(--text-normal) 10%
  ) !important;
  
  --semantic-error: color-mix(
    in oklch, 
    var(--semantic-error-base), 
    var(--text-normal) 10%
  ) !important;
  
  --semantic-info: color-mix(
    in oklch, 
    var(--semantic-info-base), 
    var(--text-normal) 15%
  ) !important;
  
  /* Фоновые семантические цвета */
  --semantic-success-bg: color-mix(
    in oklch, 
    var(--semantic-success-base), 
    transparent 92%
  ) !important;
  
  --semantic-warning-bg: color-mix(
    in oklch, 
    var(--semantic-warning-base), 
    transparent 92%
  ) !important;
  
  --semantic-error-bg: color-mix(
    in oklch, 
    var(--semantic-error-base), 
    transparent 92%
  ) !important;
  
  --semantic-info-bg: color-mix(
    in oklch, 
    var(--semantic-info-base), 
    transparent 92%
  ) !important;
  
  /* Граничные семантические цвета */
  --semantic-success-border: color-mix(
    in oklch, 
    var(--semantic-success-base), 
    transparent 70%
  ) !important;
  
  --semantic-warning-border: color-mix(
    in oklch, 
    var(--semantic-warning-base), 
    transparent 70%
  ) !important;
  
  --semantic-error-border: color-mix(
    in oklch, 
    var(--semantic-error-base), 
    transparent 70%
  ) !important;
  
  --semantic-info-border: color-mix(
    in oklch, 
    var(--semantic-info-base), 
    transparent 70%
  ) !important;
}

/* ==================== СИСТЕМА СОСТОЯНИЙ ЭЛЕМЕНТОВ ==================== */

:root {
  /* Состояния интерактивных элементов */
  --state-hover: color-mix(
    in oklch, 
    var(--accent-primary), 
    transparent 85%
  ) !important;
  
  --state-active: color-mix(
    in oklch, 
    var(--accent-primary), 
    transparent 70%
  ) !important;
  
  --state-focus: color-mix(
    in oklch, 
    var(--accent-primary), 
    transparent 90%
  ) !important;
  
  --state-selected: color-mix(
    in oklch, 
    var(--accent-primary), 
    transparent 80%
  ) !important;
  
  --state-disabled: color-mix(
    in oklch, 
    var(--text-normal), 
    transparent 70%
  ) !important;
  
  --state-disabled-bg: color-mix(
    in oklch, 
    var(--background-primary), 
    transparent 50%
  ) !important;
}

/* ==================== СИСТЕМА ПРИОРИТЕТОВ И СТАТУСОВ ==================== */

:root {
  /* Приоритеты для задач и уведомлений */
  --priority-critical: var(--semantic-error);
  --priority-high: color-mix(in oklch, var(--semantic-error), var(--semantic-warning) 40%);
  --priority-medium: var(--semantic-warning);
  --priority-low: var(--semantic-info);
  --priority-completed: var(--semantic-success);
  
  /* Статусы элементов */
  --status-new: var(--semantic-info);
  --status-in-progress: var(--semantic-warning);
  --status-pending: color-mix(in oklch, var(--semantic-warning), transparent 30%);
  --status-completed: var(--semantic-success);
  --status-cancelled: var(--semantic-error);
  --status-archived: color-mix(in oklch, var(--text-muted), transparent 50%);
}

/* ==================== СИСТЕМА ДОСТУПНОСТИ ЦВЕТОВ ==================== */

/* Проверка контрастности для семантических цветов */
@media (prefers-contrast: high) {
  :root {
    --semantic-success: oklch(70% 0.25 var(--semantic-success-hue));
    --semantic-warning: oklch(75% 0.25 var(--semantic-warning-hue));
    --semantic-error: oklch(70% 0.25 var(--semantic-error-hue));
    --semantic-info: oklch(80% 0.2 var(--semantic-info-hue));
  }
}

/* Улучшение для дальтонизма */
[data-color-blindness="protanopia"] {
  --semantic-success-hue: 160;
  --semantic-error-hue: 30;
}

[data-color-blindness="deuteranopia"] {
  --semantic-success-hue: 180;
  --semantic-error-hue: 20;
}

/* ==================== СИСТЕМА ТИПОВ КОНТЕНТА ==================== */

:root {
  /* Цвета для разных типов заметок */
  --content-type-note: var(--accent-primary);
  --content-type-research: var(--accent-secondary);
  --content-type-project: var(--accent-tertiary);
  --content-type-reference: var(--semantic-info);
  --content-type-archive: var(--text-muted);
  --content-type-temporary: color-mix(in oklch, var(--semantic-warning), transparent 40%);
  
  /* Цвета для тегов и категорий */
  --tag-color-default: var(--accent-primary);
  --tag-color-important: var(--semantic-error);
  --tag-color-urgent: var(--priority-critical);
  --tag-color-in-progress: var(--semantic-warning);
  --tag-color-completed: var(--semantic-success);
  --tag-color-idea: var(--semantic-info);
  --tag-color-question: color-mix(in oklch, var(--semantic-info), var(--accent-secondary) 50%);
  --tag-color-bug: var(--semantic-error);
}

/* ==================== FALLBACK СИСТЕМА ==================== */

@supports not (color: color-mix(in oklch, red, transparent 50%)) {
  :root {
    /* Fallback для браузеров без color-mix */
    --semantic-success: hsl(140, 70%, 60%);
    --semantic-warning: hsl(75, 80%, 60%);
    --semantic-error: hsl(25, 85%, 60%);
    --semantic-info: hsl(230, 80%, 70%);
    
    --state-hover: hsla(280, 85%, 65%, 0.15);
    --state-active: hsla(280, 85%, 65%, 0.3);
    --state-focus: hsla(280, 85%, 65%, 0.1);
  }
}

/* ==================== УТИЛИТЫ ДЛЯ СЕМАНТИЧЕСКИХ ЦВЕТОВ ==================== */

/* Утилитарные классы для быстрого использования */
.semantic-success { color: var(--semantic-success) !important; }
.semantic-warning { color: var(--semantic-warning) !important; }
.semantic-error { color: var(--semantic-error) !important; }
.semantic-info { color: var(--semantic-info) !important; }

.bg-success { background-color: var(--semantic-success-bg) !important; }
.bg-warning { background-color: var(--semantic-warning-bg) !important; }
.bg-error { background-color: var(--semantic-error-bg) !important; }
.bg-info { background-color: var(--semantic-info-bg) !important; }

.border-success { border-color: var(--semantic-success-border) !important; }
.border-warning { border-color: var(--semantic-warning-border) !important; }
.border-error { border-color: var(--semantic-error-border) !important; }
.border-info { border-color: var(--semantic-info-border) !important; }

/* ==================== АНИМАЦИИ СТАТУСОВ ==================== */

@keyframes status-pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

.status-pulse {
  animation: status-pulse 2s ease-in-out infinite;
}

.status-critical {
  animation: status-pulse 1s ease-in-out infinite;
}

/* ==========================================================================
   Конец семантической цветовой системы
   ========================================================================== */
   
   /* ==========================================================================
   Система эффектов, градиентов и визуальных улучшений
   Версия: 2.1.1
   ========================================================================== */

:root {
  /* ==================== СИСТЕМА ГЛУБИНЫ И ТЕНЕЙ ==================== */
  
  /* Базовые тени с учетом цветовой схемы */
  --shadow-color: 0deg 0% 0%;
  --shadow-strength: 0.15;
  --shadow-elevation-1: 
    0.1px 0.5px 0.6px hsl(var(--shadow-color) / calc(var(--shadow-strength) + 0.02)),
    0.1px 0.8px 1px -1.2px hsl(var(--shadow-color) / calc(var(--shadow-strength) + 0.02)),
    0.3px 1.9px 2.3px -2.5px hsl(var(--shadow-color) / calc(var(--shadow-strength) + 0.02));
  
  --shadow-elevation-2: 
    0.1px 0.5px 0.6px hsl(var(--shadow-color) / calc(var(--shadow-strength) + 0.03)),
    0.3px 1.6px 2px -0.8px hsl(var(--shadow-color) / calc(var(--shadow-strength) + 0.03)),
    0.8px 4.1px 5.1px -1.7px hsl(var(--shadow-color) / calc(var(--shadow-strength) + 0.03)),
    2.1px 10.3px 12.8px -2.5px hsl(var(--shadow-color) / calc(var(--shadow-strength) + 0.03));
  
  --shadow-elevation-3: 
    0.1px 0.5px 0.6px hsl(var(--shadow-color) / calc(var(--shadow-strength) + 0.04)),
    0.6px 2.8px 3.5px -0.4px hsl(var(--shadow-color) / calc(var(--shadow-strength) + 0.04)),
    1.1px 5.1px 6.4px -0.7px hsl(var(--shadow-color) / calc(var(--shadow-strength) + 0.04)),
    1.9px 9.1px 11.4px -1.1px hsl(var(--shadow-color) / calc(var(--shadow-strength) + 0.04)),
    3.1px 15.1px 18.9px -1.4px hsl(var(--shadow-color) / calc(var(--shadow-strength) + 0.04)),
    5px 24.2px 30.3px -1.8px hsl(var(--shadow-color) / calc(var(--shadow-strength) + 0.04)),
    7.7px 37.5px 46.9px -2.1px hsl(var(--shadow-color) / calc(var(--shadow-strength) + 0.04)),
    11.6px 56.3px 70.4px -2.5px hsl(var(--shadow-color) / calc(var(--shadow-strength) + 0.04));
}

/* ==================== НЕОНОВЫЕ И СВЕТЯЩИЕСЯ ЭФФЕКТЫ ==================== */

:root {
  /* Динамические неоновые эффекты на основе акцентных цветов */
  --glow-intensity: 0.8;
  --glow-spread: 10px;
  --glow-blur: 15px;
  
  --neon-glow-primary: 
    0 0 calc(var(--glow-blur) * 0.3) color-mix(in oklch, var(--accent-primary), transparent 80%),
    0 0 calc(var(--glow-blur) * 0.6) color-mix(in oklch, var(--accent-primary), transparent 70%),
    0 0 var(--glow-blur) color-mix(in oklch, var(--accent-primary), transparent 60%),
    0 0 calc(var(--glow-blur) * 1.5) color-mix(in oklch, var(--accent-primary), transparent 50%);
  
  --neon-glow-secondary: 
    0 0 calc(var(--glow-blur) * 0.2) color-mix(in oklch, var(--accent-secondary), transparent 85%),
    0 0 calc(var(--glow-blur) * 0.4) color-mix(in oklch, var(--accent-secondary), transparent 75%),
    0 0 calc(var(--glow-blur) * 0.8) color-mix(in oklch, var(--accent-secondary), transparent 65%);
  
  --neon-glow-tertiary: 
    0 0 calc(var(--glow-blur) * 0.25) color-mix(in oklch, var(--accent-tertiary), transparent 82%),
    0 0 calc(var(--glow-blur) * 0.5) color-mix(in oklch, var(--accent-tertiary), transparent 72%),
    0 0 calc(var(--glow-blur) * 1) color-mix(in oklch, var(--accent-tertiary), transparent 62%);
  
  /* Интерактивные неоновые эффекты */
  --neon-glow-hover: 
    0 0 calc(var(--glow-blur) * 0.4) color-mix(in oklch, var(--accent-primary), transparent 70%),
    0 0 calc(var(--glow-blur) * 0.8) color-mix(in oklch, var(--accent-primary), transparent 60%),
    0 0 calc(var(--glow-blur) * 1.2) color-mix(in oklch, var(--accent-primary), transparent 50%);
  
  --neon-glow-active: 
    0 0 calc(var(--glow-blur) * 0.6) color-mix(in oklch, var(--accent-primary), transparent 60%),
    0 0 calc(var(--glow-blur) * 1.2) color-mix(in oklch, var(--accent-primary), transparent 50%),
    0 0 calc(var(--glow-blur) * 2) color-mix(in oklch, var(--accent-primary), transparent 40%);
}

/* ==================== СИСТЕМА ГРАДИЕНТОВ ==================== */

:root {
  /* Основные градиенты */
  --gradient-primary: linear-gradient(
    135deg,
    var(--accent-primary),
    color-mix(in oklch, var(--accent-primary), var(--accent-secondary) 30%),
    var(--accent-secondary),
    color-mix(in oklch, var(--accent-secondary), var(--accent-tertiary) 40%),
    var(--accent-tertiary)
  ) !important;
  
  --gradient-secondary: radial-gradient(
    circle at 50% 50%,
    color-mix(in oklch, var(--accent-primary), transparent 90%),
    color-mix(in oklch, var(--accent-secondary), transparent 95%),
    transparent 70%
  ) !important;
  
  --gradient-background: linear-gradient(
    135deg,
    var(--background-primary),
    color-mix(in oklch, var(--background-primary), var(--background-primary-alt) 50%),
    var(--background-primary-alt),
    color-mix(in oklch, var(--background-primary-alt), var(--background-secondary) 60%),
    var(--background-secondary)
  ) !important;
  
  --gradient-glass: linear-gradient(
    135deg,
    color-mix(in oklch, var(--background-primary), transparent 30%),
    color-mix(in oklch, var(--background-primary-alt), transparent 40%),
    color-mix(in oklch, var(--background-secondary), transparent 50%)
  ) !important;
  
  /* Градиенты для текста */
  --gradient-text-primary: linear-gradient(
    135deg,
    var(--accent-primary),
    var(--accent-secondary),
    var(--accent-tertiary)
  ) !important;
  
  --gradient-text-secondary: linear-gradient(
    135deg,
    var(--text-normal),
    var(--text-muted),
    var(--text-faint)
  ) !important;
}

/* ==================== СИСТЕМА BLUR И GLASSMORPHISM ==================== */

:root {
  /* Эффекты размытия */
  --backdrop-blur-xs: blur(4px);
  --backdrop-blur-sm: blur(8px);
  --backdrop-blur-md: blur(16px);
  --backdrop-blur-lg: blur(24px);
  --backdrop-blur-xl: blur(32px);
  
  /* Glassmorphism эффекты */
  --glass-background: color-mix(
    in oklch, 
    var(--background-primary), 
    transparent 15%
  ) !important;
  
  --glass-border: color-mix(
    in oklch, 
    var(--accent-primary), 
    transparent 85%
  ) !important;
  
  --glass-shadow: 
    0 8px 32px 0 color-mix(in oklch, var(--shadow-color), transparent 90%);
}

/* ==================== АДАПТИВНЫЕ ЭФФЕКТЫ ДЛЯ ПРОИЗВОДИТЕЛЬНОСТИ ==================== */

/* Отключение эффектов для слабых устройств */
@media (prefers-reduced-motion: reduce) {
  :root {
    --backdrop-blur-xs: blur(2px);
    --backdrop-blur-sm: blur(4px);
    --backdrop-blur-md: blur(8px);
    --backdrop-blur-lg: blur(12px);
    --backdrop-blur-xl: blur(16px);
  }
}

/* Упрощенные эффекты для высококонтрастного режима */
@media (prefers-contrast: high) {
  :root {
    --neon-glow-primary: none;
    --neon-glow-secondary: none;
    --neon-glow-tertiary: none;
    --glass-background: var(--background-primary);
    --backdrop-blur-xs: none;
    --backdrop-blur-sm: none;
    --backdrop-blur-md: none;
    --backdrop-blur-lg: none;
    --backdrop-blur-xl: none;
  }
}

/* ==================== СИСТЕМА АНИМАЦИЙ ЭФФЕКТОВ ==================== */

@keyframes glow-pulse {
  0%, 100% {
    box-shadow: var(--neon-glow-primary);
    opacity: 1;
  }
  50% {
    box-shadow: 
      0 0 calc(var(--glow-blur) * 0.2) color-mix(in oklch, var(--accent-primary), transparent 70%),
      0 0 calc(var(--glow-blur) * 0.4) color-mix(in oklch, var(--accent-primary), transparent 60%),
      0 0 calc(var(--glow-blur) * 0.6) color-mix(in oklch, var(--accent-primary), transparent 50%);
    opacity: 0.8;
  }
}

@keyframes gradient-shift {
  0% {
    background-position: 0% 50%;
  }
  50% {
    background-position: 100% 50%;
  }
  100% {
    background-position: 0% 50%;
  }
}

@keyframes float {
  0%, 100% {
    transform: translateY(0px);
  }
  50% {
    transform: translateY(-5px);
  }
}

/* ==================== FALLBACK СИСТЕМА ДЛЯ СТАРЫХ БРАУЗЕРОВ ==================== */

@supports not (backdrop-filter: blur(10px)) {
  .glass-effect {
    background: color-mix(in oklch, var(--background-primary), transparent 5%) !important;
  }
}

@supports not (color: color-mix(in oklch, red, blue 50%)) {
  :root {
    --gradient-primary: linear-gradient(135deg, #8B5CF6, #06B6D4, #EC4899);
    --gradient-background: linear-gradient(135deg, #1a0b1f, #160916, #250b0b);
  }
}

/* ==================== УТИЛИТЫ ДЛЯ ЭФФЕКТОВ ==================== */

/* Утилиты теней */
.shadow-elevation-1 { box-shadow: var(--shadow-elevation-1) !important; }
.shadow-elevation-2 { box-shadow: var(--shadow-elevation-2) !important; }
.shadow-elevation-3 { box-shadow: var(--shadow-elevation-3) !important; }

/* Утилиты неоновых эффектов */
.glow-primary { box-shadow: var(--neon-glow-primary) !important; }
.glow-secondary { box-shadow: var(--neon-glow-secondary) !important; }
.glow-tertiary { box-shadow: var(--neon-glow-tertiary) !important; }

.glow-hover:hover { box-shadow: var(--neon-glow-hover) !important; }
.glow-active:active { box-shadow: var(--neon-glow-active) !important; }

/* Утилиты градиентов */
.bg-gradient-primary { 
  background: var(--gradient-primary) !important;
  background-size: 200% 200% !important;
}

.bg-gradient-glass { 
  background: var(--gradient-glass) !important;
  backdrop-filter: var(--backdrop-blur-md) !important;
}

.text-gradient-primary {
  background: var(--gradient-text-primary) !important;
  background-clip: text !important;
  -webkit-background-clip: text !important;
  color: transparent !important;
}

/* Утилиты анимаций */
.animate-glow-pulse {
  animation: glow-pulse 2s ease-in-out infinite !important;
}

.animate-gradient-shift {
  animation: gradient-shift 3s ease infinite !important;
}

.animate-float {
  animation: float 3s ease-in-out infinite !important;
}

/* ==================== СИСТЕМА ПРОИЗВОДИТЕЛЬНОСТИ ЭФФЕКТОВ ==================== */

/* Оптимизация для GPU */
.gpu-accelerated {
  transform: translateZ(0);
  backface-visibility: hidden;
  perspective: 1000px;
}

/* Содержание для изоляции эффектов */
.effect-contained {
  contain: layout style paint;
}

/* ==================== КОНТРОЛЬ ПЕРЕПОЛНЕНИЯ ==================== */

/* Предотвращение артефактов размытия */
.glass-effect {
  isolation: isolate;
  position: relative;
  overflow: hidden;
}

.glass-effect::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: var(--glass-background);
  backdrop-filter: var(--backdrop-blur-md);
  z-index: -1;
  margin: -10px;
}

/* ==========================================================================
   Конец системы эффектов, градиентов и визуальных улучшений
   ========================================================================== */
   
   /* ==========================================================================
   Система адаптивных режимов и контекстных тем
   Версия: 2.1.1
   ========================================================================== */

:root {
  /* ==================== СИСТЕМА РЕЖИМОВ РАБОТЫ ==================== */
  
  /* Базовые переменные режимов */
  --mode-transition-duration: 0.4s;
  --mode-transition-timing: cubic-bezier(0.4, 0, 0.2, 1);
  
  /* Система z-index для режимов */
  --z-index-mode-overlay: 5000;
  --z-index-mode-backdrop: 4999;
}

/* ==================== РЕЖИМ ЧТЕНИЯ ==================== */

[data-mode="reading"] {
  /* Типографика для длительного чтения */
  --reading-font-size: 18px;
  --reading-line-height: 1.7;
  --reading-max-width: 700px;
  --reading-font-family: "Georgia", "Times New Roman", serif;
  
  /* Цвета для снижения нагрузки на глаза */
  --background-primary: oklch(98% 0.01 var(--accent-hue-primary)) !important;
  --background-primary-alt: oklch(96% 0.008 var(--accent-hue-primary)) !important;
  --text-normal: oklch(15% 0.02 var(--accent-hue-primary)) !important;
  --text-muted: oklch(35% 0.015 var(--accent-hue-primary)) !important;
  
  /* Упрощенная цветовая схема */
  --accent-primary: oklch(50% 0.1 var(--accent-hue-primary)) !important;
  --accent-secondary: oklch(45% 0.08 var(--accent-hue-secondary)) !important;
  --accent-tertiary: oklch(40% 0.06 var(--accent-hue-tertiary)) !important;
  
  /* Уменьшение визуального шума */
  --shadow-strength: 0.05;
  --backdrop-blur-md: none;
  --neon-glow-primary: none;
  --neon-glow-secondary: none;
}

/* Специфичные стили для режима чтения */
[data-mode="reading"] .markdown-preview-view,
[data-mode="reading"] .cm-editor {
  font-size: var(--reading-font-size) !important;
  line-height: var(--reading-line-height) !important;
  font-family: var(--reading-font-family) !important;
  max-width: var(--reading-max-width) !important;
  margin: 0 auto !important;
  padding: 2rem !important;
}

/* ==================== НОЧНОЙ РЕЖИМ ==================== */

[data-mode="night"] {
  /* Улучшенная цветовая палитра для ночи */
  --background-primary: oklch(8% 0.01 var(--accent-hue-primary)) !important;
  --background-primary-alt: oklch(6% 0.008 var(--accent-hue-primary)) !important;
  --background-secondary: oklch(10% 0.012 var(--accent-hue-primary)) !important;
  
  /* Снижение синего спектра */
  --accent-primary: oklch(65% 0.08 calc(var(--accent-hue-primary) - 10)) !important;
  --accent-secondary: oklch(70% 0.06 calc(var(--accent-hue-secondary) - 15)) !important;
  
  /* Уменьшение контрастности */
  --text-normal: oklch(85% 0.008 var(--accent-hue-primary)) !important;
  --text-muted: oklch(65% 0.01 var(--accent-hue-primary)) !important;
  
  /* Фильтры для снижения синего света */
  filter: sepia(0.1) hue-rotate(-5deg) brightness(0.95) !important;
}

/* Отключение фильтров для элементов, где они не нужны */
[data-mode="night"] img,
[data-mode="night"] video,
[data-mode="night"] canvas,
[data-mode="night"] .image-embed {
  filter: sepia(0) hue-rotate(0deg) brightness(1) !important;
}

/* ==================== РЕЖИМ ГЛУБОКОЙ ФОКУСИРОВКИ ==================== */

[data-mode="focus"] {
  /* Затемнение неактивных областей */
  --sidebar-opacity: 0.1;
  --header-opacity: 0.15;
  --status-bar-opacity: 0.1;
  
  /* Усиление активной области */
  --active-area-brightness: 1.05;
  --active-area-contrast: 1.1;
}

[data-mode="focus"] .workspace-tabs:not(.mod-active),
[data-mode="focus"] .status-bar,
[data-mode="focus"] .view-header:not(:hover) {
  opacity: var(--sidebar-opacity) !important;
  transition: opacity 0.6s var(--mode-transition-timing) !important;
}

[data-mode="focus"] .workspace-leaf.mod-active {
  filter: brightness(var(--active-area-brightness)) contrast(var(--active-area-contrast)) !important;
}

[data-mode="focus"] .workspace-tabs:hover,
[data-mode="focus"] .status-bar:hover,
[data-mode="focus"] .view-header:hover {
  opacity: 1 !important;
}

/* ==================== РЕЖИМ ПРЕЗЕНТАЦИИ ==================== */

[data-mode="presentation"] {
  /* Полноэкранный режим */
  --background-primary: #000000 !important;
  --background-primary-alt: #111111 !important;
  --text-normal: #ffffff !important;
  --text-muted: #cccccc !important;
  
  /* Упрощенная цветовая схема */
  --accent-primary: #ffffff !important;
  --accent-secondary: #cccccc !important;
  --accent-tertiary: #999999 !important;
  
  /* Скрытие интерфейса */
  --sidebar-opacity: 0;
  --header-opacity: 0;
  --status-bar-opacity: 0;
}

[data-mode="presentation"] .workspace-tabs,
[data-mode="presentation"] .status-bar,
[data-mode="presentation"] .view-header {
  opacity: 0 !important;
  pointer-events: none !important;
}

[data-mode="presentation"] .markdown-preview-view {
  text-align: center !important;
  display: flex !important;
  flex-direction: column !important;
  justify-content: center !important;
  align-items: center !important;
  min-height: 100vh !important;
  padding: 2rem !important;
  font-size: 2rem !important;
  line-height: 1.4 !important;
}

/* ==================== РЕЖИМ ВЫСОКОЙ КОНТРАСТНОСТИ ==================== */

[data-mode="high-contrast"] {
  /* Максимальная контрастность */
  --background-primary: #000000 !important;
  --background-primary-alt: #111111 !important;
  --background-secondary: #222222 !important;
  
  --text-normal: #ffffff !important;
  --text-muted: #e0e0e0 !important;
  --text-faint: #c0c0c0 !important;
  
  --accent-primary: #ffff00 !important;
  --accent-secondary: #00ffff !important;
  --accent-tertiary: #ff00ff !important;
  
  /* Усиление границ */
  --border-width: 2px;
  --shadow-strength: 0.8;
  
  /* Отключение сложных эффектов */
  --backdrop-blur-md: none;
  --neon-glow-primary: 0 0 0 2px var(--accent-primary);
  --neon-glow-secondary: 0 0 0 1px var(--accent-secondary);
}

/* ==================== КОНТЕКСТНЫЕ ТЕМЫ ==================== */

/* Тема для программирования */
[data-context="coding"] {
  --accent-primary: var(--semantic-info) !important;
  --accent-secondary: color-mix(in oklch, var(--semantic-info), var(--accent-primary) 60%) !important;
  --background-primary: oklch(12% 0.015 var(--semantic-info-hue)) !important;
}

/* Тема для написания текстов */
[data-context="writing"] {
  --accent-primary: var(--accent-tertiary) !important;
  --background-primary: oklch(13% 0.012 var(--accent-hue-tertiary)) !important;
  --reading-font-family: "Georgia", "Times New Roman", serif;
}

/* Тема для исследований */
[data-context="research"] {
  --accent-primary: var(--accent-secondary) !important;
  --background-primary: oklch(14% 0.018 var(--accent-hue-secondary)) !important;
}

/* Тема для планирования */
[data-context="planning"] {
  --accent-primary: var(--semantic-warning) !important;
  --background-primary: oklch(13% 0.016 var(--semantic-warning-hue)) !important;
}

/* ==================== СИСТЕМА АДАПТАЦИИ К СИСТЕМНЫМ НАСТРОЙКАМ ==================== */

/* Автоматическое определение системных предпочтений */
@media (prefers-color-scheme: light) {
  :root:not([data-mode]) {
    --background-primary: oklch(95% 0.02 var(--accent-hue-primary)) !important;
    --background-primary-alt: oklch(92% 0.015 var(--accent-hue-primary)) !important;
    --text-normal: oklch(15% 0.05 var(--accent-hue-primary)) !important;
    --text-muted: oklch(35% 0.03 var(--accent-hue-primary)) !important;
  }
}

@media (prefers-contrast: more) {
  :root:not([data-mode="high-contrast"]) {
    --shadow-strength: 0.3;
    --border-width: 1.5px;
  }
}

@media (prefers-contrast: less) {
  :root {
    --shadow-strength: 0.05;
    --border-width: 0.5px;
  }
}

@media (prefers-reduced-motion: reduce) {
  :root {
    --mode-transition-duration: 0.1s;
  }
  
  [data-mode] {
    transition: none !important;
  }
}

/* ==================== СИСТЕМА ПЛАВНЫХ ПЕРЕХОДОВ ==================== */

/* Базовые переходы для режимов */
.workspace-leaf,
.view-content,
.markdown-preview-view,
.cm-editor {
  transition: 
    background-color var(--mode-transition-duration) var(--mode-transition-timing),
    color var(--mode-transition-duration) var(--mode-transition-timing),
    border-color var(--mode-transition-duration) var(--mode-transition-timing),
    opacity var(--mode-transition-duration) var(--mode-transition-timing) !important;
}

/* Предотвращение мерцания при переходах */
.mode-transitioning {
  pointer-events: none !important;
}

/* ==================== СИСТЕМА КОНТРОЛЯ ПРОИЗВОДИТЕЛЬНОСТИ ==================== */

/* Упрощение эффектов для слабых устройств */
@media (max-width: 768px) {
  [data-mode] {
    --backdrop-blur-md: none;
    --neon-glow-primary: none;
    --neon-glow-secondary: none;
  }
}

/* Отключение сложных переходов для больших документов */
.cm-editor:has(.cm-line:nth-child(1000)) {
  transition: none !important;
}

/* ==================== FALLBACK СИСТЕМА ==================== */

/* Резервные стили для старых браузеров */
@supports not (selector([data-mode])) {
  .reading-mode {
    background: #f8f9fa !important;
    color: #2c3e50 !important;
    font-family: "Georgia", serif !important;
  }
  
  .night-mode {
    background: #1a1a1a !important;
    color: #e0e0e0 !important;
    filter: brightness(0.9) !important;
  }
}

/* ==================== УТИЛИТЫ ДЛЯ РЕЖИМОВ ==================== */

/* Утилиты быстрого переключения */
.mode-reading { background: oklch(98% 0.01 280) !important; color: oklch(15% 0.02 280) !important; }
.mode-night { background: #000000 !important; color: #ffffff !important; }
.mode-focus { opacity: 0.1 !important; }
.mode-focus:hover { opacity: 1 !important; }

/* Индикаторы активного режима */
[data-mode]::before {
  content: attr(data-mode);
  position: fixed;
  top: 10px;
  right: 10px;
  background: var(--accent-primary);
  color: var(--background-primary);
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 0.7rem;
  font-weight: bold;
  z-index: var(--z-index-mode-overlay);
  opacity: 0.8;
}

/* ==================== СИСТЕМА БЕЗОПАСНОСТИ И ДОСТУПНОСТИ ==================== */

/* Гарантированная читаемость в любом режиме */
[data-mode] .markdown-preview-view h1,
[data-mode] .markdown-preview-view h2,
[data-mode] .markdown-preview-view h3,
[data-mode] .markdown-preview-view strong {
  color: var(--text-normal) !important;
  font-weight: 600 !important;
}

/* Сохранение доступности интерактивных элементов */
[data-mode] button,
[data-mode] a,
[data-mode] [role="button"] {
  cursor: pointer !important;
}

[data-mode] [aria-disabled="true"],
[data-mode] [disabled] {
  opacity: 0.5 !important;
  cursor: not-allowed !important;
}

/* ==========================================================================
   Конец системы адаптивных режимов и контекстных тем
   ========================================================================== */
   
   /* ==========================================================================
   Система типографики и адаптивных макетов
   Версия: 2.1.1
   ========================================================================== */

:root {
  /* ==================== СИСТЕМА ТИПОГРАФИКИ ==================== */
  
  /* Шрифтовые стеки с учетом доступности и поддержки */
  --font-family-sans: 
    "Inter", 
    "SF Pro Text", 
    -apple-system, 
    "Segoe UI", 
    "Roboto", 
    system-ui, 
    sans-serif !important;
  
  --font-family-serif: 
    "Georgia", 
    "Times New Roman", 
    "Times", 
    serif !important;
  
  --font-family-mono: 
    "JetBrains Mono", 
    "Fira Code", 
    "Cascadia Code", 
    "Consolas", 
    "Monaco", 
    "Courier New", 
    monospace !important;
  
  /* Адаптивная шкала размеров шрифта */
  --font-scale-ratio: 1.2;
  --font-size-xs: clamp(0.75rem, 0.7rem + 0.25vw, 0.875rem);
  --font-size-sm: clamp(0.875rem, 0.8rem + 0.375vw, 1rem);
  --font-size-base: clamp(1rem, 0.9rem + 0.5vw, 1.125rem);
  --font-size-lg: clamp(1.125rem, 1rem + 0.625vw, 1.25rem);
  --font-size-xl: clamp(1.25rem, 1.1rem + 0.75vw, 1.5rem);
  --font-size-2xl: clamp(1.5rem, 1.3rem + 1vw, 1.875rem);
  --font-size-3xl: clamp(1.875rem, 1.6rem + 1.375vw, 2.25rem);
  --font-size-4xl: clamp(2.25rem, 1.9rem + 1.75vw, 2.5rem);
  
  /* Адаптивные межстрочные интервалы */
  --line-height-tight: 1.25;
  --line-height-normal: 1.5;
  --line-height-relaxed: 1.75;
  --line-height-loose: 2;
  
  /* Система начертаний */
  --font-weight-light: 300;
  --font-weight-normal: 400;
  --font-weight-medium: 500;
  --font-weight-semibold: 600;
  --font-weight-bold: 700;
  --font-weight-extrabold: 800;
  
  /* Система межбуквенных интервалов */
  --letter-spacing-tight: -0.025em;
  --letter-spacing-normal: 0;
  --letter-spacing-wide: 0.025em;
  --letter-spacing-wider: 0.05em;
}

/* ==================== БАЗОВЫЕ СТИЛИ ТИПОГРАФИКИ ==================== */

.cm-editor,
.markdown-preview-view {
  /* Научно обоснованная типографика */
  font-family: var(--font-family-sans);
  font-size: var(--font-size-base);
  line-height: var(--line-height-relaxed);
  font-weight: var(--font-weight-normal);
  letter-spacing: var(--letter-spacing-normal);
  
  /* Оптимальная читаемость */
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  font-feature-settings: "kern" 1, "liga" 1, "calt" 1;
  
  /* Контроль переносов */
  hyphenate-limit-chars: 6 3 3;
  hyphenate-limit-lines: 2;
  hyphenate-limit-zone: 8%;
  text-wrap: pretty;
}

/* ==================== СИСТЕМА ЗАГОЛОВКОВ ==================== */

.cm-header-1,
.markdown-preview-view h1 {
  font-size: var(--font-size-3xl);
  font-weight: var(--font-weight-bold);
  line-height: var(--line-height-tight);
  letter-spacing: var(--letter-spacing-tight);
  margin: 2.5rem 0 1rem 0;
  color: var(--accent-primary);
  position: relative;
  scroll-margin-top: 2rem;
}

.cm-header-2,
.markdown-preview-view h2 {
  font-size: var(--font-size-2xl);
  font-weight: var(--font-weight-semibold);
  line-height: var(--line-height-tight);
  margin: 2rem 0 0.875rem 0;
  color: var(--accent-secondary);
  border-bottom: 1px solid color-mix(in oklch, var(--accent-secondary), transparent 80%);
  padding-bottom: 0.5rem;
}

.cm-header-3,
.markdown-preview-view h3 {
  font-size: var(--font-size-xl);
  font-weight: var(--font-weight-semibold);
  line-height: var(--line-height-normal);
  margin: 1.5rem 0 0.75rem 0;
  color: var(--accent-tertiary);
}

.cm-header-4,
.markdown-preview-view h4 {
  font-size: var(--font-size-lg);
  font-weight: var(--font-weight-medium);
  margin: 1.25rem 0 0.625rem 0;
  color: var(--text-normal);
}

.cm-header-5,
.markdown-preview-view h5 {
  font-size: var(--font-size-base);
  font-weight: var(--font-weight-medium);
  margin: 1rem 0 0.5rem 0;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: var(--letter-spacing-wide);
}

.cm-header-6,
.markdown-preview-view h6 {
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-medium);
  margin: 0.875rem 0 0.5rem 0;
  color: var(--text-faint);
  font-style: italic;
}

/* ==================== СИСТЕМА МАКЕТОВ И СЕТОК ==================== */

:root {
  /* Адаптивная система отступов */
  --space-scale: 0.25rem;
  --space-1: calc(var(--space-scale) * 1);  /* 4px */
  --space-2: calc(var(--space-scale) * 2);  /* 8px */
  --space-3: calc(var(--space-scale) * 3);  /* 12px */
  --space-4: calc(var(--space-scale) * 4);  /* 16px */
  --space-6: calc(var(--space-scale) * 6);  /* 24px */
  --space-8: calc(var(--space-scale) * 8);  /* 32px */
  --space-12: calc(var(--space-scale) * 12); /* 48px */
  --space-16: calc(var(--space-scale) * 16); /* 64px */
  
  /* Система скруглений */
  --radius-scale: 0.25rem;
  --radius-sm: calc(var(--radius-scale) * 1);  /* 4px */
  --radius-md: calc(var(--radius-scale) * 2);  /* 8px */
  --radius-lg: calc(var(--radius-scale) * 3);  /* 12px */
  --radius-xl: calc(var(--radius-scale) * 4);  /* 16px */
  --radius-2xl: calc(var(--radius-scale) * 6); /* 24px */
  
  /* Максимальные ширины контента */
  --content-max-width: min(100%, 800px);
  --content-wide-max-width: min(100%, 1200px);
  --content-narrow-max-width: min(100%, 600px);
}

/* ==================== АДАПТИВНАЯ СТРУКТУРА КОНТЕНТА ==================== */

.cm-content,
.markdown-preview-section {
  /* CSS Grid для современной структуры документа */
  display: grid !important;
  grid-template-columns: 
    [full-start] minmax(var(--space-4), 1fr)
    [content-start] min(var(--content-max-width), 100%)
    [content-end] minmax(var(--space-4), 1fr)
    [full-end] !important;
  gap: var(--space-6) 0;
}

.cm-line,
.markdown-preview-view > * {
  grid-column: content !important;
}

/* Широкие элементы (код, таблицы, изображения) */
.cm-codeBlock,
.markdown-preview-view pre,
.markdown-preview-view table,
.markdown-preview-view .image-embed {
  grid-column: full !important;
  width: 100% !important;
}

/* Узкие элементы (цитаты, заметки) */
.markdown-preview-view blockquote,
.markdown-preview-view .callout {
  grid-column: content !important;
  margin-left: var(--space-6) !important;
  margin-right: var(--space-6) !important;
}

/* ==================== СИСТЕМА ОТСТУПОВ И ВЫРАВНИВАНИЯ ==================== */

/* Единая система отступов для всех элементов */
.cm-editor .cm-line,
.markdown-preview-view > * {
  margin: 0 !important;
  padding: var(--space-2) 0 !important;
}

/* Специфичные отступы для разных элементов */
.cm-paragraph,
.markdown-preview-view p {
  margin: var(--space-4) 0 !important;
  padding: 0 !important;
}

.cm-list,
.markdown-preview-view ul,
.markdown-preview-view ol {
  margin: var(--space-4) 0 !important;
  padding-left: var(--space-8) !important;
}

.cm-listItem,
.markdown-preview-view li {
  margin: var(--space-2) 0 !important;
  padding: var(--space-1) 0 !important;
}

/* ==================== СИСТЕМА КОДА И ПРЕДФОРМАТИРОВАННОГО ТЕКСТА ==================== */

.cm-codeBlock,
.markdown-preview-view pre {
  font-family: var(--font-family-mono) !important;
  font-size: var(--font-size-sm) !important;
  line-height: var(--line-height-normal) !important;
  background: color-mix(in oklch, var(--background-primary), black 8%) !important;
  border: 1px solid color-mix(in oklch, var(--accent-primary), transparent 90%) !important;
  border-radius: var(--radius-lg) !important;
  padding: var(--space-6) !important;
  margin: var(--space-6) 0 !important;
  overflow-x: auto !important;
}

.cm-inlineCode,
.markdown-preview-view code:not(pre code) {
  font-family: var(--font-family-mono) !important;
  font-size: 0.9em !important;
  background: color-mix(in oklch, var(--accent-primary), transparent 95%) !important;
  border: 1px solid color-mix(in oklch, var(--accent-primary), transparent 85%) !important;
  border-radius: var(--radius-sm) !important;
  padding: 0.125em 0.375em !important;
  color: var(--accent-primary) !important;
}

/* ==================== СИСТЕМА ТАБЛИЦ ==================== */

.markdown-preview-view table {
  font-size: var(--font-size-sm) !important;
  line-height: var(--line-height-normal) !important;
  border-collapse: collapse !important;
  border-radius: var(--radius-md) !important;
  overflow: hidden !important;
  box-shadow: var(--shadow-elevation-1) !important;
}

.markdown-preview-view th {
  background: color-mix(in oklch, var(--accent-primary), transparent 95%) !important;
  color: var(--accent-primary) !important;
  font-weight: var(--font-weight-semibold) !important;
  text-align: left !important;
  padding: var(--space-3) var(--space-4) !important;
  border-bottom: 2px solid color-mix(in oklch, var(--accent-primary), transparent 80%) !important;
}

.markdown-preview-view td {
  padding: var(--space-3) var(--space-4) !important;
  border-bottom: 1px solid color-mix(in oklch, var(--accent-primary), transparent 92%) !important;
}

.markdown-preview-view tr:nth-child(even) {
  background: color-mix(in oklch, var(--background-primary), transparent 30%) !important;
}

/* ==================== АДАПТИВНОСТЬ ДЛЯ РАЗНЫХ УСТРОЙСТВ ==================== */

/* Мобильные устройства */
@media (max-width: 768px) {
  :root {
    --content-max-width: min(100%, calc(100vw - var(--space-8)));
    --font-size-base: clamp(1rem, 0.95rem + 0.25vw, 1.125rem);
  }
  
  .cm-content,
  .markdown-preview-section {
    grid-template-columns: 
      [full-start] minmax(var(--space-2), 1fr)
      [content-start] min(var(--content-max-width), 100%)
      [content-end] minmax(var(--space-2), 1fr)
      [full-end] !important;
  }
  
  .cm-header-1,
  .markdown-preview-view h1 {
    font-size: var(--font-size-2xl);
    margin: 2rem 0 0.875rem 0;
  }
  
  .markdown-preview-view table {
    display: block !important;
    overflow-x: auto !important;
    font-size: var(--font-size-xs) !important;
  }
}

/* Планшеты */
@media (min-width: 769px) and (max-width: 1024px) {
  :root {
    --content-max-width: min(100%, 700px);
  }
}

/* ==================== СИСТЕМА ДОСТУПНОСТИ ТИПОГРАФИКИ ==================== */

/* Улучшение для слабовидящих */
@media (prefers-contrast: high) {
  .cm-editor,
  .markdown-preview-view {
    font-weight: var(--font-weight-medium) !important;
    letter-spacing: var(--letter-spacing-wide) !important;
  }
}

/* Упрощение для когнитивной доступности */
[data-cognitive-simple="true"] .cm-editor,
[data-cognitive-simple="true"] .markdown-preview-view {
  font-size: var(--font-size-lg) !important;
  line-height: var(--line-height-loose) !important;
  letter-spacing: var(--letter-spacing-wide) !important;
}

/* Поддержка Dyslexia */
[data-dyslexia-friendly="true"] .cm-editor,
[data-dyslexia-friendly="true"] .markdown-preview-view {
  font-family: "OpenDyslexic", "Comic Sans MS", var(--font-family-sans) !important;
  line-height: var(--line-height-loose) !important;
  letter-spacing: var(--letter-spacing-wider) !important;
  word-spacing: 0.16em !important;
}

/* ==================== СИСТЕМА ПРОИЗВОДИТЕЛЬНОСТИ ==================== */

/* Оптимизация рендеринга для больших документов */
.cm-editor .cm-line {
  content-visibility: auto !important;
  contain-intrinsic-size: 1px 1.7em !important;
}

.markdown-preview-view > * {
  content-visibility: auto !important;
  contain-intrinsic-size: 1px 4em !important;
}

/* Отключение сложных эффектов для длинных документов */
.cm-editor:has(.cm-line:nth-child(500)) {
  text-rendering: optimizeSpeed !important;
  -webkit-font-smoothing: subpixel-antialiased !important;
}

/* ==================== FALLBACK СИСТЕМА ==================== */

/* Резервные стили для старых браузеров */
@supports not (clamp(1rem, 1vw, 2rem)) {
  .cm-editor,
  .markdown-preview-view {
    font-size: 16px !important;
  }
  
  .cm-header-1,
  .markdown-preview-view h1 {
    font-size: 2rem !important;
  }
}

@supports not (display: grid) {
  .cm-content,
  .markdown-preview-section {
    display: block !important;
    max-width: var(--content-max-width) !important;
    margin: 0 auto !important;
  }
}

/* ==================== УТИЛИТЫ ТИПОГРАФИКИ И МАКЕТОВ ==================== */

/* Утилиты выравнивания текста */
.text-left { text-align: left !important; }
.text-center { text-align: center !important; }
.text-right { text-align: right !important; }
.text-justify { text-align: justify !important; }

/* Утилиты веса шрифта */
.font-light { font-weight: var(--font-weight-light) !important; }
.font-normal { font-weight: var(--font-weight-normal) !important; }
.font-medium { font-weight: var(--font-weight-medium) !important; }
.font-semibold { font-weight: var(--font-weight-semibold) !important; }
.font-bold { font-weight: var(--font-weight-bold) !important; }

/* Утилиты размера шрифта */
.text-xs { font-size: var(--font-size-xs) !important; }
.text-sm { font-size: var(--font-size-sm) !important; }
.text-base { font-size: var(--font-size-base) !important; }
.text-lg { font-size: var(--font-size-lg) !important; }
.text-xl { font-size: var(--font-size-xl) !important; }

/* Утилиты отступов */
.m-0 { margin: 0 !important; }
.m-4 { margin: var(--space-4) !important; }
.m-8 { margin: var(--space-8) !important; }

.p-0 { padding: 0 !important; }
.p-4 { padding: var(--space-4) !important; }
.p-8 { padding: var(--space-8) !important; }

/* ==================== СИСТЕМА КОНТРОЛЯ КАЧЕСТВА ==================== */

/* Валидация типографики */
.cm-editor:empty::before,
.markdown-preview-view:empty::before {
  content: "⚠️ Проверьте типографику" !important;
  color: var(--semantic-warning) !important;
  font-style: italic !important;
}

/* Отладочные сетки */
.debug-grid {
  background-image: 
    linear-gradient(rgba(255, 0, 0, 0.1) 1px, transparent 1px),
    linear-gradient(90deg, rgba(255, 0, 0, 0.1) 1px, transparent 1px) !important;
  background-size: var(--space-4) var(--space-4) !important;
}

.debug-typography * {
  outline: 1px solid rgba(0, 255, 0, 0.3) !important;
}

/* ==========================================================================
   Конец системы типографики и адаптивных макетов
   ========================================================================== */
   
   /* ==========================================================================
   Система интерактивных компонентов и UI элементов
   Версия: 2.1.1
   ========================================================================== */

:root {
  /* ==================== СИСТЕМА КОМПОНЕНТОВ ==================== */
  
  /* Базовые переменные компонентов */
  --component-transition-duration: 0.2s;
  --component-transition-timing: cubic-bezier(0.4, 0, 0.2, 1);
  --component-border-width: 1px;
  --component-focus-outline: 2px solid var(--accent-primary);
  --component-focus-offset: 2px;
  
  /* Система размеров компонентов */
  --component-size-xs: 1.5rem;
  --component-size-sm: 2rem;
  --component-size-md: 2.5rem;
  --component-size-lg: 3rem;
  --component-size-xl: 3.5rem;
}

/* ==================== СИСТЕМА КНОПОК ==================== */

.btn {
  /* Базовые стили кнопки */
  display: inline-flex !important;
  align-items: center !important;
  justify-content: center !important;
  gap: var(--space-2);
  padding: var(--space-2) var(--space-4);
  border: var(--component-border-width) solid transparent;
  border-radius: var(--radius-md);
  font-family: inherit;
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-medium);
  line-height: var(--line-height-normal);
  text-decoration: none;
  cursor: pointer;
  user-select: none;
  transition: all var(--component-transition-duration) var(--component-transition-timing);
  position: relative;
  overflow: hidden;
  
  /* Гарантированная доступность */
  min-height: var(--component-size-md);
  min-width: var(--component-size-md);
}

/* Состояния кнопок */
.btn:hover {
  transform: translateY(-1px);
  box-shadow: var(--shadow-elevation-2);
}

.btn:active {
  transform: translateY(0);
  transition-duration: 0.1s;
}

.btn:focus-visible {
  outline: var(--component-focus-outline);
  outline-offset: var(--component-focus-offset);
}

.btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

/* Варианты кнопок */
.btn-primary {
  background: var(--accent-primary);
  color: oklch(100% 0 0);
  border-color: var(--accent-primary);
}

.btn-primary:hover:not(:disabled) {
  background: color-mix(in oklch, var(--accent-primary), black 15%);
  border-color: color-mix(in oklch, var(--accent-primary), black 15%);
}

.btn-secondary {
  background: color-mix(in oklch, var(--accent-primary), transparent 95%);
  color: var(--accent-primary);
  border-color: color-mix(in oklch, var(--accent-primary), transparent 80%);
}

.btn-secondary:hover:not(:disabled) {
  background: color-mix(in oklch, var(--accent-primary), transparent 90%);
  border-color: color-mix(in oklch, var(--accent-primary), transparent 60%);
}

.btn-ghost {
  background: transparent;
  color: var(--text-normal);
  border-color: transparent;
}

.btn-ghost:hover:not(:disabled) {
  background: color-mix(in oklch, var(--accent-primary), transparent 95%);
  border-color: color-mix(in oklch, var(--accent-primary), transparent 80%);
}

/* Размеры кнопок */
.btn-xs {
  padding: var(--space-1) var(--space-2);
  font-size: var(--font-size-xs);
  min-height: var(--component-size-xs);
  min-width: var(--component-size-xs);
}

.btn-sm {
  padding: var(--space-2) var(--space-3);
  font-size: var(--font-size-sm);
  min-height: var(--component-size-sm);
  min-width: var(--component-size-sm);
}

.btn-lg {
  padding: var(--space-3) var(--space-6);
  font-size: var(--font-size-base);
  min-height: var(--component-size-lg);
  min-width: var(--component-size-lg);
}

.btn-xl {
  padding: var(--space-4) var(--space-8);
  font-size: var(--font-size-lg);
  min-height: var(--component-size-xl);
  min-width: var(--component-size-xl);
}

/* ==================== СИСТЕМА ИНПУТОВ И ФОРМ ==================== */

.input {
  width: 100%;
  padding: var(--space-2) var(--space-3);
  border: var(--component-border-width) solid color-mix(in oklch, var(--accent-primary), transparent 80%);
  border-radius: var(--radius-md);
  background: var(--background-primary);
  color: var(--text-normal);
  font-family: inherit;
  font-size: var(--font-size-sm);
  line-height: var(--line-height-normal);
  transition: all var(--component-transition-duration) var(--component-transition-timing);
  min-height: var(--component-size-md);
}

.input:hover {
  border-color: color-mix(in oklch, var(--accent-primary), transparent 60%);
}

.input:focus {
  outline: none;
  border-color: var(--accent-primary);
  box-shadow: 0 0 0 3px color-mix(in oklch, var(--accent-primary), transparent 85%);
}

.input:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  background: color-mix(in oklch, var(--background-primary), transparent 30%);
}

.input::placeholder {
  color: var(--text-muted);
  opacity: 0.7;
}

/* Группы инпутов */
.input-group {
  display: flex;
  gap: 0;
  border-radius: var(--radius-md);
  overflow: hidden;
  box-shadow: var(--shadow-elevation-1);
}

.input-group .input {
  border-radius: 0;
  border-right: none;
}

.input-group .input:first-child {
  border-top-left-radius: var(--radius-md);
  border-bottom-left-radius: var(--radius-md);
}

.input-group .input:last-child {
  border-right: var(--component-border-width) solid color-mix(in oklch, var(--accent-primary), transparent 80%);
  border-top-right-radius: var(--radius-md);
  border-bottom-right-radius: var(--radius-md);
}

/* ==================== СИСТЕМА КАРТОЧЕК ==================== */

.card {
  background: var(--background-primary);
  border: var(--component-border-width) solid color-mix(in oklch, var(--accent-primary), transparent 90%);
  border-radius: var(--radius-lg);
  padding: var(--space-6);
  box-shadow: var(--shadow-elevation-1);
  transition: all var(--component-transition-duration) var(--component-transition-timing);
  position: relative;
  overflow: hidden;
}

.card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: var(--gradient-primary);
  opacity: 0;
  transition: opacity var(--component-transition-duration) var(--component-transition-timing);
}

.card:hover {
  border-color: color-mix(in oklch, var(--accent-primary), transparent 70%);
  box-shadow: var(--shadow-elevation-2);
  transform: translateY(-2px);
}

.card:hover::before {
  opacity: 1;
}

.card-header {
  margin-bottom: var(--space-4);
  padding-bottom: var(--space-3);
  border-bottom: 1px solid color-mix(in oklch, var(--accent-primary), transparent 90%);
}

.card-title {
  font-size: var(--font-size-lg);
  font-weight: var(--font-weight-semibold);
  color: var(--accent-primary);
  margin: 0;
}

.card-content {
  color: var(--text-normal);
  line-height: var(--line-height-relaxed);
}

/* ==================== СИСТЕМА БЭДЖЕЙ И ТЕГОВ ==================== */

.badge {
  display: inline-flex;
  align-items: center;
  gap: var(--space-1);
  padding: var(--space-1) var(--space-2);
  border-radius: var(--radius-full);
  font-size: var(--font-size-xs);
  font-weight: var(--font-weight-medium);
  line-height: 1;
  text-transform: uppercase;
  letter-spacing: var(--letter-spacing-wide);
  white-space: nowrap;
}

.badge-primary {
  background: color-mix(in oklch, var(--accent-primary), transparent 90%);
  color: var(--accent-primary);
  border: 1px solid color-mix(in oklch, var(--accent-primary), transparent 70%);
}

.badge-success {
  background: var(--semantic-success-bg);
  color: var(--semantic-success);
  border: 1px solid var(--semantic-success-border);
}

.badge-warning {
  background: var(--semantic-warning-bg);
  color: var(--semantic-warning);
  border: 1px solid var(--semantic-warning-border);
}

.badge-error {
  background: var(--semantic-error-bg);
  color: var(--semantic-error);
  border: 1px solid var(--semantic-error-border);
}

.badge-info {
  background: var(--semantic-info-bg);
  color: var(--semantic-info);
  border: 1px solid var(--semantic-info-border);
}

/* ==================== СИСТЕМА АЛЕРТОВ И УВЕДОМЛЕНИЙ ==================== */

.alert {
  padding: var(--space-4);
  border-radius: var(--radius-lg);
  border-left: 4px solid transparent;
  margin: var(--space-4) 0;
  position: relative;
  overflow: hidden;
}

.alert::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: currentColor;
  opacity: 0.05;
  pointer-events: none;
}

.alert-info {
  background: var(--semantic-info-bg);
  border-left-color: var(--semantic-info);
  color: var(--semantic-info);
}

.alert-warning {
  background: var(--semantic-warning-bg);
  border-left-color: var(--semantic-warning);
  color: var(--semantic-warning);
}

.alert-error {
  background: var(--semantic-error-bg);
  border-left-color: var(--semantic-error);
  color: var(--semantic-error);
}

.alert-success {
  background: var(--semantic-success-bg);
  border-left-color: var(--semantic-success);
  color: var(--semantic-success);
}

.alert-title {
  font-weight: var(--font-weight-semibold);
  margin: 0 0 var(--space-2) 0;
  font-size: var(--font-size-sm);
}

.alert-content {
  margin: 0;
  font-size: var(--font-size-sm);
  line-height: var(--line-height-normal);
}

/* ==================== СИСТЕМА НАВИГАЦИИ И ВКЛАДОК ==================== */

.tab-list {
  display: flex;
  gap: var(--space-2);
  border-bottom: 1px solid color-mix(in oklch, var(--accent-primary), transparent 90%);
  margin-bottom: var(--space-6);
  overflow-x: auto;
}

.tab {
  padding: var(--space-3) var(--space-4);
  background: transparent;
  border: none;
  border-bottom: 2px solid transparent;
  color: var(--text-muted);
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-medium);
  cursor: pointer;
  transition: all var(--component-transition-duration) var(--component-transition-timing);
  white-space: nowrap;
  position: relative;
}

.tab:hover {
  color: var(--text-normal);
  background: color-mix(in oklch, var(--accent-primary), transparent 98%);
}

.tab.active {
  color: var(--accent-primary);
  border-bottom-color: var(--accent-primary);
  background: color-mix(in oklch, var(--accent-primary), transparent 95%);
}

.tab-panel {
  display: none;
}

.tab-panel.active {
  display: block;
  animation: fadeIn 0.3s var(--component-transition-timing);
}

/* ==================== СИСТЕМА ПРОГРЕСС-БАРОВ ==================== */

.progress {
  width: 100%;
  height: 6px;
  background: color-mix(in oklch, var(--accent-primary), transparent 90%);
  border-radius: var(--radius-full);
  overflow: hidden;
  position: relative;
}

.progress-bar {
  height: 100%;
  background: var(--gradient-primary);
  border-radius: var(--radius-full);
  transition: width 0.6s var(--component-transition-timing);
  position: relative;
  overflow: hidden;
}

.progress-bar::after {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    90deg,
    transparent,
    oklch(100% 0 0 / 0.3),
    transparent
  );
  animation: progress-shine 2s ease-in-out infinite;
}

/* ==================== СИСТЕМА АНИМАЦИЙ КОМПОНЕНТОВ ==================== */

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes progress-shine {
  0% {
    left: -100%;
  }
  100% {
    left: 100%;
  }
}

@keyframes button-pulse {
  0%, 100% {
    box-shadow: 0 0 0 0 color-mix(in oklch, var(--accent-primary), transparent 50%);
  }
  50% {
    box-shadow: 0 0 0 6px color-mix(in oklch, var(--accent-primary), transparent 70%);
  }
}

/* ==================== АДАПТИВНОСТЬ И ДОСТУПНОСТЬ ==================== */

/* Увеличение touch targets для мобильных */
@media (max-width: 768px) {
  .btn,
  .tab {
    min-height: var(--component-size-lg);
    min-width: var(--component-size-lg);
    padding: var(--space-3) var(--space-4);
  }
  
  .input {
    min-height: var(--component-size-lg);
    font-size: var(--font-size-base);
  }
}

/* Упрощение для высококонтрастного режима */
@media (prefers-contrast: high) {
  .btn {
    border-width: 2px;
  }
  
  .card {
    border-width: 2px;
  }
  
  .tab {
    border-bottom-width: 3px;
  }
}

/* Упрощение анимаций для reduced-motion */
@media (prefers-reduced-motion: reduce) {
  .btn,
  .card,
  .tab,
  .progress-bar {
    transition: none;
    animation: none;
  }
  
  .btn:hover {
    transform: none;
  }
}

/* ==================== FALLBACK СИСТЕМА ==================== */

@supports not (selector(:focus-visible)) {
  .btn:focus {
    outline: var(--component-focus-outline);
    outline-offset: var(--component-focus-offset);
  }
}

@supports not (color: color-mix(in oklch, red, transparent 50%)) {
  .btn-primary {
    background: var(--accent-primary);
    color: white;
  }
  
  .btn-secondary {
    background: rgba(139, 92, 246, 0.1);
    color: var(--accent-primary);
    border-color: rgba(139, 92, 246, 0.2);
  }
}

/* ==================== СИСТЕМА КОНТРОЛЯ КАЧЕСТВА ==================== */

/* Валидация компонентов */
.btn:empty::before,
.card:empty::before {
  content: "⚠️ Пустой компонент";
  color: var(--semantic-warning);
  font-style: italic;
}

/* Отладочные стили */
.debug-components * {
  outline: 1px solid rgba(255, 0, 0, 0.3) !important;
}

.debug-interactive:focus {
  outline: 3px solid lime !important;
}

/* ==================== УТИЛИТЫ КОМПОНЕНТОВ ==================== */

/* Утилиты отображения */
.flex { display: flex !important; }
.grid { display: grid !important; }
.hidden { display: none !important; }

/* Утилиты выравнивания */
.items-center { align-items: center !important; }
.justify-center { justify-content: center !important; }
.justify-between { justify-content: space-between !important; }

/* Утилиты размеров */
.w-full { width: 100% !important; }
.h-full { height: 100% !important; }
.min-h-screen { min-height: 100vh !important; }

/* Утилиты отступов */
.gap-2 { gap: var(--space-2) !important; }
.gap-4 { gap: var(--space-4) !important; }
.gap-8 { gap: var(--space-8) !important; }

/* ==========================================================================
   Конец системы интерактивных компонентов и UI элементов
   ========================================================================== */
   
/* ==========================================================================
   Система интеграции с плагинами Obsidian
   Версия: 2.1.1
   ========================================================================== */

:root {
  /* ==================== СИСТЕМА ПЛАГИНОВ ==================== */
  
  /* Стандартизированные переменные для плагинов */
  --plugin-namespace: 'dn-plugin';
  --plugin-version: '2.1.1';
  --plugin-spacing: var(--space-3);
  --plugin-border-radius: var(--radius-md);
  --plugin-transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  
  /* Цветовые схемы для разных типов плагинов */
  --plugin-productivity-color: var(--accent-primary);
  --plugin-visualization-color: var(--accent-secondary);
  --plugin-development-color: var(--semantic-info);
  --plugin-utility-color: var(--accent-tertiary);
}

/* ==================== БАЗОВЫЕ СТИЛИ ДЛЯ ВСЕХ ПЛАГИНОВ ==================== */

/* Автоматическое применение базовых стилей к неизвестным плагинам */
.workspace-leaf-content:not([data-type="markdown"]):not([data-type="file-explorer"]):not([data-type*="known"]) {
  background: color-mix(in oklch, var(--background-primary), transparent 5%) !important;
  backdrop-filter: var(--backdrop-blur-sm);
  border-radius: var(--radius-lg);
  border: 1px solid color-mix(in oklch, var(--accent-primary), transparent 90%);
  
  & .view-header {
    background: color-mix(in oklch, var(--accent-primary), transparent 95%) !important;
    border-bottom: 1px solid color-mix(in oklch, var(--accent-primary), transparent 85%) !important;
    backdrop-filter: var(--backdrop-blur-sm);
  }
}

/* ==================== CALENDAR ПЛАГИН ==================== */

.workspace-leaf-content[data-type="calendar"] {
  --calendar-primary: var(--accent-primary);
  --calendar-background: color-mix(in oklch, var(--background-primary), transparent 10%);
  --calendar-border: color-mix(in oklch, var(--accent-primary), transparent 80%);
  --calendar-today-glow: var(--neon-glow-secondary);
}

.calendar {
  background: var(--calendar-background) !important;
  backdrop-filter: var(--backdrop-blur-md);
  border-radius: var(--radius-lg);
  padding: var(--plugin-spacing);
}

.calendar .day {
  border: 1px solid var(--calendar-border) !important;
  border-radius: var(--radius-sm);
  transition: var(--plugin-transition);
  position: relative;
  overflow: hidden;
  background: color-mix(in oklch, var(--background-primary), transparent 20%);
  
  &::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--gradient-primary);
    opacity: 0;
    transition: opacity 0.3s ease;
  }
}

.calendar .day:hover {
  border-color: color-mix(in oklch, var(--calendar-primary), transparent 60%) !important;
  transform: scale(1.05);
  z-index: 2;
}

.calendar .day.today {
  border-color: var(--calendar-primary) !important;
  box-shadow: var(--calendar-today-glow);
  
  &::before {
    opacity: 0.1;
  }
}

.calendar .day.has-note {
  background: color-mix(in oklch, var(--calendar-primary), transparent 95%) !important;
  
  &::after {
    content: '';
    position: absolute;
    bottom: 2px;
    right: 2px;
    width: 4px;
    height: 4px;
    background: var(--calendar-primary);
    border-radius: 50%;
  }
}

.calendar .day.active {
  background: color-mix(in oklch, var(--calendar-primary), transparent 90%) !important;
  transform: scale(1.08);
}

/* ==================== KANBAN ПЛАГИН ==================== */

.kanban-plugin {
  --kanban-board-bg: color-mix(in oklch, var(--background-primary), transparent 10%);
  --kanban-column-bg: color-mix(in oklch, var(--background-primary), transparent 5%);
  --kanban-card-bg: color-mix(in oklch, var(--background-primary), white 3%);
  --kanban-accent: var(--accent-primary);
  --kanban-drag-shadow: var(--shadow-elevation-3);
}

.kanban-plugin__board {
  background: var(--kanban-board-bg) !important;
  backdrop-filter: var(--backdrop-blur-lg);
  border-radius: var(--radius-xl);
  padding: var(--space-6);
  gap: var(--space-4);
}

.kanban-plugin__lane {
  background: var(--kanban-column-bg) !important;
  border: 1px solid color-mix(in oklch, var(--kanban-accent), transparent 90%);
  border-radius: var(--radius-lg);
  padding: var(--space-4);
  min-width: 280px;
  transition: var(--plugin-transition);
  
  &:hover {
    border-color: color-mix(in oklch, var(--kanban-accent), transparent 70%);
    transform: translateY(-2px);
  }
}

.kanban-plugin__lane-header {
  color: var(--kanban-accent) !important;
  font-weight: var(--font-weight-semibold);
  font-size: var(--font-size-lg);
  margin-bottom: var(--space-3);
  padding-bottom: var(--space-2);
  border-bottom: 2px solid color-mix(in oklch, var(--kanban-accent), transparent 80%);
}

.kanban-plugin__item {
  background: var(--kanban-card-bg) !important;
  border: 1px solid color-mix(in oklch, var(--kanban-accent), transparent 95%);
  border-radius: var(--radius-md);
  padding: var(--space-3);
  margin-bottom: var(--space-2);
  transition: var(--plugin-transition);
  cursor: grab;
  
  &:hover {
    border-color: color-mix(in oklch, var(--kanban-accent), transparent 80%);
    box-shadow: var(--shadow-elevation-2);
    transform: translateY(-1px);
  }
  
  &:active {
    cursor: grabbing;
    transform: rotate(2deg);
  }
}

/* Drag-and-drop улучшения */
.kanban-plugin__item.is-dragging {
  transform: rotate(5deg) scale(1.02);
  box-shadow: var(--kanban-drag-shadow), var(--neon-glow-primary);
  z-index: 1000;
}

.kanban-plugin__lane.drop-zone {
  background: color-mix(in oklch, var(--kanban-accent), transparent 95%) !important;
  border: 2px dashed var(--kanban-accent) !important;
}

/* ==================== DATAVIEW ПЛАГИН ==================== */

.dataview {
  --dataview-table-bg: color-mix(in oklch, var(--background-primary), transparent 10%);
  --dataview-row-alt: color-mix(in oklch, var(--background-primary), transparent 5%);
  --dataview-accent: var(--accent-secondary);
}

.dataview.table-view-table {
  background: var(--dataview-table-bg) !important;
  backdrop-filter: var(--backdrop-blur-sm);
  border-radius: var(--radius-lg);
  overflow: hidden;
  box-shadow: var(--shadow-elevation-2);
}

.dataview.table-view-table > thead > tr > th {
  background: color-mix(in oklch, var(--dataview-accent), transparent 95%) !important;
  color: var(--dataview-accent) !important;
  font-weight: var(--font-weight-semibold);
  text-transform: uppercase;
  letter-spacing: var(--letter-spacing-wide);
  font-size: var(--font-size-xs);
  border-bottom: 2px solid color-mix(in oklch, var(--dataview-accent), transparent 70%);
  padding: var(--space-3) var(--space-4);
}

.dataview.table-view-table > tbody > tr:nth-child(even) {
  background: var(--dataview-row-alt) !important;
}

.dataview.table-view-table > tbody > tr:hover {
  background: color-mix(in oklch, var(--dataview-accent), transparent 98%) !important;
  transform: scale(1.01);
  transition: all 0.2s ease;
}

/* Карточки Dataview */
.dataview.list-view-ul {
  display: grid !important;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: var(--space-4);
}

.dataview.list-view-li {
  background: color-mix(in oklch, var(--background-primary), transparent 10%) !important;
  border: 1px solid color-mix(in oklch, var(--accent-primary), transparent 90%);
  border-radius: var(--radius-lg);
  padding: var(--space-4);
  transition: var(--plugin-transition);
  
  &:hover {
    border-color: color-mix(in oklch, var(--accent-primary), transparent 70%);
    transform: translateY(-2px);
    box-shadow: var(--shadow-elevation-2);
  }
}

/* ==================== TASKS ПЛАГИН ==================== */

.tasks-plugin {
  --task-priority-high: var(--semantic-error);
  --task-priority-medium: var(--semantic-warning);
  --task-priority-low: var(--semantic-info);
  --task-completed: var(--semantic-success);
}

.tasks-list-item {
  padding: var(--space-2) var(--space-3);
  margin: var(--space-1) 0;
  border-radius: var(--radius-md);
  border-left: 3px solid transparent;
  transition: var(--plugin-transition);
  
  &:hover {
    background: color-mix(in oklch, var(--accent-primary), transparent 97%);
    transform: translateX(4px);
  }
}

/* Приоритеты задач */
.tasks-list-item[data-task-priority="high"] {
  border-left-color: var(--task-priority-high);
  background: color-mix(in oklch, var(--task-priority-high), transparent 98%);
}

.tasks-list-item[data-task-priority="medium"] {
  border-left-color: var(--task-priority-medium);
}

.tasks-list-item[data-task-priority="low"] {
  border-left-color: var(--task-priority-low);
}

/* Выполненные задачи */
.tasks-list-item[data-task-status="done"] {
  opacity: 0.7;
  text-decoration: line-through;
  border-left-color: var(--task-completed);
  
  &::before {
    content: "✓ ";
    color: var(--task-completed);
    font-weight: var(--font-weight-bold);
  }
}

/* ==================== EXCALIDRAW ПЛАГИН ==================== */

.workspace-leaf-content[data-type="excalidraw"] {
  background: #1a1a1a !important; /* Темный фон для рисования */
}

.excalidraw-wrapper {
  --theme-filter: invert(0.9) hue-rotate(180deg) contrast(1.2);
}

.excalidraw .App-menu_top .Stack .Island {
  background: color-mix(in oklch, #1a1a1a, white 5%) !important;
  backdrop-filter: var(--backdrop-blur-sm);
  border: 1px solid color-mix(in oklch, var(--accent-primary), transparent 80%);
  border-radius: var(--radius-md);
}

/* ==================== SLIDING PANES ПЛАГИН ==================== */

.workspace-leaf.mod-active ~ .workspace-leaf:not(.mod-active) {
  opacity: 0.8;
  filter: blur(0.5px);
  transition: all 0.3s ease;
}

.workspace-leaf.mod-active {
  box-shadow: var(--neon-glow-primary);
  z-index: 10;
}

/* ==================== OUTLINER ПЛАГИН ==================== */

.outline .tree-item {
  position: relative;
  padding-left: var(--space-5);
  transition: var(--plugin-transition);
  
  &::before {
    content: '';
    position: absolute;
    left: var(--space-2);
    top: 50%;
    transform: translateY(-50%);
    width: 4px;
    height: 4px;
    background: var(--accent-primary);
    border-radius: 50%;
    opacity: 0.5;
    transition: var(--plugin-transition);
  }
  
  &:hover::before {
    opacity: 1;
    transform: translateY(-50%) scale(1.5);
  }
}

/* ==================== СИСТЕМА КАТЕГОРИЗАЦИИ ПЛАГИНОВ ==================== */

/* Продуктивность */
[data-plugin-category="productivity"] {
  --plugin-accent: var(--plugin-productivity-color);
}

/* Визуализация */
[data-plugin-category="visualization"] {
  --plugin-accent: var(--plugin-visualization-color);
}

/* Разработка */
[data-plugin-category="development"] {
  --plugin-accent: var(--plugin-development-color);
}

/* Утилиты */
[data-plugin-category="utility"] {
  --plugin-accent: var(--plugin-utility-color);
}

/* ==================== СИСТЕМА СОВМЕСТИМОСТИ ==================== */

/* Индикатор устаревших плагинов */
.plugin-outdated {
  position: relative;
  
  &::before {
    content: '⚠️ Устарело';
    position: absolute;
    top: var(--space-2);
    right: var(--space-2);
    background: var(--semantic-warning);
    color: var(--background-primary);
    padding: var(--space-1) var(--space-2);
    border-radius: var(--radius-sm);
    font-size: var(--font-size-xs);
    font-weight: var(--font-weight-bold);
    z-index: 10;
  }
}

/* Режим совместимости для старых плагинов */
[data-plugin-compatibility="legacy"] {
  --plugin-background: var(--background-primary);
  backdrop-filter: none;
}

/* ==================== АДАПТИВНОСТЬ ДЛЯ МОБИЛЬНЫХ ==================== */

@media (max-width: 768px) {
  .kanban-plugin__board {
    grid-template-columns: 1fr !important;
    gap: var(--space-3);
    padding: var(--space-4);
  }
  
  .kanban-plugin__lane {
    min-width: 100% !important;
  }
  
  .dataview.list-view-ul {
    grid-template-columns: 1fr !important;
  }
  
  .calendar .month {
    grid-template-columns: repeat(7, 1fr) !important;
    gap: 1px;
  }
}

/* ==================== СИСТЕМА ПРОИЗВОДИТЕЛЬНОСТИ ==================== */

/* Оптимизация для плагинов с тяжелой графикой */
.workspace-leaf-content[data-type="excalidraw"],
.workspace-leaf-content[data-type*="graph"] {
  contain: layout paint;
  transform: translateZ(0);
}

/* Ленивая загрузка стилей для редко используемых плагинов */
.workspace-leaf:not(.mod-active) .plugin-heavy {
  opacity: 0.8;
  filter: blur(0.5px);
  transition: all 0.3s ease;
}

/* ==================== FALLBACK СИСТЕМА ==================== */

@supports not (backdrop-filter: blur(10px)) {
  .kanban-plugin__board,
  .dataview.table-view-table,
  .workspace-leaf-content[data-type="calendar"] {
    background: var(--background-primary) !important;
  }
}

@supports not (color: color-mix(in oklch, red, transparent 50%)) {
  .kanban-plugin__lane {
    background: color-mix(in srgb, var(--background-primary), transparent 5%) !important;
  }
  
  .calendar .day.has-note {
    background: rgba(139, 92, 246, 0.05) !important;
  }
}

/* ==================== УТИЛИТЫ ДЛЯ РАЗРАБОТЧИКОВ ПЛАГИНОВ ==================== */

/* Режим отладки стилей плагинов */
[data-debug-plugins="true"] [class*="plugin-"] {
  outline: 2px dashed color-mix(in oklch, var(--accent-primary), transparent 50%) !important;
}

/* Визуальные подсказки для разработки */
.plugin-dev-helper {
  background: var(--semantic-info-bg) !important;
  border: 1px solid var(--semantic-info) !important;
  border-radius: var(--radius-md);
  padding: var(--space-3);
  margin: var(--space-3) 0;
  font-family: var(--font-family-mono);
  font-size: var(--font-size-sm);
}

/* ==================== СИСТЕМА МАСШТАБИРУЕМОСТИ ==================== */

/* CSS-переменные для будущих расширений */
:root {
  --plugin-api-version: '2.1';
  --plugin-stylesheet-version: '1.0';
  --plugin-compatibility-mode: true;
}

/* Система регистрации стилей плагинов */
@layer plugins {
  .plugin-base {
    --plugin-version: var(--plugin-api-version);
    --plugin-compatible: true;
  }
}

/* Поддержка будущих CSS-функций для плагинов */
@supports (selector(:has(*))) {
  .workspace-leaf:has(.plugin-outdated) {
    border: 2px solid var(--semantic-warning) !important;
  }
}

/* Container Queries для адаптивных плагинов */
@container plugin-panel (max-width: 400px) {
  .kanban-plugin__lane {
    min-width: 100% !important;
  }
  
  .dataview.list-view-ul {
    grid-template-columns: 1fr !important;
  }
}

/* ==========================================================================
   Конец системы интеграции с плагинами
   ========================================================================== */
   
/* ==========================================================================
   Система мобильной адаптации и touch-интерфейса
   Версия: 2.1.1
   ========================================================================== */

:root {
  /* ==================== МОБИЛЬНАЯ СИСТЕМА ПЕРЕМЕННЫХ ==================== */
  
  /* Адаптивные единицы измерения */
  --fluid-min-width: 320px;
  --fluid-max-width: 1440px;
  --fluid-screen: 100vw;
  
  /* Адаптивная типографика для мобильных */
  --fluid-text-min: 16px;
  --fluid-text-max: 18px;
  --fluid-text-ratio: 1.1;
  
  /* Адаптивные отступы */
  --fluid-space-min: 8px;
  --fluid-space-max: 20px;
  --fluid-space-ratio: 1.3;
  
  /* Минимальные размеры для touch-элементов */
  --touch-target-min: 44px;
  --touch-target-comfortable: 48px;
  --touch-target-large: 56px;
  
  /* Безопасные зоны для современных устройств */
  --safe-area-top: env(safe-area-inset-top);
  --safe-area-bottom: env(safe-area-inset-bottom);
  --safe-area-left: env(safe-area-inset-left);
  --safe-area-right: env(safe-area-inset-right);
}

/* ==================== МОБИЛЬНАЯ НАВИГАЦИЯ ==================== */

.mobile-navbar {
  background: color-mix(in oklch, var(--background-primary), black 8%);
  backdrop-filter: var(--backdrop-blur-xl);
  border-top: 1px solid color-mix(in oklch, var(--accent-primary), transparent 80%);
  padding: var(--space-3) var(--space-4);
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  z-index: 1000;
  display: flex;
  justify-content: space-around;
  align-items: center;
  
  /* Безопасные зоны */
  padding-bottom: calc(var(--space-3) + var(--safe-area-bottom));
  padding-left: calc(var(--space-4) + var(--safe-area-left));
  padding-right: calc(var(--space-4) + var(--safe-area-right));
}

.mobile-navbar-button {
  background: transparent;
  border: none;
  color: var(--text-muted);
  padding: var(--space-2);
  border-radius: var(--radius-lg);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  min-width: var(--touch-target-large);
  min-height: var(--touch-target-large);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 2px;
  
  &:active {
    background: color-mix(in oklch, var(--accent-primary), transparent 90%);
    transform: scale(0.92);
    transition-duration: 0.1s;
  }
  
  &.active {
    color: var(--accent-primary);
    
    &::after {
      content: '';
      position: absolute;
      bottom: -8px;
      left: 50%;
      transform: translateX(-50%);
      width: 4px;
      height: 4px;
      background: var(--accent-primary);
      border-radius: 50%;
    }
  }
}

.mobile-navbar-icon {
  font-size: 20px;
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.mobile-navbar-label {
  font-size: 11px;
  font-weight: var(--font-weight-medium);
  line-height: 1;
}

/* ==================== TOUCH-ОПТИМИЗИРОВАННЫЕ ЭЛЕМЕНТЫ ==================== */

/* Гарантированные touch targets для всех интерактивных элементов */
.touch-optimized button,
.touch-optimized [role="button"],
.touch-optimized .clickable-icon,
.touch-optimized .view-action {
  min-width: var(--touch-target-comfortable) !important;
  min-height: var(--touch-target-comfortable) !important;
  padding: var(--space-2) !important;
}

/* Увеличенные кнопки для мобильных */
.mobile-button {
  padding: var(--space-3) var(--space-4) !important;
  border-radius: var(--radius-lg) !important;
  font-size: var(--font-size-base) !important;
  font-weight: var(--font-weight-medium) !important;
  min-height: var(--touch-target-large) !important;
  
  &:active {
    transform: scale(0.96) !important;
    transition: transform 0.1s ease !important;
  }
}

/* Улучшенная навигация жестами */
.workspace-leaf-content {
  overscroll-behavior: contain;
  scroll-snap-type: y proximity;
  -webkit-overflow-scrolling: touch;
}

.view-header {
  scroll-snap-align: start;
  position: sticky;
  top: 0;
  z-index: 100;
  background: color-mix(in oklch, var(--background-primary), transparent 30%);
  backdrop-filter: var(--backdrop-blur-sm);
}

/* ==================== АДАПТИВНАЯ СИСТЕМА МАКЕТОВ ==================== */

/* Контейнерные запросы для адаптивных компонентов */
.workspace-split {
  container-type: inline-size;
  container-name: workspace;
}

@container workspace (max-width: 600px) {
  .workspace-split.mod-horizontal {
    flex-direction: column !important;
  }
  
  .workspace-leaf {
    min-height: 50vh !important;
    max-height: 50vh !important;
  }
  
  .workspace-tab-header {
    padding: var(--space-2) var(--space-3) !important;
    font-size: var(--font-size-sm) !important;
  }
}

@container workspace (max-width: 400px) {
  .workspace-tab-header {
    padding: var(--space-2) !important;
    font-size: var(--font-size-xs) !important;
    margin: 0 1px !important;
  }
  
  .view-header {
    padding: var(--space-2) !important;
    flex-wrap: wrap !important;
  }
  
  .view-actions {
    order: -1 !important;
    width: 100% !important;
    justify-content: center !important;
    margin-bottom: var(--space-2) !important;
  }
}

/* ==================== МОБИЛЬНАЯ ТИПОГРАФИКА ==================== */

.mobile-typography {
  /* Fluid typography для мобильных */
  font-size: clamp(
    var(--fluid-text-min),
    calc(var(--fluid-text-min) * var(--fluid-text-ratio) + (var(--fluid-text-max) - var(--fluid-text-min)) * ((100vw - var(--fluid-min-width)) / (var(--fluid-max-width) - var(--fluid-min-width)))),
    var(--fluid-text-max)
  ) !important;
  
  /* Fluid line-height */
  line-height: clamp(
    1.5,
    calc(1.5 + (1.7 - 1.5) * ((100vw - 320px) / (768 - 320))),
    1.7
  ) !important;
}

/* Адаптивные заголовки для мобильных */
@media (max-width: 768px) {
  .cm-header-1,
  .markdown-preview-view h1 {
    font-size: var(--font-size-2xl) !important;
    margin: 1.5rem 0 0.75rem 0 !important;
  }
  
  .cm-header-2,
  .markdown-preview-view h2 {
    font-size: var(--font-size-xl) !important;
    margin: 1.25rem 0 0.625rem 0 !important;
  }
  
  .cm-header-3,
  .markdown-preview-view h3 {
    font-size: var(--font-size-lg) !important;
    margin: 1rem 0 0.5rem 0 !important;
  }
}

/* ==================== МОБИЛЬНАЯ СИСТЕМА ПЛАГИНОВ ==================== */

@container (max-width: 768px) {
  .kanban-plugin__board {
    grid-template-columns: 1fr !important;
    gap: var(--space-3);
    padding: var(--space-4);
  }
  
  .kanban-plugin__lane {
    min-width: 100% !important;
  }
  
  .dataview.list-view-ul {
    grid-template-columns: 1fr !important;
  }
  
  .calendar .month {
    grid-template-columns: repeat(7, 1fr) !important;
    gap: 1px;
  }
  
  .tasks-list-item {
    padding: var(--space-3) !important;
    margin: var(--space-2) 0 !important;
  }
}

/* ==================== ОРИЕНТАЦИОННЫЕ СТИЛИ ==================== */

/* Портретная ориентация */
@media (orientation: portrait) {
  .workspace-split.mod-horizontal {
    flex-direction: column !important;
  }
  
  .markdown-preview-view,
  .cm-editor {
    font-size: var(--fluid-text-min) !important;
    line-height: 1.6 !important;
    padding: var(--space-4) !important;
  }
  
  /* Упрощенная навигация в портрете */
  .view-header {
    position: sticky !important;
    top: 0 !important;
    z-index: 100 !important;
  }
}

/* Ландшафтная ориентация */
@media (orientation: landscape) and (max-height: 500px) {
  .view-header {
    position: sticky !important;
    top: 0 !important;
    z-index: 100 !important;
    min-height: var(--touch-target-comfortable) !important;
  }
  
  .mobile-navbar {
    padding: var(--space-2) var(--space-3) !important;
  }
  
  .mobile-navbar-button {
    min-width: var(--touch-target-min) !important;
    min-height: var(--touch-target-min) !important;
  }
}

/* ==================== ВИРТУАЛЬНАЯ КЛАВИАТУРА ОПТИМИЗАЦИЯ ==================== */

/* Обнаружение открытой виртуальной клавиатуры */
@media (max-height: 500px) {
  .cm-editor.mobile-keyboard-open {
    padding-bottom: 50vh !important;
    transition: padding-bottom 0.3s ease;
  }
  
  .markdown-preview-view.mobile-keyboard-open {
    padding-bottom: 40vh !important;
  }
  
  /* Скрытие несущественных элементов при клавиатуре */
  .mobile-keyboard-open .workspace-tabs,
  .mobile-keyboard-open .status-bar {
    opacity: 0.1 !important;
    transform: translateY(10px) !important;
    transition: all 0.3s ease;
  }
}

/* ==================== HAPTIC FEEDBACK СИМУЛЯЦИЯ ==================== */

.touch-feedback:active {
  animation: haptic-pulse 0.1s ease;
}

@keyframes haptic-pulse {
  0% { transform: scale(1); }
  50% { transform: scale(0.98); }
  100% { transform: scale(1); }
}

/* Улучшенные состояния нажатия */
.mobile-press-state:active {
  background: color-mix(in oklch, var(--accent-primary), transparent 90%) !important;
  transform: scale(0.96) !important;
  transition: all 0.1s ease !important;
}

/* ==================== АДАПТИВНЫЕ ТАБЛИЦЫ ДЛЯ МОБИЛЬНЫХ ==================== */

@media (max-width: 768px) {
  .markdown-preview-view table {
    display: block !important;
    overflow-x: auto !important;
    white-space: nowrap !important;
    font-size: var(--font-size-sm) !important;
    
    th, td {
      padding: var(--space-2) var(--space-3) !important;
      min-width: 120px !important;
    }
  }
  
  /* Стили для горизонтального скролла таблиц */
  .table-container {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: thin;
    scrollbar-color: var(--accent-primary) transparent;
    
    &::-webkit-scrollbar {
      height: 6px;
    }
    
    &::-webkit-scrollbar-thumb {
      background: var(--accent-primary);
      border-radius: 3px;
    }
  }
}

/* ==================== СИСТЕМА ПРОИЗВОДИТЕЛЬНОСТИ ДЛЯ МОБИЛЬНЫХ ==================== */

/* Оптимизация для медленных устройств */
@media (prefers-reduced-motion: reduce) {
  .mobile-optimized * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* Оптимизация рендеринга для мобильных */
.mobile-optimized {
  contain: layout style paint;
  will-change: transform;
  
  /* Отключение сложных эффектов на слабых устройствах */
  @media (max-width: 768px) {
    --backdrop-blur-md: none;
    --neon-glow-primary: none;
    --neon-glow-secondary: none;
    --shadow-elevation-2: var(--shadow-elevation-1);
  }
}

/* Оптимизация скролла */
.workspace-leaf-content {
  scroll-behavior: smooth;
  -webkit-overflow-scrolling: touch;
  
  /* Улучшение производительности скролла */
  transform: translateZ(0);
  backface-visibility: hidden;
  perspective: 1000px;
}

/* ==================== СИСТЕМА ДОСТУПНОСТИ ДЛЯ МОБИЛЬНЫХ ==================== */

/* Увеличение контрастности для мобильных */
@media (max-width: 768px) {
  :root {
    --text-normal: oklch(95% 0.02 var(--accent-hue-primary)) !important;
    --text-muted: oklch(75% 0.03 var(--accent-hue-primary)) !important;
  }
}

/* Увеличение размера текста для доступности */
@media (prefers-contrast: more) {
  .mobile-optimized {
    font-size: 18px !important;
    line-height: 1.8 !important;
  }
}

/* Упрощение интерфейса для когнитивной доступности */
[data-cognitive-simple="true"] .mobile-optimized {
  --touch-target-min: 56px;
  --touch-target-comfortable: 64px;
  font-size: 18px !important;
  line-height: 1.8 !important;
}

/* ==================== FALLBACK СИСТЕМА ==================== */

/* Подготовка для будущих CSS-функций */
@supports (height: 100dvh) {
  .mobile-optimized {
    height: 100dvh !important;
    width: 100dvw !important;
  }
}

@supports (scroll-timeline: --mobile-scroll) {
  .workspace-leaf-content {
    scroll-timeline: --mobile-scroll;
  }
}

/* Резервные стили для старых браузеров */
@supports not (env(safe-area-inset-top)) {
  .mobile-navbar {
    padding-bottom: var(--space-3);
    padding-left: var(--space-4);
    padding-right: var(--space-4);
  }
}

@supports not (container-type: inline-size) {
  @media (max-width: 768px) {
    .workspace-split.mod-horizontal {
      flex-direction: column !important;
    }
  }
}

/* ==================== УТИЛИТЫ ДЛЯ МОБИЛЬНОЙ РАЗРАБОТКИ ==================== */

/* Fluid spacing utilities */
.fluid-padding {
  padding: clamp(
    var(--fluid-space-min),
    calc(var(--fluid-space-min) + (var(--fluid-space-max) - var(--fluid-space-min)) * ((100vw - 320px) / (768 - 320))),
    var(--fluid-space-max)
  ) !important;
}

.fluid-margin {
  margin: clamp(
    var(--fluid-space-min),
    calc(var(--fluid-space-min) + (var(--fluid-space-max) - var(--fluid-space-min)) * ((100vw - 320px) / (768 - 320))),
    var(--fluid-space-max)
  ) !important;
}

/* Responsive visibility */
.show-mobile { display: none !important; }
.show-tablet { display: none !important; }
.show-desktop { display: block !important; }

@media (max-width: 768px) {
  .show-mobile { display: block !important; }
  .show-desktop { display: none !important; }
}

@media (max-width: 1024px) {
  .show-tablet { display: block !important; }
}

/* Touch interaction states */
.touch-active:active {
  background: color-mix(in oklch, var(--accent-primary), transparent 90%) !important;
  transform: scale(0.98) !important;
}

.touch-hover:hover {
  background: color-mix(in oklch, var(--acantic-primary), transparent 95%) !important;
}

/* Safe area utilities */
.safe-top { padding-top: var(--safe-area-top) !important; }
.safe-bottom { padding-bottom: var(--safe-area-bottom) !important; }
.safe-left { padding-left: var(--safe-area-left) !important; }
.safe-right { padding-right: var(--safe-area-right) !important; }
.safe-all { 
  padding: var(--safe-area-top) var(--safe-area-right) var(--safe-area-bottom) var(--safe-area-left) !important;
}

/* ==================== СИСТЕМА ТЕСТИРОВАНИЯ МОБИЛЬНОСТИ ==================== */

/* Отладочные стили для тестирования touch targets */
.debug-touch-targets *[min-height] {
  outline: 2px solid rgba(0, 255, 0, 0.5) !important;
  position: relative;
}

.debug-touch-targets *[min-height]::after {
  content: attr(min-height);
  position: absolute;
  top: 0;
  right: 0;
  background: green;
  color: white;
  padding: 2px 4px;
  font-size: 10px;
  border-radius: 2px;
}

/* Визуализация безопасных зон */
.debug-safe-areas::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  border: 2px solid rgba(255, 0, 0, 0.3);
  pointer-events: none;
  z-index: 10000;
}

/* ==========================================================================
   Конец системы мобильной адаптации и touch-интерфейса
   ========================================================================== */
   
/* ==========================================================================
   Система анимаций и интерактивности
   Версия: 2.1.1
   ========================================================================== */

:root {
  /* ==================== СИСТЕМА АНИМАЦИЙ ==================== */
  
  /* Иерархия длительностей анимаций */
  --animation-duration-instant: 50ms;
  --animation-duration-fast: 150ms;
  --animation-duration-normal: 300ms;
  --animation-duration-slow: 500ms;
  --animation-duration-deliberate: 1000ms;
  
  /* Кривые Безье для разных интенций */
  --ease-in-out: cubic-bezier(0.4, 0, 0.2, 1);
  --ease-out: cubic-bezier(0, 0, 0.2, 1);
  --ease-in: cubic-bezier(0.4, 0, 1, 1);
  --ease-elastic: cubic-bezier(0.68, -0.55, 0.265, 1.55);
  --ease-bounce: cubic-bezier(0.175, 0.885, 0.32, 1.275);
  --ease-smooth: cubic-bezier(0.33, 1, 0.68, 1);
  
  /* Система слоев анимаций */
  --animation-layer-base: 1;
  --animation-layer-content: 10;
  --animation-layer-overlay: 100;
  --animation-layer-modal: 1000;
}

/* ==================== СИСТЕМА МИКРО-ИНТЕРАКЦИЙ ==================== */

/* Умные hover-эффекты с изоляцией */
.interactive-element {
  position: relative;
  transition: all var(--animation-duration-fast) var(--ease-out);
  isolation: isolate;
  
  &::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--accent-primary);
    border-radius: inherit;
    opacity: 0;
    transition: opacity var(--animation-duration-normal) var(--ease-out);
    z-index: -1;
    pointer-events: none;
  }
  
  &:hover::before {
    opacity: 0.05;
  }
  
  &:active::before {
    opacity: 0.1;
    transition-duration: var(--animation-duration-instant);
  }
}

/* Продвинутые focus-состояния с анимацией */
.focus-enhanced {
  position: relative;
  
  &:focus-visible {
    outline: 2px solid var(--accent-primary);
    outline-offset: 2px;
    border-radius: var(--radius-sm);
    animation: focus-pulse 0.5s var(--ease-out);
  }
}

@keyframes focus-pulse {
  0% { 
    outline-offset: 2px;
    outline-width: 2px;
  }
  50% { 
    outline-offset: 4px;
    outline-width: 3px;
  }
  100% { 
    outline-offset: 2px;
    outline-width: 2px;
  }
}

/* ==================== АДАПТИВНЫЕ АНИМАЦИИ КОНТЕНТА ==================== */

/* Появление контента с stagger-эффектом */
.content-entrance > * {
  opacity: 0;
  transform: translateY(20px);
  animation: slideInUp var(--animation-duration-normal) var(--ease-out) forwards;
}

@keyframes slideInUp {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Stagger-анимации для списков */
.stagger-list > * {
  opacity: 0;
  transform: translateY(20px);
  animation: slideInUp var(--animation-duration-normal) var(--ease-out) forwards;
}

.stagger-list > *:nth-child(1) { animation-delay: 0ms; }
.stagger-list > *:nth-child(2) { animation-delay: 50ms; }
.stagger-list > *:nth-child(3) { animation-delay: 100ms; }
.stagger-list > *:nth-child(4) { animation-delay: 150ms; }
.stagger-list > *:nth-child(5) { animation-delay: 200ms; }
.stagger-list > *:nth-child(6) { animation-delay: 250ms; }
.stagger-list > *:nth-child(7) { animation-delay: 300ms; }
.stagger-list > *:nth-child(8) { animation-delay: 350ms; }

/* ==================== ИНТЕЛЛЕКТУАЛЬНЫЕ АНИМАЦИИ НАВИГАЦИИ ==================== */

/* View Transitions API для навигации */
@view-transition {
  navigation: auto;
}

.view-transition-container {
  view-transition-name: main-content;
}

/* Анимации перехода между страницами */
.page-transition-enter {
  animation: pageEnter var(--animation-duration-normal) var(--ease-out);
}

.page-transition-exit {
  animation: pageExit var(--animation-duration-fast) var(--ease-in);
}

@keyframes pageEnter {
  from {
    opacity: 0;
    transform: translateX(30px) scale(0.98);
  }
  to {
    opacity: 1;
    transform: translateX(0) scale(1);
  }
}

@keyframes pageExit {
  to {
    opacity: 0;
    transform: translateX(-30px) scale(1.02);
  }
}

/* ==================== ИНТЕРАКТИВНЫЕ ВИЗУАЛЬНЫЕ ЭФФЕКТЫ ==================== */

/* Magnetic buttons с физикой */
.magnetic-button {
  position: relative;
  overflow: hidden;
  transition: transform 0.6s var(--ease-elastic);
  
  &::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    background: radial-gradient(circle, var(--accent-primary) 0%, transparent 70%);
    transition: all var(--animation-duration-slow) var(--ease-out);
    transform: translate(-50%, -50%);
    opacity: 0;
    border-radius: 50%;
  }
  
  &:hover {
    transform: scale(1.05);
  }
  
  &:hover::after {
    width: 300%;
    height: 300%;
    opacity: 0.1;
  }
  
  &:active {
    transform: scale(0.95);
    transition-duration: var(--animation-duration-fast);
  }
}

/* Floating action elements */
.floating-element {
  animation: float 6s var(--ease-in-out) infinite;
}

@keyframes float {
  0%, 100% {
    transform: translateY(0px) rotate(0deg);
  }
  33% {
    transform: translateY(-8px) rotate(1deg);
  }
  66% {
    transform: translateY(4px) rotate(-1deg);
  }
}

/* ==================== СИСТЕМА СОСТОЯНИЙ ЗАГРУЗКИ ==================== */

/* Skeleton loading с улучшенной производительностью */
.skeleton-loader {
  background: linear-gradient(
    90deg,
    color-mix(in oklch, var(--background-primary), transparent 80%) 25%,
    color-mix(in oklch, var(--background-primary), transparent 90%) 50%,
    color-mix(in oklch, var(--background-primary), transparent 80%) 75%
  );
  background-size: 200% 100%;
  animation: skeleton-loading 2s ease-in-out infinite;
  border-radius: var(--radius-md);
  position: relative;
  overflow: hidden;
  
  /* Предотвращение мерцания */
  &::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: inherit;
    animation: inherit;
  }
}

@keyframes skeleton-loading {
  0% {
    background-position: 200% 0;
  }
  100% {
    background-position: -200% 0;
  }
}

/* Progress indicators с анимацией */
.progress-indicator {
  position: relative;
  overflow: hidden;
  
  &::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      90deg,
      transparent,
      color-mix(in oklch, var(--accent-primary), transparent 60%),
      transparent
    );
    animation: progress-shine 2s var(--ease-in-out) infinite;
  }
}

@keyframes progress-shine {
  0% { left: -100%; }
  100% { left: 100%; }
}

/* ==================== ИНТЕРАКТИВНЫЕ ВИЗУАЛИЗАЦИИ ДАННЫХ ==================== */

/* Animated charts and graphs */
.data-bar {
  transform-origin: left center;
  animation: bar-grow 0.8s var(--ease-out) backwards;
}

@keyframes bar-grow {
  from {
    transform: scaleX(0);
    opacity: 0.5;
  }
  to {
    transform: scaleX(1);
    opacity: 1;
  }
}

/* Interactive heatmaps */
.heatmap-cell {
  transition: all var(--animation-duration-normal) var(--ease-out);
  position: relative;
  
  &:hover {
    transform: scale(1.2);
    z-index: var(--animation-layer-content);
    box-shadow: var(--neon-glow-primary);
  }
  
  &::after {
    content: attr(data-value);
    position: absolute;
    top: -30px;
    left: 50%;
    transform: translateX(-50%) scale(0);
    background: var(--background-primary);
    color: var(--text-normal);
    padding: var(--space-1) var(--space-2);
    border-radius: var(--radius-sm);
    font-size: var(--font-size-xs);
    white-space: nowrap;
    opacity: 0;
    transition: all var(--animation-duration-fast) var(--ease-out);
    pointer-events: none;
  }
  
  &:hover::after {
    opacity: 1;
    transform: translateX(-50%) scale(1);
  }
}

/* ==================== СИСТЕМА ПАРАЛЛАКСА И 3D-ЭФФЕКТОВ ==================== */

/* Параллакс scrolling с оптимизацией */
.parallax-container {
  perspective: 1000px;
  transform-style: preserve-3d;
  overflow: hidden;
}

.parallax-layer {
  transform-style: preserve-3d;
  will-change: transform;
}

.parallax-layer[data-depth="0"] {
  transform: translateZ(0);
}

.parallax-layer[data-depth="1"] {
  transform: translateZ(100px) scale(0.9);
}

.parallax-layer[data-depth="2"] {
  transform: translateZ(200px) scale(0.8);
}

/* 3D transform effects с fallback */
.card-3d {
  transform-style: preserve-3d;
  transition: transform var(--animation-duration-normal) var(--ease-out);
  position: relative;
  
  &:hover {
    transform: rotateY(10deg) rotateX(5deg) translateZ(20px);
  }
  
  /* Fallback для браузеров без 3D */
  @supports not (transform-style: preserve-3d) {
    &:hover {
      transform: translateY(-5px) scale(1.02);
    }
  }
}

/* ==================== СИСТЕМА ТРИГГЕРОВ И СЦЕНАРИЕВ АНИМАЦИЙ ==================== */

/* Scroll-driven animations */
@keyframes reveal-on-scroll {
  from {
    opacity: 0;
    transform: translateY(50px) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

.scroll-reveal {
  animation: reveal-on-scroll linear both;
  animation-timeline: view();
  animation-range: entry 0% cover 40%;
}

/* Intersection Observer-based animations */
.observe-animate {
  opacity: 0;
  transform: translateY(30px) scale(0.98);
  transition: all var(--animation-duration-normal) var(--ease-out);
}

.observe-animate.visible {
  opacity: 1;
  transform: translateY(0) scale(1);
}

/* ==================== ИНТЕРАКТИВНЫЕ ФИЗИЧЕСКИЕ ЭФФЕКТЫ ==================== */

/* Spring physics simulations */
.spring-physics {
  animation: spring-bounce 0.6s var(--ease-elastic);
}

@keyframes spring-bounce {
  0% { 
    transform: scale(0.8); 
    opacity: 0; 
  }
  60% { 
    transform: scale(1.05); 
  }
  100% { 
    transform: scale(1); 
    opacity: 1; 
  }
}

/* Particle effect simulations */
.particle-container {
  position: relative;
  overflow: hidden;
  contain: layout style paint;
}

.particle {
  position: absolute;
  background: var(--accent-primary);
  border-radius: 50%;
  animation: particle-explode 1s var(--ease-out) forwards;
  pointer-events: none;
}

@keyframes particle-explode {
  0% {
    transform: translate(0, 0) scale(0);
    opacity: 1;
  }
  100% {
    transform: translate(var(--tx, 100px), var(--ty, 100px)) scale(var(--scale, 1));
    opacity: 0;
  }
}

/* ==================== АДАПТИВНЫЕ АНИМАЦИИ ДЛЯ РАЗНЫХ УСТРОЙСТВ ==================== */

/* Оптимизация для мобильных устройств */
@media (max-width: 768px) {
  .mobile-optimized {
    --animation-duration-normal: 200ms;
    --animation-duration-slow: 300ms;
  }
  
  /* Упрощение сложных анимаций на мобильных */
  .parallax-container,
  .card-3d,
  .particle-container {
    transform: none !important;
    animation: none !important;
  }
}

/* Reduced motion preferences */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
  
  /* Сохранение essential animations */
  .progress-indicator::before,
  .skeleton-loader {
    animation-duration: 2s !important;
  }
}

/* ==================== СИСТЕМА ПРОИЗВОДИТЕЛЬНОСТИ АНИМАЦИЙ ==================== */

/* Оптимизация анимаций */
.will-animate {
  will-change: transform, opacity;
}

.animation-optimized {
  contain: layout style paint;
  transform: translateZ(0);
  backface-visibility: hidden;
  perspective: 1000px;
}

/* Ленивая загрузка тяжелых анимаций */
@media (prefers-reduced-motion: no-preference) {
  .heavy-animation {
    animation: complexAnimation 2s var(--ease-out);
  }
}

/* Предотвращение layout thrashing */
.stable-layout {
  content-visibility: auto;
  contain-intrinsic-size: 1px 5000px;
}

/* ==================== FALLBACK СИСТЕМА ==================== */

/* Резервные стили для старых браузеров */
@supports not (animation-timeline: view()) {
  .scroll-reveal {
    animation: none;
  }
}

@supports not (color: color-mix(in oklch, red, transparent 50%)) {
  .skeleton-loader {
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
  }
}

/* ==================== УТИЛИТЫ ДЛЯ АНИМАЦИЙ ==================== */

/* Анимационные утилиты */
.animate-on-hover:hover {
  animation: hover-pulse 0.3s var(--ease-out);
}

@keyframes hover-pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

.animate-on-click:active {
  animation: click-scale 0.1s var(--ease-in);
}

@keyframes click-scale {
  0% { transform: scale(1); }
  50% { transform: scale(0.95); }
  100% { transform: scale(1); }
}

.animate-on-load {
  animation: load-fade-in 0.5s var(--ease-out);
}

@keyframes load-fade-in {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Утилиты для распространенных анимаций */
.fade-in { animation: fadeIn var(--animation-duration-normal) var(--ease-out); }
.slide-in-up { animation: slideInUp var(--animation-duration-normal) var(--ease-out); }
.scale-in { animation: scaleIn var(--animation-duration-normal) var(--ease-out); }
.bounce-in { animation: bounceIn var(--animation-duration-normal) var(--ease-bounce); }

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes scaleIn {
  from { 
    opacity: 0;
    transform: scale(0.8);
  }
  to { 
    opacity: 1;
    transform: scale(1);
  }
}

@keyframes bounceIn {
  0% {
    opacity: 0;
    transform: scale(0.3);
  }
  50% {
    opacity: 1;
    transform: scale(1.05);
  }
  70% {
    transform: scale(0.9);
  }
  100% {
    opacity: 1;
    transform: scale(1);
  }
}

/* ==================== СИСТЕМА КОНТРОЛЯ КАЧЕСТВА ==================== */

/* Отладка анимаций */
[data-debug-animations="true"] * {
  outline: 1px solid rgba(255, 0, 0, 0.3) !important;
  animation-duration: 2s !important;
  transition-duration: 2s !important;
}

/* Визуализация performance budget */
.performance-monitor {
  position: fixed;
  top: 10px;
  right: 10px;
  background: rgba(0, 0, 0, 0.8);
  color: white;
  padding: 8px 12px;
  border-radius: 4px;
  font-family: monospace;
  font-size: 12px;
  z-index: var(--animation-layer-modal);
}

/* ==================== БУДУЩИЕ СТАНДАРТЫ И ЭКСПЕРИМЕНТАЛЬНЫЕ ФУНКЦИИ ==================== */

/* Подготовка для CSS Animation Level 4 */
@supports (animation-timeline: view()) {
  .view-timeline-animation {
    animation-timeline: view();
    animation-range: entry 0% cover 50%;
  }
}

/* Поддержка Scroll-driven Animations */
@scroll-timeline --page-scroll {
  source: auto;
  orientation: vertical;
  time-range: 1s;
}

.scroll-driven-element {
  animation: progress linear;
  animation-timeline: --page-scroll;
}

/* CSS Houdini подготовка */
@property --custom-progress {
  syntax: '<number>';
  initial-value: 0;
  inherits: false;
}

@supports (background: paint(something)) {
  .houdini-enhanced {
    --animation-engine: houdini;
  }
}

/* ==========================================================================
   Конец системы анимаций и интерактивности
   ========================================================================== */
   
/* ==========================================================================
   Система утилит и компонентов
   Версия: 2.1.1
   ========================================================================== */

:root {
  /* ==================== СИСТЕМА ДИЗАЙН-ТОКЕНОВ ==================== */
  
  /* Глобальные дизайн-токены */
  --design-version: '2.1.1';
  --design-system: 'dark-nebula';
  
  /* Система размеров (8px grid system) */
  --size-scale: 0.25rem;
  --size-1: calc(var(--size-scale) * 1);   /* 4px */
  --size-2: calc(var(--size-scale) * 2);   /* 8px */
  --size-3: calc(var(--size-scale) * 3);   /* 12px */
  --size-4: calc(var(--size-scale) * 4);   /* 16px */
  --size-5: calc(var(--size-scale) * 5);   /* 20px */
  --size-6: calc(var(--size-scale) * 6);   /* 24px */
  --size-8: calc(var(--size-scale) * 8);   /* 32px */
  --size-10: calc(var(--size-scale) * 10); /* 40px */
  --size-12: calc(var(--size-scale) * 12); /* 48px */
  --size-16: calc(var(--size-scale) * 16); /* 64px */
  --size-20: calc(var(--size-scale) * 20); /* 80px */
  
  /* Система скруглений */
  --radius-scale: 0.25rem;
  --radius-xs: calc(var(--radius-scale) * 1);  /* 4px */
  --radius-sm: calc(var(--radius-scale) * 2);  /* 8px */
  --radius-md: calc(var(--radius-scale) * 3);  /* 12px */
  --radius-lg: calc(var(--radius-scale) * 4);  /* 16px */
  --radius-xl: calc(var(--radius-scale) * 6);  /* 24px */
  --radius-2xl: calc(var(--radius-scale) * 8); /* 32px */
  --radius-full: 50%;
}

/* ==================== CSS LAYERS ДЛЯ ОРГАНИЗАЦИИ ==================== */

@layer base, components, utilities, overrides;

@layer base {
  /* Базовые стили системы */
  .design-system-base {
    --system-version: var(--design-version);
    font-family: var(--font-family-sans);
    line-height: var(--line-height-normal);
  }
}

@layer components {
  /* Компоненты системы */
  .card,
  .btn,
  .badge,
  .alert {
    --component-version: '1.0';
  }
}

@layer utilities {
  /* Утилитарные классы */
  .sr-only {
    position: absolute !important;
    width: 1px !important;
    height: 1px !important;
    padding: 0 !important;
    margin: -1px !important;
    overflow: hidden !important;
    clip: rect(0, 0, 0, 0) !important;
    white-space: nowrap !important;
    border: 0 !important;
  }
}

@layer overrides {
  /* Стили переопределения с высоким приоритетом */
}

/* ==================== СИСТЕМА ОТОБРАЖЕНИЯ ==================== */

.d-block { display: block !important; }
.d-inline { display: inline !important; }
.d-inline-block { display: inline-block !important; }
.d-flex { display: flex !important; }
.d-inline-flex { display: inline-flex !important; }
.d-grid { display: grid !important; }
.d-inline-grid { display: inline-grid !important; }
.d-none { display: none !important; }
.d-contents { display: contents !important; }

/* ==================== FLEXBOX УТИЛИТЫ ==================== */

.flex-row { flex-direction: row !important; }
.flex-col { flex-direction: column !important; }
.flex-row-reverse { flex-direction: row-reverse !important; }
.flex-col-reverse { flex-direction: column-reverse !important; }

.flex-wrap { flex-wrap: wrap !important; }
.flex-wrap-reverse { flex-wrap: wrap-reverse !important; }
.flex-nowrap { flex-wrap: nowrap !important; }

.flex-1 { flex: 1 1 0% !important; }
.flex-auto { flex: 1 1 auto !important; }
.flex-initial { flex: 0 1 auto !important; }
.flex-none { flex: none !important; }

/* Выравнивание flex элементов */
.items-start { align-items: flex-start !important; }
.items-end { align-items: flex-end !important; }
.items-center { align-items: center !important; }
.items-baseline { align-items: baseline !important; }
.items-stretch { align-items: stretch !important; }

.justify-start { justify-content: flex-start !important; }
.justify-end { justify-content: flex-end !important; }
.justify-center { justify-content: center !important; }
.justify-between { justify-content: space-between !important; }
.justify-around { justify-content: space-around !important; }
.justify-evenly { justify-content: space-evenly !important; }

.self-start { align-self: flex-start !important; }
.self-end { align-self: flex-end !important; }
.self-center { align-self: center !important; }
.self-stretch { align-self: stretch !important; }
.self-auto { align-self: auto !important; }

/* ==================== GRID УТИЛИТЫ ==================== */

.grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)) !important; }
.grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)) !important; }
.grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)) !important; }
.grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)) !important; }
.grid-cols-6 { grid-template-columns: repeat(6, minmax(0, 1fr)) !important; }
.grid-cols-12 { grid-template-columns: repeat(12, minmax(0, 1fr)) !important; }
.grid-cols-auto { grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)) !important; }
.grid-cols-none { grid-template-columns: none !important; }

.grid-rows-1 { grid-template-rows: repeat(1, minmax(0, 1fr)) !important; }
.grid-rows-2 { grid-template-rows: repeat(2, minmax(0, 1fr)) !important; }
.grid-rows-3 { grid-template-rows: repeat(3, minmax(0, 1fr)) !important; }
.grid-rows-4 { grid-template-rows: repeat(4, minmax(0, 1fr)) !important; }
.grid-rows-auto { grid-template-rows: repeat(auto-fit, minmax(0, 1fr)) !important; }
.grid-rows-none { grid-template-rows: none !important; }

.col-auto { grid-column: auto !important; }
.col-span-1 { grid-column: span 1 / span 1 !important; }
.col-span-2 { grid-column: span 2 / span 2 !important; }
.col-span-3 { grid-column: span 3 / span 3 !important; }
.col-span-4 { grid-column: span 4 / span 4 !important; }
.col-span-6 { grid-column: span 6 / span 6 !important; }
.col-span-12 { grid-column: span 12 / span 12 !important; }
.col-span-full { grid-column: 1 / -1 !important; }

.row-auto { grid-row: auto !important; }
.row-span-1 { grid-row: span 1 / span 1 !important; }
.row-span-2 { grid-row: span 2 / span 2 !important; }
.row-span-3 { grid-row: span 3 / span 3 !important; }
.row-span-4 { grid-row: span 4 / span 4 !important; }
.row-span-6 { grid-row: span 6 / span 6 !important; }
.row-span-full { grid-row: 1 / -1 !important; }

.gap-0 { gap: 0 !important; }
.gap-1 { gap: var(--size-1) !important; }
.gap-2 { gap: var(--size-2) !important; }
.gap-3 { gap: var(--size-3) !important; }
.gap-4 { gap: var(--size-4) !important; }
.gap-6 { gap: var(--size-6) !important; }
.gap-8 { gap: var(--size-8) !important; }
.gap-12 { gap: var(--size-12) !important; }

.gap-x-0 { column-gap: 0 !important; }
.gap-x-1 { column-gap: var(--size-1) !important; }
.gap-x-2 { column-gap: var(--size-2) !important; }
.gap-x-3 { column-gap: var(--size-3) !important; }
.gap-x-4 { column-gap: var(--size-4) !important; }
.gap-x-6 { column-gap: var(--size-6) !important; }
.gap-x-8 { column-gap: var(--size-8) !important; }

.gap-y-0 { row-gap: 0 !important; }
.gap-y-1 { row-gap: var(--size-1) !important; }
.gap-y-2 { row-gap: var(--size-2) !important; }
.gap-y-3 { row-gap: var(--size-3) !important; }
.gap-y-4 { row-gap: var(--size-4) !important; }
.gap-y-6 { row-gap: var(--size-6) !important; }
.gap-y-8 { row-gap: var(--size-8) !important; }

/* ==================== СИСТЕМА ОТСТУПОВ ==================== */

/* Внутренние отступы */
.p-0 { padding: 0 !important; }
.p-1 { padding: var(--size-1) !important; }
.p-2 { padding: var(--size-2) !important; }
.p-3 { padding: var(--size-3) !important; }
.p-4 { padding: var(--size-4) !important; }
.p-6 { padding: var(--size-6) !important; }
.p-8 { padding: var(--size-8) !important; }
.p-12 { padding: var(--size-12) !important; }

.px-0 { padding-left: 0 !important; padding-right: 0 !important; }
.px-1 { padding-left: var(--size-1) !important; padding-right: var(--size-1) !important; }
.px-2 { padding-left: var(--size-2) !important; padding-right: var(--size-2) !important; }
.px-3 { padding-left: var(--size-3) !important; padding-right: var(--size-3) !important; }
.px-4 { padding-left: var(--size-4) !important; padding-right: var(--size-4) !important; }
.px-6 { padding-left: var(--size-6) !important; padding-right: var(--size-6) !important; }
.px-8 { padding-left: var(--size-8) !important; padding-right: var(--size-8) !important; }

.py-0 { padding-top: 0 !important; padding-bottom: 0 !important; }
.py-1 { padding-top: var(--size-1) !important; padding-bottom: var(--size-1) !important; }
.py-2 { padding-top: var(--size-2) !important; padding-bottom: var(--size-2) !important; }
.py-3 { padding-top: var(--size-3) !important; padding-bottom: var(--size-3) !important; }
.py-4 { padding-top: var(--size-4) !important; padding-bottom: var(--size-4) !important; }
.py-6 { padding-top: var(--size-6) !important; padding-bottom: var(--size-6) !important; }
.py-8 { padding-top: var(--size-8) !important; padding-bottom: var(--size-8) !important; }

.pt-0 { padding-top: 0 !important; }
.pt-1 { padding-top: var(--size-1) !important; }
.pt-2 { padding-top: var(--size-2) !important; }
.pt-3 { padding-top: var(--size-3) !important; }
.pt-4 { padding-top: var(--size-4) !important; }
.pt-6 { padding-top: var(--size-6) !important; }
.pt-8 { padding-top: var(--size-8) !important; }

.pr-0 { padding-right: 0 !important; }
.pr-1 { padding-right: var(--size-1) !important; }
.pr-2 { padding-right: var(--size-2) !important; }
.pr-3 { padding-right: var(--size-3) !important; }
.pr-4 { padding-right: var(--size-4) !important; }
.pr-6 { padding-right: var(--size-6) !important; }
.pr-8 { padding-right: var(--size-8) !important; }

.pb-0 { padding-bottom: 0 !important; }
.pb-1 { padding-bottom: var(--size-1) !important; }
.pb-2 { padding-bottom: var(--size-2) !important; }
.pb-3 { padding-bottom: var(--size-3) !important; }
.pb-4 { padding-bottom: var(--size-4) !important; }
.pb-6 { padding-bottom: var(--size-6) !important; }
.pb-8 { padding-bottom: var(--size-8) !important; }

.pl-0 { padding-left: 0 !important; }
.pl-1 { padding-left: var(--size-1) !important; }
.pl-2 { padding-left: var(--size-2) !important; }
.pl-3 { padding-left: var(--size-3) !important; }
.pl-4 { padding-left: var(--size-4) !important; }
.pl-6 { padding-left: var(--size-6) !important; }
.pl-8 { padding-left: var(--size-8) !important; }

/* Внешние отступы */
.m-0 { margin: 0 !important; }
.m-1 { margin: var(--size-1) !important; }
.m-2 { margin: var(--size-2) !important; }
.m-3 { margin: var(--size-3) !important; }
.m-4 { margin: var(--size-4) !important; }
.m-6 { margin: var(--size-6) !important; }
.m-8 { margin: var(--size-8) !important; }
.m-12 { margin: var(--size-12) !important; }
.m-auto { margin: auto !important; }

.mx-0 { margin-left: 0 !important; margin-right: 0 !important; }
.mx-1 { margin-left: var(--size-1) !important; margin-right: var(--size-1) !important; }
.mx-2 { margin-left: var(--size-2) !important; margin-right: var(--size-2) !important; }
.mx-3 { margin-left: var(--size-3) !important; margin-right: var(--size-3) !important; }
.mx-4 { margin-left: var(--size-4) !important; margin-right: var(--size-4) !important; }
.mx-6 { margin-left: var(--size-6) !important; margin-right: var(--size-6) !important; }
.mx-8 { margin-left: var(--size-8) !important; margin-right: var(--size-8) !important; }
.mx-auto { margin-left: auto !important; margin-right: auto !important; }

.my-0 { margin-top: 0 !important; margin-bottom: 0 !important; }
.my-1 { margin-top: var(--size-1) !important; margin-bottom: var(--size-1) !important; }
.my-2 { margin-top: var(--size-2) !important; margin-bottom: var(--size-2) !important; }
.my-3 { margin-top: var(--size-3) !important; margin-bottom: var(--size-3) !important; }
.my-4 { margin-top: var(--size-4) !important; margin-bottom: var(--size-4) !important; }
.my-6 { margin-top: var(--size-6) !important; margin-bottom: var(--size-6) !important; }
.my-8 { margin-top: var(--size-8) !important; margin-bottom: var(--size-8) !important; }
.my-auto { margin-top: auto !important; margin-bottom: auto !important; }

.mt-0 { margin-top: 0 !important; }
.mt-1 { margin-top: var(--size-1) !important; }
.mt-2 { margin-top: var(--size-2) !important; }
.mt-3 { margin-top: var(--size-3) !important; }
.mt-4 { margin-top: var(--size-4) !important; }
.mt-6 { margin-top: var(--size-6) !important; }
.mt-8 { margin-top: var(--size-8) !important; }
.mt-auto { margin-top: auto !important; }

.mr-0 { margin-right: 0 !important; }
.mr-1 { margin-right: var(--size-1) !important; }
.mr-2 { margin-right: var(--size-2) !important; }
.mr-3 { margin-right: var(--size-3) !important; }
.mr-4 { margin-right: var(--size-4) !important; }
.mr-6 { margin-right: var(--size-6) !important; }
.mr-8 { margin-right: var(--size-8) !important; }
.mr-auto { margin-right: auto !important; }

.mb-0 { margin-bottom: 0 !important; }
.mb-1 { margin-bottom: var(--size-1) !important; }
.mb-2 { margin-bottom: var(--size-2) !important; }
.mb-3 { margin-bottom: var(--size-3) !important; }
.mb-4 { margin-bottom: var(--size-4) !important; }
.mb-6 { margin-bottom: var(--size-6) !important; }
.mb-8 { margin-bottom: var(--size-8) !important; }
.mb-auto { margin-bottom: auto !important; }

.ml-0 { margin-left: 0 !important; }
.ml-1 { margin-left: var(--size-1) !important; }
.ml-2 { margin-left: var(--size-2) !important; }
.ml-3 { margin-left: var(--size-3) !important; }
.ml-4 { margin-left: var(--size-4) !important; }
.ml-6 { margin-left: var(--size-6) !important; }
.ml-8 { margin-left: var(--size-8) !important; }
.ml-auto { margin-left: auto !important; }

/* ==================== СИСТЕМА РАЗМЕРОВ ==================== */

.w-auto { width: auto !important; }
.w-full { width: 100% !important; }
.w-screen { width: 100vw !important; }
.w-min { width: min-content !important; }
.w-max { width: max-content !important; }
.w-fit { width: fit-content !important; }

.h-auto { height: auto !important; }
.h-full { height: 100% !important; }
.h-screen { height: 100vh !important; }
.h-min { height: min-content !important; }
.h-max { height: max-content !important; }
.h-fit { height: fit-content !important; }

.min-w-0 { min-width: 0 !important; }
.min-w-full { min-width: 100% !important; }
.min-w-min { min-width: min-content !important; }
.min-w-max { min-width: max-content !important; }
.min-w-fit { min-width: fit-content !important; }

.min-h-0 { min-height: 0 !important; }
.min-h-full { min-height: 100% !important; }
.min-h-screen { min-height: 100vh !important; }
.min-h-min { min-height: min-content !important; }
.min-h-max { min-height: max-content !important; }
.min-h-fit { min-height: fit-content !important; }

.max-w-full { max-width: 100% !important; }
.max-w-screen { max-width: 100vw !important; }
.max-w-prose { max-width: 65ch !important; }
.max-w-none { max-width: none !important; }

.max-h-full { max-height: 100% !important; }
.max-h-screen { max-height: 100vh !important; }
.max-h-none { max-height: none !important; }

/* ==================== ТИПОГРАФИЧЕСКИЕ УТИЛИТЫ ==================== */

.text-xs { font-size: var(--font-size-xs) !important; }
.text-sm { font-size: var(--font-size-sm) !important; }
.text-base { font-size: var(--font-size-base) !important; }
.text-lg { font-size: var(--font-size-lg) !important; }
.text-xl { font-size: var(--font-size-xl) !important; }
.text-2xl { font-size: var(--font-size-2xl) !important; }
.text-3xl { font-size: var(--font-size-3xl) !important; }
.text-4xl { font-size: var(--font-size-4xl) !important; }

.font-light { font-weight: var(--font-weight-light) !important; }
.font-normal { font-weight: var(--font-weight-normal) !important; }
.font-medium { font-weight: var(--font-weight-medium) !important; }
.font-semibold { font-weight: var(--font-weight-semibold) !important; }
.font-bold { font-weight: var(--font-weight-bold) !important; }
.font-extrabold { font-weight: var(--font-weight-extrabold) !important; }

.leading-tight { line-height: var(--line-height-tight) !important; }
.leading-normal { line-height: var(--line-height-normal) !important; }
.leading-relaxed { line-height: var(--line-height-relaxed) !important; }
.leading-loose { line-height: var(--line-height-loose) !important; }

.tracking-tight { letter-spacing: var(--letter-spacing-tight) !important; }
.tracking-normal { letter-spacing: var(--letter-spacing-normal) !important; }
.tracking-wide { letter-spacing: var(--letter-spacing-wide) !important; }
.tracking-wider { letter-spacing: var(--letter-spacing-wider) !important; }

.text-left { text-align: left !important; }
.text-center { text-align: center !important; }
.text-right { text-align: right !important; }
.text-justify { text-align: justify !important; }

.underline { text-decoration: underline !important; }
.line-through { text-decoration: line-through !important; }
.no-underline { text-decoration: none !important; }

.uppercase { text-transform: uppercase !important; }
.lowercase { text-transform: lowercase !important; }
.capitalize { text-transform: capitalize !important; }
.normal-case { text-transform: none !important; }

.whitespace-normal { white-space: normal !important; }
.whitespace-nowrap { white-space: nowrap !important; }
.whitespace-pre { white-space: pre !important; }
.whitespace-pre-line { white-space: pre-line !important; }
.whitespace-pre-wrap { white-space: pre-wrap !important; }

.break-normal { overflow-wrap: normal !important; word-break: normal !important; }
.break-words { overflow-wrap: break-word !important; }
.break-all { word-break: break-all !important; }

.truncate {
  overflow: hidden !important;
  text-overflow: ellipsis !important;
  white-space: nowrap !important;
}

/* ==================== ЦВЕТОВЫЕ УТИЛИТЫ ==================== */

.text-primary { color: var(--accent-primary) !important; }
.text-secondary { color: var(--accent-secondary) !important; }
.text-tertiary { color: var(--accent-tertiary) !important; }

.text-normal { color: var(--text-normal) !important; }
.text-muted { color: var(--text-muted) !important; }
.text-faint { color: var(--text-faint) !important; }

.text-success { color: var(--semantic-success) !important; }
.text-warning { color: var(--semantic-warning) !important; }
.text-error { color: var(--semantic-error) !important; }
.text-info { color: var(--semantic-info) !important; }

.bg-primary { background-color: var(--accent-primary) !important; }
.bg-secondary { background-color: var(--accent-secondary) !important; }
.bg-tertiary { background-color: var(--accent-tertiary) !important; }

.bg-background { background-color: var(--background-primary) !important; }
.bg-background-alt { background-color: var(--background-primary-alt) !important; }

.bg-success { background-color: var(--semantic-success-bg) !important; }
.bg-warning { background-color: var(--semantic-warning-bg) !important; }
.bg-error { background-color: var(--semantic-error-bg) !important; }
.bg-info { background-color: var(--semantic-info-bg) !important; }

.border-primary { border-color: var(--accent-primary) !important; }
.border-secondary { border-color: var(--accent-secondary) !important; }
.border-tertiary { border-color: var(--accent-tertiary) !important; }

.border-success { border-color: var(--semantic-success-border) !important; }
.border-warning { border-color: var(--semantic-warning-border) !important; }
.border-error { border-color: var(--semantic-error-border) !important; }
.border-info { border-color: var(--semantic-info-border) !important; }

/* ==================== СИСТЕМА СКРУГЛЕНИЙ ==================== */

.rounded-none { border-radius: 0 !important; }
.rounded-xs { border-radius: var(--radius-xs) !important; }
.rounded-sm { border-radius: var(--radius-sm) !important; }
.rounded-md { border-radius: var(--radius-md) !important; }
.rounded-lg { border-radius: var(--radius-lg) !important; }
.rounded-xl { border-radius: var(--radius-xl) !important; }
.rounded-2xl { border-radius: var(--radius-2xl) !important; }
.rounded-full { border-radius: var(--radius-full) !important; }

.rounded-t-none { border-top-left-radius: 0 !important; border-top-right-radius: 0 !important; }
.rounded-r-none { border-top-right-radius: 0 !important; border-bottom-right-radius: 0 !important; }
.rounded-b-none { border-bottom-right-radius: 0 !important; border-bottom-left-radius: 0 !important; }
.rounded-l-none { border-top-left-radius: 0 !important; border-bottom-left-radius: 0 !important; }

/* ==================== СИСТЕМА ТЕНЕЙ И ЭФФЕКТОВ ==================== */

.shadow-none { box-shadow: none !important; }
.shadow-elevation-1 { box-shadow: var(--shadow-elevation-1) !important; }
.shadow-elevation-2 { box-shadow: var(--shadow-elevation-2) !important; }
.shadow-elevation-3 { box-shadow: var(--shadow-elevation-3) !important; }

.glow-primary { box-shadow: var(--neon-glow-primary) !important; }
.glow-secondary { box-shadow: var(--neon-glow-secondary) !important; }
.glow-tertiary { box-shadow: var(--neon-glow-tertiary) !important; }

.backdrop-blur-none { backdrop-filter: none !important; }
.backdrop-blur-sm { backdrop-filter: var(--backdrop-blur-sm) !important; }
.backdrop-blur-md { backdrop-filter: var(--backdrop-blur-md) !important; }
.backdrop-blur-lg { backdrop-filter: var(--backdrop-blur-lg) !important; }

/* ==================== СИСТЕМА ПОЗИЦИОНИРОВАНИЯ ==================== */

.relative { position: relative !important; }
.absolute { position: absolute !important; }
.fixed { position: fixed !important; }
.sticky { position: sticky !important; }
.static { position: static !important; }

.inset-0 { top: 0 !important; right: 0 !important; bottom: 0 !important; left: 0 !important; }
.inset-auto { top: auto !important; right: auto !important; bottom: auto !important; left: auto !important; }

.top-0 { top: 0 !important; }
.top-1 { top: var(--size-1) !important; }
.top-2 { top: var(--size-2) !important; }
.top-4 { top: var(--size-4) !important; }
.top-auto { top: auto !important; }

.right-0 { right: 0 !important; }
.right-1 { right: var(--size-1) !important; }
.right-2 { right: var(--size-2) !important; }
.right-4 { right: var(--size-4) !important; }
.right-auto { right: auto !important; }

.bottom-0 { bottom: 0 !important; }
.bottom-1 { bottom: var(--size-1) !important; }
.bottom-2 { bottom: var(--size-2) !important; }
.bottom-4 { bottom: var(--size-4) !important; }
.bottom-auto { bottom: auto !important; }

.left-0 { left: 0 !important; }
.left-1 { left: var(--size-1) !important; }
.left-2 { left: var(--size-2) !important; }
.left-4 { left: var(--size-4) !important; }
.left-auto { left: auto !important; }

.z-0 { z-index: 0 !important; }
.z-10 { z-index: 10 !important; }
.z-20 { z-index: 20 !important; }
.z-30 { z-index: 30 !important; }
.z-40 { z-index: 40 !important; }
.z-50 { z-index: 50 !important; }
.z-auto { z-index: auto !important; }

/* ==================== СИСТЕМА ВИДИМОСТИ ==================== */

.visible { visibility: visible !important; }
.invisible { visibility: hidden !important; }
.collapse { visibility: collapse !important; }

.opacity-0 { opacity: 0 !important; }
.opacity-25 { opacity: 0.25 !important; }
.opacity-50 { opacity: 0.5 !important; }
.opacity-75 { opacity: 0.75 !important; }
.opacity-100 { opacity: 1 !important; }

/* ==================== СИСТЕМА ПЕРЕПОЛНЕНИЯ ==================== */

.overflow-auto { overflow: auto !important; }
.overflow-hidden { overflow: hidden !important; }
.overflow-visible { overflow: visible !important; }
.overflow-scroll { overflow: scroll !important; }
.overflow-clip { overflow: clip !important; }

.overflow-x-auto { overflow-x: auto !important; }
.overflow-y-auto { overflow-y: auto !important; }
.overflow-x-hidden { overflow-x: hidden !important; }
.overflow-y-hidden { overflow-y: hidden !important; }
.overflow-x-scroll { overflow-x: scroll !important; }
.overflow-y-scroll { overflow-y: scroll !important; }
.overflow-x-clip { overflow-x: clip !important; }
.overflow-y-clip { overflow-y: clip !important; }

/* ==================== СИСТЕМА КУРСОРОВ ==================== */

.cursor-auto { cursor: auto !important; }
.cursor-default { cursor: default !important; }
.cursor-pointer { cursor: pointer !important; }
.cursor-wait { cursor: wait !important; }
.cursor-text { cursor: text !important; }
.cursor-move { cursor: move !important; }
.cursor-help { cursor: help !important; }
.cursor-not-allowed { cursor: not-allowed !important; }
.cursor-none { cursor: none !important; }

/* ==================== СИСТЕМА ПОЛЬЗОВАТЕЛЬСКОГО ВЫБОРА ==================== */

.select-none { user-select: none !important; }
.select-text { user-select: text !important; }
.select-all { user-select: all !important; }
.select-auto { user-select: auto !important; }

/* ==================== СИСТЕМА ПРОИЗВОДИТЕЛЬНОСТИ ==================== */

.will-change-auto { will-change: auto !important; }
.will-change-transform { will-change: transform !important; }
.will-change-opacity { will-change: opacity !important; }
.will-change-scroll { will-change: scroll-position !important; }
.will-change-contents { will-change: contents !important; }

.contain-none { contain: none !important; }
.contain-layout { contain: layout !important; }
.contain-paint { contain: paint !important; }
.contain-size { contain: size !important; }
.contain-content { contain: content !important; }
.contain-strict { contain: strict !important; }

/* ==================== FALLBACK СИСТЕМА ==================== */

/* Резервные стили для старых браузеров */
@supports not (display: grid) {
  .grid-cols-1 { display: block !important; }
  .gap-4 > * { margin: var(--size-2) !important; }
}

@supports not (backdrop-filter: blur(10px)) {
  .backdrop-blur-md { background: color-mix(in oklch, var(--background-primary), transparent 10%) !important; }
}

/* ==================== СИСТЕМА КОНТРОЛЯ КАЧЕСТВА ==================== */

/* Отладочные утилиты */
.debug-border * { outline: 1px solid red !important; }
.debug-layout { background: rgba(255, 0, 0, 0.1) !important; }
.debug-spacing { background: rgba(0, 255, 0, 0.1) !important; }
.debug-typography { background: rgba(0, 0, 255, 0.1) !important; }

.debug-grid {
  background-image: 
    linear-gradient(rgba(255, 0, 0, 0.1) 1px, transparent 1px),
    linear-gradient(90deg, rgba(255, 0, 0, 0.1) 1px, transparent 1px) !important;
  background-size: var(--size-4) var(--size-4) !important;
}

/* ==========================================================================
   Конец системы утилит и компонентов
   ========================================================================== */
   

   

/* ==========================================================================
   Dark Nebula Theme for Obsidian - Foundation & Design System
   Version: 3.0.0
   ========================================================================== */

/* ==================== CSS VARIABLES ARCHITECTURE ==================== */

:root {
  /* === SYSTEM METADATA === */
  --dn-version: '3.0.0';
  --dn-namespace: 'dn';
  
  /* === COLOR SPACE CONFIG === */
  --color-space: oklch;
  --color-gamut: srgb;
  
  /* === ACCESSIBILITY STANDARDS === */
  --min-contrast-ratio: 4.5; /* WCAG AA */
  --preferred-contrast-ratio: 7.0; /* WCAG AAA */
}

/* ==================== DESIGN TOKENS - CORE SYSTEM ==================== */

:root {
  /* === SEMANTIC COLOR TOKENS === */
  /* Primary Colors - Dynamic HSL system */
  --hue-primary: 265;    /* Purple base */
  --hue-secondary: 190;  /* Cyan accent */
  --hue-tertiary: 330;   /* Pink accent */
  
  --saturation-base: 85%;
  --lightness-base: 65%;
  
  /* Core Brand Colors */
  --color-primary: hsl(var(--hue-primary) var(--saturation-base) var(--lightness-base));
  --color-secondary: hsl(var(--hue-secondary) var(--saturation-base) var(--lightness-base));
  --color-tertiary: hsl(var(--hue-tertiary) var(--saturation-base) var(--lightness-base));
  
  /* Semantic Colors */
  --color-success: hsl(145 85% 65%);
  --color-warning: hsl(45 85% 65%);
  --color-error: hsl(0 85% 65%);
  --color-info: hsl(200 85% 65%);
  
  /* === SURFACE COLORS - DARK THEME (Default) === */
  --surface-primary: hsl(230 15% 18%);
  --surface-secondary: hsl(230 15% 14%);
  --surface-tertiary: hsl(230 15% 10%);
  --surface-accent: var(--color-primary);
  
  /* === TEXT COLORS - DARK THEME === */
  --text-primary: hsl(0 0% 98%);
  --text-secondary: hsl(0 0% 75%);
  --text-tertiary: hsl(0 0% 55%);
  --text-accent: var(--color-primary);
  
  /* === BORDER & DIVIDER SYSTEM === */
  --border-primary: hsl(230 15% 30% / 0.4);
  --border-secondary: hsl(230 15% 25% / 0.3);
  --border-accent: var(--color-primary);
  
  /* === SHADOW SYSTEM === */
  --shadow-color: 0 0% 0%;
  --shadow-strength: 0.15;
  
  --shadow-sm: 
    0 1px 2px hsl(var(--shadow-color) / calc(var(--shadow-strength) + 0.02)),
    0 1px 1px hsl(var(--shadow-color) / calc(var(--shadow-strength) + 0.01));
  
  --shadow-md:
    0 4px 6px hsl(var(--shadow-color) / calc(var(--shadow-strength) + 0.03)),
    0 2px 4px hsl(var(--shadow-color) / calc(var(--shadow-strength) + 0.02));
  
  --shadow-lg:
    0 10px 15px hsl(var(--shadow-color) / calc(var(--shadow-strength) + 0.04)),
    0 4px 6px hsl(var(--shadow-color) / calc(var(--shadow-strength) + 0.03));
  
  /* === SPACING SCALE (8px base) === */
  --space-3xs: 0.125rem;  /* 2px */
  --space-2xs: 0.25rem;   /* 4px */
  --space-xs: 0.5rem;     /* 8px */
  --space-sm: 0.75rem;    /* 12px */
  --space-md: 1rem;       /* 16px */
  --space-lg: 1.5rem;     /* 24px */
  --space-xl: 2rem;       /* 32px */
  --space-2xl: 3rem;      /* 48px */
  --space-3xl: 4rem;      /* 64px */
  
  /* === BORDER RADIUS SYSTEM === */
  --radius-sm: 0.25rem;   /* 4px */
  --radius-md: 0.375rem;  /* 6px */
  --radius-lg: 0.5rem;    /* 8px */
  --radius-xl: 0.75rem;   /* 12px */
  --radius-2xl: 1rem;     /* 16px */
  
  /* === TYPOGRAPHY SCALE === */
  --text-xs: 0.75rem;     /* 12px */
  --text-sm: 0.875rem;    /* 14px */
  --text-base: 1rem;      /* 16px */
  --text-lg: 1.125rem;    /* 18px */
  --text-xl: 1.25rem;     /* 20px */
  --text-2xl: 1.5rem;     /* 24px */
  
  /* === LINE HEIGHTS === */
  --leading-tight: 1.25;
  --leading-normal: 1.5;
  --leading-relaxed: 1.75;
  
  /* === FONT WEIGHTS === */
  --font-normal: 400;
  --font-medium: 500;
  --font-semibold: 600;
  --font-bold: 700;
  
  /* === ANIMATION SYSTEM === */
  --duration-fast: 150ms;
  --duration-normal: 300ms;
  --duration-slow: 500ms;
  
  --ease-in-out: cubic-bezier(0.4, 0, 0.2, 1);
  --ease-out: cubic-bezier(0, 0, 0.2, 1);
  --ease-in: cubic-bezier(0.4, 0, 1, 1);
  
  /* === Z-INDEX SYSTEM === */
  --z-dropdown: 1000;
  --z-sticky: 1020;
  --z-fixed: 1030;
  --z-modal: 1040;
  --z-popover: 1050;
  --z-tooltip: 1060;
}

/* ==================== LIGHT THEME TOKENS ==================== */

[data-theme="light"],
.theme-light {
  /* === SURFACE COLORS - LIGHT THEME === */
  --surface-primary: hsl(0 0% 100%);
  --surface-secondary: hsl(0 0% 98%);
  --surface-tertiary: hsl(0 0% 95%);
  --surface-accent: var(--color-primary);
  
  /* === TEXT COLORS - LIGHT THEME === */
  --text-primary: hsl(0 0% 10%);
  --text-secondary: hsl(0 0% 30%);
  --text-tertiary: hsl(0 0% 50%);
  --text-accent: var(--color-primary);
  
  /* === BORDER & DIVIDER SYSTEM === */
  --border-primary: hsl(0 0% 85% / 0.8);
  --border-secondary: hsl(0 0% 90% / 0.6);
  --border-accent: var(--color-primary);
  
  /* === SHADOW SYSTEM === */
  --shadow-color: 230 15% 30%;
  --shadow-strength: 0.08;
}

/* ==================== HIGH CONTRAST THEME ==================== */

[data-contrast="high"] {
  --min-contrast-ratio: 7.0;
  
  /* Enhanced contrast colors */
  --text-primary: hsl(0 0% 100%);
  --text-secondary: hsl(0 0% 85%);
  --text-tertiary: hsl(0 0% 70%);
  
  --border-primary: hsl(0 0% 50%);
  --border-secondary: hsl(0 0% 40%);
}

[data-theme="light"][data-contrast="high"] {
  --text-primary: hsl(0 0% 0%);
  --text-secondary: hsl(0 0% 20%);
  --text-tertiary: hsl(0 0% 40%);
  
  --border-primary: hsl(0 0% 20%);
  --border-secondary: hsl(0 0% 30%);
}

/* ==================== DENSITY SYSTEM ==================== */

[data-density="compact"] {
  --space-xs: 0.375rem;   /* 6px */
  --space-sm: 0.5rem;     /* 8px */
  --space-md: 0.75rem;    /* 12px */
  --space-lg: 1rem;       /* 16px */
  --text-base: 0.875rem;  /* 14px */
}

[data-density="comfortable"] {
  --space-xs: 0.625rem;   /* 10px */
  --space-sm: 0.875rem;   /* 14px */
  --space-md: 1.25rem;    /* 20px */
  --space-lg: 1.75rem;    /* 28px */
  --text-base: 1.125rem;  /* 18px */
}

/* ==================== UTILITY CLASSES ==================== */

/* Spacing Utilities */
.gap-xs { gap: var(--space-xs) !important; }
.gap-sm { gap: var(--space-sm) !important; }
.gap-md { gap: var(--space-md) !important; }
.gap-lg { gap: var(--space-lg) !important; }

.p-xs { padding: var(--space-xs) !important; }
.p-sm { padding: var(--space-sm) !important; }
.p-md { padding: var(--space-md) !important; }
.p-lg { padding: var(--space-lg) !important; }

.m-xs { margin: var(--space-xs) !important; }
.m-sm { margin: var(--space-sm) !important; }
.m-md { margin: var(--space-md) !important; }
.m-lg { margin: var(--space-lg) !important; }

/* Text Utilities */
.text-xs { font-size: var(--text-xs) !important; }
.text-sm { font-size: var(--text-sm) !important; }
.text-base { font-size: var(--text-base) !important; }
.text-lg { font-size: var(--text-lg) !important; }
.text-xl { font-size: var(--text-xl) !important; }

/* Color Utilities */
.text-primary { color: var(--text-primary) !important; }
.text-secondary { color: var(--text-secondary) !important; }
.text-accent { color: var(--text-accent) !important; }

.bg-primary { background: var(--surface-primary) !important; }
.bg-secondary { background: var(--surface-secondary) !important; }
.bg-accent { background: var(--surface-accent) !important; }

/* ==================== OBSIDIAN SPECIFIC OVERRIDES ==================== */

/* Ensure Obsidian uses our design tokens */
.theme-dark {
  --background-primary: var(--surface-primary);
  --background-primary-alt: var(--surface-secondary);
  --background-secondary: var(--surface-tertiary);
  --background-modifier-border: var(--border-primary);
  --text-normal: var(--text-primary);
  --text-muted: var(--text-secondary);
  --text-faint: var(--text-tertiary);
}

.theme-light {
  --background-primary: var(--surface-primary);
  --background-primary-alt: var(--surface-secondary);
  --background-secondary: var(--surface-tertiary);
  --background-modifier-border: var(--border-primary);
  --text-normal: var(--text-primary);
  --text-muted: var(--text-secondary);
  --text-faint: var(--text-tertiary);
}

/* ==================== RESPONSIVE DESIGN ==================== */

@media (max-width: 768px) {
  :root {
    --space-md: 0.875rem;
    --space-lg: 1.25rem;
    --text-base: 0.9375rem;
  }
}

@media (max-width: 480px) {
  :root {
    --space-md: 0.75rem;
    --space-lg: 1rem;
    --text-base: 0.875rem;
  }
}

/* ==========================================================================
   End of Foundation & Design System
   ========================================================================== */
   
/* ==========================================================================
   Dark Nebula Theme - Layout & Grid System
   Version: 3.0.0
   ========================================================================== */

/* ==================== LAYOUT FOUNDATION ==================== */

:root {
  /* === LAYOUT TOKENS === */
  --layout-width-xs: 20rem;     /* 320px */
  --layout-width-sm: 24rem;     /* 384px */
  --layout-width-md: 28rem;     /* 448px */
  --layout-width-lg: 32rem;     /* 512px */
  --layout-width-xl: 36rem;     /* 576px */
  --layout-width-2xl: 42rem;    /* 672px */
  --layout-width-3xl: 48rem;    /* 768px */
  --layout-width-4xl: 56rem;    /* 896px */
  --layout-width-5xl: 64rem;    /* 1024px */
  --layout-width-6xl: 72rem;    /* 1152px */
  --layout-width-7xl: 80rem;    /* 1280px */
  
  /* === BREAKPOINT SYSTEM === */
  --breakpoint-sm: 640px;
  --breakpoint-md: 768px;
  --breakpoint-lg: 1024px;
  --breakpoint-xl: 1280px;
  --breakpoint-2xl: 1536px;
  
  /* === CONTAINER SYSTEM === */
  --container-padding: var(--space-md);
  --container-max-width: var(--layout-width-7xl);
  
  /* === GRID SYSTEM === */
  --grid-columns: 12;
  --grid-gap: var(--space-md);
  --grid-gap-sm: var(--space-sm);
  --grid-gap-lg: var(--space-lg);
}

/* ==================== CONTAINER SYSTEM ==================== */

.dn-container {
  width: 100%;
  max-width: var(--container-max-width);
  margin-left: auto;
  margin-right: auto;
  padding-left: var(--container-padding);
  padding-right: var(--container-padding);
  position: relative;
}

/* Fluid container for smaller screens */
.dn-container--fluid {
  max-width: none;
}

/* Responsive container widths */
.dn-container--sm { max-width: var(--layout-width-md); }
.dn-container--md { max-width: var(--layout-width-lg); }
.dn-container--lg { max-width: var(--layout-width-3xl); }
.dn-container--xl { max-width: var(--layout-width-5xl); }

/* ==================== GRID SYSTEM ==================== */

.dn-grid {
  display: grid;
  grid-template-columns: repeat(var(--grid-columns), 1fr);
  gap: var(--grid-gap);
  width: 100%;
  align-items: start; /* Prevent stretching issues */
}

/* Grid variants */
.dn-grid--fluid {
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
}

.dn-grid--dense {
  grid-auto-flow: dense;
}

.dn-grid--no-gap {
  gap: 0;
}

.dn-grid--sm-gap {
  gap: var(--grid-gap-sm);
}

.dn-grid--lg-gap {
  gap: var(--grid-gap-lg);
}

/* Column spans with boundary checking */
.dn-col-1 { grid-column: span 1; }
.dn-col-2 { grid-column: span 2; }
.dn-col-3 { grid-column: span 3; }
.dn-col-4 { grid-column: span 4; }
.dn-col-5 { grid-column: span 5; }
.dn-col-6 { grid-column: span 6; }
.dn-col-7 { grid-column: span 7; }
.dn-col-8 { grid-column: span 8; }
.dn-col-9 { grid-column: span 9; }
.dn-col-10 { grid-column: span 10; }
.dn-col-11 { grid-column: span 11; }
.dn-col-12 { grid-column: span 12; }

/* Auto columns */
.dn-col-auto {
  grid-column: auto;
}

.dn-col-full {
  grid-column: 1 / -1;
}

/* Row spans */
.dn-row-1 { grid-row: span 1; }
.dn-row-2 { grid-row: span 2; }
.dn-row-3 { grid-row: span 3; }
.dn-row-4 { grid-row: span 4; }
.dn-row-auto { grid-row: auto; }
.dn-row-full { grid-row: 1 / -1; }

/* ==================== FLEXBOX SYSTEM ==================== */

.dn-flex {
  display: flex;
  gap: var(--space-md);
}

.dn-flex--inline {
  display: inline-flex;
}

/* Flex directions */
.dn-flex--row { flex-direction: row; }
.dn-flex--row-reverse { flex-direction: row-reverse; }
.dn-flex--col { flex-direction: column; }
.dn-flex--col-reverse { flex-direction: column-reverse; }

/* Flex wrapping */
.dn-flex--wrap { flex-wrap: wrap; }
.dn-flex--nowrap { flex-wrap: nowrap; }
.dn-flex--wrap-reverse { flex-wrap: wrap-reverse; }

/* Justify content */
.dn-justify-start { justify-content: flex-start; }
.dn-justify-end { justify-content: flex-end; }
.dn-justify-center { justify-content: center; }
.dn-justify-between { justify-content: space-between; }
.dn-justify-around { justify-content: space-around; }
.dn-justify-evenly { justify-content: space-evenly; }

/* Align items */
.dn-items-start { align-items: flex-start; }
.dn-items-end { align-items: flex-end; }
.dn-items-center { align-items: center; }
.dn-items-baseline { align-items: baseline; }
.dn-items-stretch { align-items: stretch; }

/* Align self */
.dn-self-auto { align-self: auto; }
.dn-self-start { align-self: flex-start; }
.dn-self-end { align-self: flex-end; }
.dn-self-center { align-self: center; }
.dn-self-stretch { align-self: stretch; }
.dn-self-baseline { align-self: baseline; }

/* Flex grow/shrink */
.dn-flex-1 { flex: 1 1 0%; }
.dn-flex-auto { flex: 1 1 auto; }
.dn-flex-initial { flex: 0 1 auto; }
.dn-flex-none { flex: none; }

.dn-flex-grow { flex-grow: 1; }
.dn-flex-grow-0 { flex-grow: 0; }
.dn-flex-shrink { flex-shrink: 1; }
.dn-flex-shrink-0 { flex-shrink: 0; }

/* ==================== OBSIDIAN WORKSPACE LAYOUT ==================== */

/* Main workspace container */
.workspace {
  background: var(--surface-primary);
  color: var(--text-primary);
  height: 100vh;
  overflow: hidden; /* Prevent double scrollbars */
  display: flex;
  flex-direction: column;
}

/* Workspace splits */
.workspace-split {
  display: flex;
  flex: 1;
  position: relative;
  min-height: 0; /* Fix for flexbox overflow */
}

.workspace-split.mod-horizontal {
  flex-direction: row;
}

.workspace-split.mod-vertical {
  flex-direction: column;
}

/* Workspace leaves */
.workspace-leaf {
  position: relative;
  flex: 1;
  min-width: 0; /* Fix for flexbox text overflow */
  min-height: 0;
  background: var(--surface-primary);
  border: 1px solid transparent;
  transition: border-color var(--duration-fast) var(--ease-out);
}

.workspace-leaf:hover {
  border-color: var(--border-secondary);
}

.workspace-leaf.mod-active {
  border-color: var(--color-primary);
  z-index: 1; /* Ensure active leaf is above others */
}

.workspace-leaf-content {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  flex-direction: column;
  overflow: hidden; /* Contain content */
}

/* ==================== SIDEBAR LAYOUT ==================== */

.workspace-leaf[data-type="file-explorer"],
.workspace-leaf[data-type="starred"],
.workspace-leaf[data-type="search"] {
  min-width: 250px;
  max-width: 400px;
  flex: 0 0 auto; /* Don't grow, don't shrink */
}

/* Sidebar resize handles */
.workspace-leaf-resize-handle {
  position: absolute;
  z-index: 10;
  background: transparent;
  transition: background-color var(--duration-fast) var(--ease-out);
}

.workspace-leaf-resize-handle:hover {
  background: var(--color-primary);
}

.workspace-split.mod-horizontal > .workspace-leaf-resize-handle {
  width: 4px;
  top: 0;
  bottom: 0;
  cursor: col-resize;
}

.workspace-split.mod-vertical > .workspace-leaf-resize-handle {
  height: 4px;
  left: 0;
  right: 0;
  cursor: row-resize;
}

/* ==================== EDITOR LAYOUT ==================== */

/* Markdown source view */
.cm-editor {
  height: 100%;
  background: var(--surface-primary);
  font-family: var(--font-mono);
  font-size: var(--text-base);
  line-height: var(--leading-relaxed);
  position: relative;
}

.cm-scroller {
  font-family: inherit;
  line-height: inherit;
  overflow: auto;
  padding: var(--space-md);
}

.cm-content {
  max-width: var(--layout-width-2xl);
  margin: 0 auto;
  padding: 0 var(--space-md);
  caret-color: var(--color-primary); /* Custom caret color */
}

/* Markdown preview view */
.markdown-preview-view {
  max-width: var(--layout-width-2xl);
  margin: 0 auto;
  padding: var(--space-lg);
  background: var(--surface-primary);
}

/* ==================== RESPONSIVE LAYOUT ==================== */

/* Mobile-first responsive design */
@media (max-width: 768px) {
  .dn-grid {
    grid-template-columns: 1fr;
    gap: var(--space-sm);
  }
  
  /* Stack all columns on mobile */
  .dn-col-1,
  .dn-col-2,
  .dn-col-3,
  .dn-col-4,
  .dn-col-5,
  .dn-col-6,
  .dn-col-7,
  .dn-col-8,
  .dn-col-9,
  .dn-col-10,
  .dn-col-11,
  .dn-col-12 {
    grid-column: 1 / -1;
  }
  
  /* Adjust workspace for mobile */
  .workspace-split.mod-horizontal {
    flex-direction: column;
  }
  
  .workspace-leaf[data-type="file-explorer"],
  .workspace-leaf[data-type="starred"],
  .workspace-leaf[data-type="search"] {
    min-width: 100%;
    max-width: 100%;
    flex: 0 0 300px; /* Fixed height on mobile */
  }
  
  .markdown-preview-view,
  .cm-content {
    max-width: none;
    padding: var(--space-md);
  }
}

/* Tablet adjustments */
@media (min-width: 769px) and (max-width: 1024px) {
  .dn-grid {
    grid-template-columns: repeat(6, 1fr);
  }
  
  .markdown-preview-view,
  .cm-content {
    max-width: var(--layout-width-xl);
  }
}

/* ==================== LAYOUT UTILITIES ==================== */

/* Display utilities */
.dn-block { display: block !important; }
.dn-inline-block { display: inline-block !important; }
.dn-inline { display: inline !important; }
.dn-flex { display: flex !important; }
.dn-inline-flex { display: inline-flex !important; }
.dn-grid { display: grid !important; }
.dn-inline-grid { display: inline-grid !important; }
.dn-hidden { display: none !important; }

/* Position utilities */
.dn-static { position: static !important; }
.dn-fixed { position: fixed !important; }
.dn-absolute { position: absolute !important; }
.dn-relative { position: relative !important; }
.dn-sticky { position: sticky !important; }

/* Overflow utilities */
.dn-overflow-auto { overflow: auto !important; }
.dn-overflow-hidden { overflow: hidden !important; }
.dn-overflow-visible { overflow: visible !important; }
.dn-overflow-scroll { overflow: scroll !important; }

.dn-overflow-x-auto { overflow-x: auto !important; }
.dn-overflow-y-auto { overflow-y: auto !important; }
.dn-overflow-x-hidden { overflow-x: hidden !important; }
.dn-overflow-y-hidden { overflow-y: hidden !important; }

/* Sizing utilities */
.dn-w-full { width: 100% !important; }
.dn-h-full { height: 100% !important; }
.dn-w-screen { width: 100vw !important; }
.dn-h-screen { height: 100vh !important; }
.dn-min-w-0 { min-width: 0 !important; }
.dn-min-h-0 { min-height: 0 !important; }

/* ==================== LAYOUT BUG FIXES ==================== */

/* Fix for flexbox overflow in nested layouts */
.workspace-leaf .workspace-leaf {
  min-width: 0;
  min-height: 0;
}

/* Fix for CodeMirror scrollbar positioning */
.cm-scroller::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

.cm-scroller::-webkit-scrollbar-track {
  background: var(--surface-secondary);
}

.cm-scroller::-webkit-scrollbar-thumb {
  background: var(--border-primary);
  border-radius: var(--radius-sm);
}

.cm-scroller::-webkit-scrollbar-thumb:hover {
  background: var(--border-accent);
}

/* Fix for mobile viewport units */
@supports (height: 100dvh) {
  .workspace {
    height: 100dvh;
  }
  
  .dn-h-screen {
    height: 100dvh !important;
  }
}

/* Fix for iOS elastic scroll */
.workspace,
.cm-scroller,
.markdown-preview-view {
  -webkit-overflow-scrolling: touch;
}

/* Fix for Firefox scrollbar in sidebar */
@-moz-document url-prefix() {
  .workspace-leaf-content {
    scrollbar-width: thin;
    scrollbar-color: var(--border-primary) transparent;
  }
}

/* Fix for Windows high contrast mode */
@media (forced-colors: active) {
  .workspace-leaf.mod-active {
    border-color: Highlight;
  }
  
  .workspace-leaf-resize-handle {
    forced-color-adjust: none;
    background: LinkText;
  }
}

/* ==================== PERFORMANCE OPTIMIZATIONS ==================== */

/* Containment for complex layouts */
.workspace-leaf,
.workspace-split {
  contain: layout style;
}

/* Will-change for smooth resizing */
.workspace-leaf-resize-handle {
  will-change: background-color;
}

/* Content-visibility for offscreen leaves */
.workspace-leaf:not(.mod-active) {
  content-visibility: auto;
  contain-intrinsic-size: 100px 100px;
}

/* ==========================================================================
   End of Layout & Grid System
   ========================================================================== */
   
/* ==========================================================================
   Dark Nebula Theme - Color System & Theming
   Version: 3.0.0
   ========================================================================== */

/* ==================== COLOR SYSTEM ARCHITECTURE ==================== */

:root {
  /* === COLOR SPACE CONFIGURATION === */
  --color-space: oklch;
  --color-gamut: srgb;
  
  /* === DYNAMIC COLOR PROPERTIES === */
  --hue-base: 265;
  --saturation-base: 0.75;
  --lightness-base: 0.65;
  
  /* === ACCESSIBILITY CONSTRAINTS === */
  --min-contrast-ratio: 4.5;
  --preferred-contrast-ratio: 7.0;
  --max-brightness-shift: 0.15;
}

/* ==================== CORE COLOR FUNCTIONS ==================== */

/* CSS Color Level 4+ color function with fallbacks */
@property --color-dynamic-primary {
  syntax: '<color>';
  inherits: true;
  initial-value: hsl(var(--hue-base) 75% 65%);
}

@property --color-dynamic-secondary {
  syntax: '<color>';
  inherits: true;
  initial-value: hsl(calc(var(--hue-base) + 60) 75% 65%);
}

@property --color-dynamic-tertiary {
  syntax: '<color>';
  inherits: true;
  initial-value: hsl(calc(var(--hue-base) + 120) 75% 65%);
}

/* ==================== SEMANTIC COLOR TOKENS ==================== */

:root {
  /* === BRAND COLORS - Dynamic HSL system === */
  --color-primary: hsl(var(--hue-base) 75% 65%);
  --color-primary-dark: hsl(var(--hue-base) 75% 45%);
  --color-primary-light: hsl(var(--hue-base) 75% 85%);
  --color-primary-ghost: hsl(var(--hue-base) 75% 65% / 0.1);
  
  --color-secondary: hsl(calc(var(--hue-base) + 60) 75% 65%);
  --color-secondary-dark: hsl(calc(var(--hue-base) + 60) 75% 45%);
  --color-secondary-light: hsl(calc(var(--hue-base) + 60) 75% 85%);
  
  --color-tertiary: hsl(calc(var(--hue-base) + 120) 75% 65%);
  --color-tertiary-dark: hsl(calc(var(--hue-base) + 120) 75% 45%);
  --color-tertiary-light: hsl(calc(var(--hue-base) + 120) 75% 85%);
  
  /* === SEMANTIC INTENT COLORS === */
  --color-success: hsl(145 75% 55%);
  --color-success-dark: hsl(145 75% 35%);
  --color-success-light: hsl(145 75% 75%);
  --color-success-ghost: hsl(145 75% 55% / 0.1);
  
  --color-warning: hsl(45 75% 55%);
  --color-warning-dark: hsl(45 75% 35%);
  --color-warning-light: hsl(45 75% 75%);
  --color-warning-ghost: hsl(45 75% 55% / 0.1);
  
  --color-error: hsl(0 75% 55%);
  --color-error-dark: hsl(0 75% 35%);
  --color-error-light: hsl(0 75% 75%);
  --color-error-ghost: hsl(0 75% 55% / 0.1);
  
  --color-info: hsl(200 75% 55%);
  --color-info-dark: hsl(200 75% 35%);
  --color-info-light: hsl(200 75% 75%);
  --color-info-ghost: hsl(200 75% 55% / 0.1);
  
  /* === NEUTRAL COLOR SCALE === */
  --color-neutral-50: hsl(0 0% 98%);
  --color-neutral-100: hsl(0 0% 95%);
  --color-neutral-200: hsl(0 0% 90%);
  --color-neutral-300: hsl(0 0% 80%);
  --color-neutral-400: hsl(0 0% 65%);
  --color-neutral-500: hsl(0 0% 50%);
  --color-neutral-600: hsl(0 0% 40%);
  --color-neutral-700: hsl(0 0% 30%);
  --color-neutral-800: hsl(0 0% 20%);
  --color-neutral-900: hsl(0 0% 10%);
  
  /* === SURFACE COLORS - DARK THEME (Default) === */
  --surface-base: var(--color-neutral-900);
  --surface-primary: color-mix(in srgb, var(--surface-base) 95%, white 5%);
  --surface-secondary: color-mix(in srgb, var(--surface-base) 90%, white 10%);
  --surface-tertiary: color-mix(in srgb, var(--surface-base) 85%, white 15%);
  --surface-accent: var(--color-primary);
  --surface-elevated: color-mix(in srgb, var(--surface-base) 80%, white 20%);
  
  /* === TEXT COLORS - DARK THEME === */
  --text-primary: var(--color-neutral-50);
  --text-secondary: var(--color-neutral-300);
  --text-tertiary: var(--color-neutral-500);
  --text-accent: var(--color-primary);
  --text-inverse: var(--color-neutral-900);
  --text-on-accent: white;
  
  /* === BORDER COLORS === */
  --border-primary: color-mix(in srgb, var(--surface-base) 60%, white 40% / 0.2);
  --border-secondary: color-mix(in srgb, var(--surface-base) 70%, white 30% / 0.15);
  --border-accent: var(--color-primary);
  --border-focus: var(--color-primary-light);
  
  /* === SHADOW COLORS === */
  --shadow-color: 0 0% 0%;
  --shadow-strength: 0.25;
}

/* ==================== LIGHT THEME TOKENS ==================== */

[data-theme="light"],
.theme-light {
  --surface-base: var(--color-neutral-50);
  --surface-primary: color-mix(in srgb, var(--surface-base) 95%, black 5%);
  --surface-secondary: color-mix(in srgb, var(--surface-base) 90%, black 10%);
  --surface-tertiary: color-mix(in srgb, var(--surface-base) 85%, black 15%);
  --surface-elevated: color-mix(in srgb, var(--surface-base) 80%, black 20%);
  
  --text-primary: var(--color-neutral-900);
  --text-secondary: var(--color-neutral-700);
  --text-tertiary: var(--color-neutral-500);
  --text-inverse: var(--color-neutral-50);
  
  --border-primary: color-mix(in srgb, var(--surface-base) 60%, black 40% / 0.15);
  --border-secondary: color-mix(in srgb, var(--surface-base) 70%, black 30% / 0.1);
  
  --shadow-color: 220 15% 30%;
  --shadow-strength: 0.08;
}

/* ==================== HIGH CONTRAST THEME ==================== */

[data-contrast="high"] {
  --min-contrast-ratio: 7.0;
  
  /* Enhanced contrast adjustments */
  --text-primary: hsl(0 0% 100%);
  --text-secondary: hsl(0 0% 85%);
  --text-tertiary: hsl(0 0% 70%);
  
  --border-primary: hsl(0 0% 60%);
  --border-secondary: hsl(0 0% 50%);
  
  /* Force borders to be visible */
  --border-primary: color-mix(in srgb, var(--surface-base) 40%, white 60%);
  --border-secondary: color-mix(in srgb, var(--surface-base) 50%, white 50%);
}

[data-theme="light"][data-contrast="high"] {
  --text-primary: hsl(0 0% 0%);
  --text-secondary: hsl(0 0% 20%);
  --text-tertiary: hsl(0 0% 40%);
  
  --border-primary: hsl(0 0% 20%);
  --border-secondary: hsl(0 0% 30%);
}

/* ==================== COLOR PRESET SYSTEM ==================== */

/* Neon Preset (Default) */
[data-color-preset="neon"] {
  --hue-base: 265; /* Purple */
}

/* Ocean Preset */
[data-color-preset="ocean"] {
  --hue-base: 200; /* Blue */
}

/* Forest Preset */
[data-color-preset="forest"] {
  --hue-base: 145; /* Green */
}

/* Sunset Preset */
[data-color-preset="sunset"] {
  --hue-base: 25; /* Orange */
}

/* Monochrome Preset */
[data-color-preset="monochrome"] {
  --color-primary: var(--color-neutral-600);
  --color-secondary: var(--color-neutral-500);
  --color-tertiary: var(--color-neutral-400);
  
  --color-primary-dark: var(--color-neutral-700);
  --color-primary-light: var(--color-neutral-400);
}

/* ==================== DYNAMIC COLOR MIXING ==================== */

/* Color mixing utilities with fallbacks */
.dn-bg-primary-ghost {
  background: var(--color-primary-ghost);
  /* Fallback for browsers without color-mix */
  background: color-mix(in srgb, var(--color-primary) 10%, transparent);
}

.dn-bg-success-ghost {
  background: var(--color-success-ghost);
  background: color-mix(in srgb, var(--color-success) 10%, transparent);
}

.dn-bg-warning-ghost {
  background: var(--color-warning-ghost);
  background: color-mix(in srgb, var(--color-warning) 10%, transparent);
}

.dn-bg-error-ghost {
  background: var(--color-error-ghost);
  background: color-mix(in srgb, var(--color-error) 10%, transparent);
}

/* Gradient utilities */
.dn-gradient-primary {
  background: linear-gradient(
    135deg,
    var(--color-primary),
    var(--color-secondary)
  );
}

.dn-gradient-surface {
  background: linear-gradient(
    135deg,
    var(--surface-primary),
    var(--surface-secondary)
  );
}

/* ==================== THEME TRANSITION SYSTEM ==================== */

/* Smooth theme transitions */
.dn-theme-transition * {
  transition-duration: var(--duration-slow);
  transition-timing-function: var(--ease-in-out);
  transition-property: 
    background-color,
    border-color,
    color,
    fill,
    stroke,
    opacity,
    box-shadow,
    transform,
    filter,
    backdrop-filter;
}

/* Reduced motion support for theme switching */
@media (prefers-reduced-motion: reduce) {
  .dn-theme-transition * {
    transition-duration: 1ms !important;
  }
}

/* ==================== COLOR ACCESSIBILITY UTILITIES ==================== */

/* Focus styles with high contrast */
.dn-focus-ring:focus-visible {
  outline: 2px solid var(--border-focus);
  outline-offset: 2px;
  outline-style: solid;
}

/* High contrast focus for Windows */
@media (forced-colors: active) {
  .dn-focus-ring:focus-visible {
    outline-color: Highlight;
    outline-style: auto;
  }
}

/* Color contrast validation classes */
.dn-contrast-warning {
  position: relative;
}

.dn-contrast-warning::after {
  content: "⚠️ Low Contrast";
  position: absolute;
  top: -2px;
  right: -2px;
  background: var(--color-warning);
  color: var(--text-inverse);
  padding: 2px 4px;
  border-radius: var(--radius-sm);
  font-size: var(--text-xs);
  font-weight: var(--font-bold);
  z-index: var(--z-tooltip);
}

/* ==================== OBSIDIAN COLOR INTEGRATION ==================== */

/* Map our semantic colors to Obsidian's variables */
.theme-dark {
  /* Background colors */
  --background-primary: var(--surface-primary);
  --background-primary-alt: var(--surface-secondary);
  --background-secondary: var(--surface-tertiary);
  --background-modifier-border: var(--border-primary);
  --background-modifier-border-hover: var(--border-secondary);
  --background-modifier-border-focus: var(--border-focus);
  
  /* Text colors */
  --text-normal: var(--text-primary);
  --text-muted: var(--text-secondary);
  --text-faint: var(--text-tertiary);
  --text-accent: var(--text-accent);
  --text-on-accent: var(--text-on-accent);
  
  /* Interactive colors */
  --interactive-normal: var(--surface-secondary);
  --interactive-hover: var(--surface-tertiary);
  --interactive-accent: var(--color-primary);
  --interactive-accent-hover: var(--color-primary-dark);
  
  /* Syntax highlighting base */
  --code-normal: var(--text-primary);
  --code-comment: var(--text-tertiary);
  --code-function: var(--color-secondary);
  --code-important: var(--color-warning);
  --code-keyword: var(--color-primary);
  --code-operator: var(--text-secondary);
  --code-property: var(--color-info);
  --code-punctuation: var(--text-secondary);
  --code-string: var(--color-success);
  --code-tag: var(--color-error);
  --code-value: var(--color-tertiary);
}

.theme-light {
  /* Light theme overrides */
  --background-primary: var(--surface-primary);
  --background-primary-alt: var(--surface-secondary);
  --background-secondary: var(--surface-tertiary);
  --background-modifier-border: var(--border-primary);
  --background-modifier-border-hover: var(--border-secondary);
  --background-modifier-border-focus: var(--border-focus);
  
  --text-normal: var(--text-primary);
  --text-muted: var(--text-secondary);
  --text-faint: var(--text-tertiary);
  --text-accent: var(--text-accent);
  --text-on-accent: var(--text-on-accent);
}

/* ==================== COLOR PERFORMANCE OPTIMIZATIONS ==================== */

/* GPU acceleration for gradients and filters */
.dn-gradient-primary,
.dn-gradient-surface {
  transform: translateZ(0);
  will-change: background;
}

/* Reduce repaints for static color elements */
.dn-bg-primary,
.dn-bg-secondary,
.dn-bg-tertiary {
  contain: style;
}

/* ==================== BROWSER-SPECIFIC COLOR FIXES ==================== */

/* Safari color space fixes */
@supports (background: oklch(0% 0 0)) {
  :root {
    --color-space: oklch;
    --color-primary: oklch(65% 0.2 var(--hue-base));
    --color-secondary: oklch(65% 0.2 calc(var(--hue-base) + 60));
    --color-tertiary: oklch(65% 0.2 calc(var(--hue-base) + 120));
  }
}

/* Firefox color-mix fallback */
@-moz-document url-prefix() {
  .dn-bg-primary-ghost {
    background: color-mix(in srgb, var(--color-primary) 10%, transparent);
  }
}

/* IE fallback (though Obsidian doesn't support IE) */
@media all and (-ms-high-contrast: none), (-ms-high-contrast: active) {
  .dn-bg-primary-ghost {
    background: var(--color-primary);
    opacity: 0.1;
  }
}

/* ==================== COLOR DEBUGGING UTILITIES ==================== */

/* Development-only color grid */
.dn-color-grid:not([data-env="production"]) {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: var(--space-md);
  padding: var(--space-md);
  background: var(--surface-tertiary);
  border: 2px dashed var(--border-accent);
}

.dn-color-swatch {
  aspect-ratio: 1;
  border-radius: var(--radius-md);
  display: flex;
  align-items: end;
  justify-content: center;
  padding: var(--space-sm);
  font-size: var(--text-xs);
  font-weight: var(--font-bold);
  color: var(--text-inverse);
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
  position: relative;
  overflow: hidden;
}

.dn-color-swatch::before {
  content: attr(data-variable);
  position: absolute;
  top: var(--space-xs);
  left: var(--space-xs);
  background: rgba(0, 0, 0, 0.7);
  color: white;
  padding: 2px 4px;
  border-radius: var(--radius-sm);
  font-size: 0.625rem;
}

/* ==================== COLOR SCHEME DETECTION ==================== */

/* Auto theme detection */
@media (prefers-color-scheme: light) {
  :root:not([data-theme]) {
    color-scheme: light;
  }
}

@media (prefers-color-scheme: dark) {
  :root:not([data-theme]) {
    color-scheme: dark;
  }
}

/* Force color scheme for printing */
@media print {
  :root {
    color-scheme: light;
  }
  
  .theme-dark {
    --background-primary: white;
    --text-primary: black;
  }
}

/* ==========================================================================
   End of Color System & Theming
   ========================================================================== */
   
   
/* ==========================================================================
   Dark Nebula Theme - Animation & Interaction System
   Version: 3.0.0
   ========================================================================== */

/* ==================== ANIMATION SYSTEM ARCHITECTURE ==================== */

:root {
  /* === TIMING SYSTEM === */
  --duration-instant: 50ms;
  --duration-fast: 150ms;
  --duration-normal: 300ms;
  --duration-slow: 500ms;
  --duration-deliberate: 1000ms;
  
  /* === EASING FUNCTIONS === */
  --ease-linear: linear;
  --ease-in: cubic-bezier(0.4, 0, 1, 1);
  --ease-out: cubic-bezier(0, 0, 0.2, 1);
  --ease-in-out: cubic-bezier(0.4, 0, 0.2, 1);
  --ease-bounce: cubic-bezier(0.68, -0.55, 0.265, 1.55);
  --ease-elastic: cubic-bezier(0.68, -0.5, 0.265, 1.5);
  
  /* === ANIMATION CONSTRAINTS === */
  --max-scale: 1.05;
  --max-rotate: 5deg;
  --max-translate: 8px;
  
  /* === PERFORMANCE SETTINGS === */
  --gpu-acceleration: translateZ(0);
  --will-change-default: transform, opacity;
}

/* ==================== ANIMATION PROPERTIES SYSTEM ==================== */

/* CSS Properties for complex animations */
@property --animation-progress {
  syntax: '<number>';
  inherits: false;
  initial-value: 0;
}

@property --ripple-scale {
  syntax: '<number>';
  inherits: false;
  initial-value: 0;
}

@property --pulse-opacity {
  syntax: '<number>';
  inherits: false;
  initial-value: 0;
}

/* ==================== CORE ANIMATION KEYFRAMES ==================== */

/* Micro-interactions */
@keyframes dn-fade-in {
  from {
    opacity: 0;
    transform: translateY(var(--max-translate));
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes dn-fade-out {
  from {
    opacity: 1;
    transform: translateY(0);
  }
  to {
    opacity: 0;
    transform: translateY(calc(-1 * var(--max-translate)));
  }
}

@keyframes dn-scale-in {
  from {
    opacity: 0;
    transform: scale(0.9);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

@keyframes dn-slide-in-right {
  from {
    opacity: 0;
    transform: translateX(var(--max-translate));
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes dn-slide-in-left {
  from {
    opacity: 0;
    transform: translateX(calc(-1 * var(--max-translate)));
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

/* Feedback animations */
@keyframes dn-pulse-subtle {
  0%, 100% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.02);
  }
}

@keyframes dn-shake {
  0%, 100% {
    transform: translateX(0);
  }
  25% {
    transform: translateX(-2px);
  }
  75% {
    transform: translateX(2px);
  }
}

@keyframes dn-bounce-subtle {
  0%, 20%, 53%, 80%, 100% {
    transform: translate3d(0, 0, 0);
  }
  40%, 43% {
    transform: translate3d(0, -3px, 0);
  }
  70% {
    transform: translate3d(0, -1px, 0);
  }
}

/* Loading animations */
@keyframes dn-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@keyframes dn-pulse-dot {
  0%, 80%, 100% {
    transform: scale(0);
    opacity: 0.5;
  }
  40% {
    transform: scale(1);
    opacity: 1;
  }
}

/* Ripple effect */
@keyframes dn-ripple {
  to {
    transform: scale(4);
    opacity: 0;
  }
}

/* ==================== ANIMATION UTILITY CLASSES ==================== */

/* Entrance animations */
.dn-animate-fade-in {
  animation: dn-fade-in var(--duration-normal) var(--ease-out);
  animation-fill-mode: both;
}

.dn-animate-scale-in {
  animation: dn-scale-in var(--duration-normal) var(--ease-out);
  animation-fill-mode: both;
}

.dn-animate-slide-in-right {
  animation: dn-slide-in-right var(--duration-normal) var(--ease-out);
  animation-fill-mode: both;
}

.dn-animate-slide-in-left {
  animation: dn-slide-in-left var(--duration-normal) var(--ease-out);
  animation-fill-mode: both;
}

/* Feedback animations */
.dn-animate-pulse-subtle {
  animation: dn-pulse-subtle var(--duration-slow) var(--ease-in-out) infinite;
}

.dn-animate-shake {
  animation: dn-shake var(--duration-normal) var(--ease-out);
}

.dn-animate-bounce-subtle {
  animation: dn-bounce-subtle var(--duration-slow) var(--ease-bounce) infinite;
}

/* Loading states */
.dn-animate-spin {
  animation: dn-spin 1s var(--ease-linear) infinite;
  transform-origin: center;
}

.dn-loading-dots {
  display: inline-flex;
  gap: 2px;
}

.dn-loading-dots span {
  animation: dn-pulse-dot 1.4s var(--ease-in-out) infinite both;
  width: 4px;
  height: 4px;
  border-radius: 50%;
  background: currentColor;
}

.dn-loading-dots span:nth-child(1) { animation-delay: -0.32s; }
.dn-loading-dots span:nth-child(2) { animation-delay: -0.16s; }

/* ==================== INTERACTIVE COMPONENTS ==================== */

/* Enhanced button interactions */
.dn-btn {
  position: relative;
  overflow: hidden;
  transform: var(--gpu-acceleration);
  transition: 
    transform var(--duration-fast) var(--ease-out),
    background-color var(--duration-fast) var(--ease-out),
    border-color var(--duration-fast) var(--ease-out),
    color var(--duration-fast) var(--ease-out),
    box-shadow var(--duration-fast) var(--ease-out);
}

.dn-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    90deg,
    transparent,
    rgba(255, 255, 255, 0.1),
    transparent
  );
  transition: left var(--duration-slow) var(--ease-out);
}

.dn-btn:hover::before {
  left: 100%;
}

.dn-btn:active {
  transform: scale(0.98) var(--gpu-acceleration);
  transition-duration: var(--duration-instant);
}

/* Ripple effect for buttons */
.dn-ripple {
  position: absolute;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.6);
  transform: scale(0);
  animation: dn-ripple var(--duration-normal) var(--ease-out);
  pointer-events: none;
}

/* Card interactions */
.dn-card {
  transition: 
    transform var(--duration-normal) var(--ease-out),
    box-shadow var(--duration-normal) var(--ease-out),
    border-color var(--duration-normal) var(--ease-out);
  transform: var(--gpu-acceleration);
  will-change: var(--will-change-default);
}

.dn-card:hover {
  transform: translateY(-2px) var(--gpu-acceleration);
  box-shadow: 
    var(--shadow-lg),
    0 8px 25px rgba(0, 0, 0, 0.15);
}

.dn-card:active {
  transform: translateY(0) var(--gpu-acceleration);
  transition-duration: var(--duration-instant);
}

/* Input focus animations */
.dn-input {
  transition: 
    border-color var(--duration-fast) var(--ease-out),
    box-shadow var(--duration-fast) var(--ease-out);
}

.dn-input:focus {
  border-color: var(--border-focus);
  box-shadow: 0 0 0 3px color-mix(in srgb, var(--color-primary) 20%, transparent);
  animation: dn-pulse-subtle var(--duration-slow) var(--ease-out);
}

/* ==================== SCROLL-BASED ANIMATIONS ==================== */

/* Scroll-triggered animations with fallbacks */
.dn-scroll-reveal {
  opacity: 0;
  transform: translateY(30px);
  transition: 
    opacity var(--duration-slow) var(--ease-out),
    transform var(--duration-slow) var(--ease-out);
}

.dn-scroll-reveal.revealed {
  opacity: 1;
  transform: translateY(0);
}

/* Smooth scrolling for the entire app */
.workspace,
.cm-scroller,
.markdown-preview-view {
  scroll-behavior: smooth;
}

/* Custom scrollbar animations */
.cm-scroller::-webkit-scrollbar-thumb {
  transition: 
    background-color var(--duration-fast) var(--ease-out),
    transform var(--duration-fast) var(--ease-out);
}

.cm-scroller::-webkit-scrollbar-thumb:hover {
  background-color: var(--border-accent);
  transform: scaleX(1.1);
}

/* ==================== MICRO-INTERACTION SYSTEM ==================== */

/* Hover lift effect */
.dn-hover-lift {
  transition: transform var(--duration-fast) var(--ease-out);
}

.dn-hover-lift:hover {
  transform: translateY(-1px) var(--gpu-acceleration);
}

/* Press down effect */
.dn-press-down:active {
  transform: translateY(1px) var(--gpu-acceleration);
}

/* Focus glow effect */
.dn-focus-glow:focus-visible {
  outline: none;
  box-shadow: 
    0 0 0 2px var(--surface-primary),
    0 0 0 4px var(--border-focus);
  animation: dn-pulse-subtle var(--duration-slow) var(--ease-out);
}

/* Staggered animations for lists */
.dn-stagger-item {
  opacity: 0;
  transform: translateY(20px);
  animation: dn-fade-in var(--duration-normal) var(--ease-out) forwards;
}

/* ==================== ANIMATION PERFORMANCE OPTIMIZATIONS ==================== */

/* Only enable animations when not in reduced motion */
@media (prefers-reduced-motion: no-preference) {
  .dn-animate-fade-in,
  .dn-animate-scale-in,
  .dn-animate-slide-in-right,
  .dn-animate-slide-in-left {
    animation-duration: var(--duration-normal);
  }
  
  .dn-btn,
  .dn-card {
    transition-duration: var(--duration-fast);
  }
}

/* GPU acceleration for complex animations */
.dn-gpu-accelerated {
  transform: var(--gpu-acceleration);
  backface-visibility: hidden;
  perspective: 1000px;
}

/* Containment for animated elements */
.dn-animated {
  contain: layout style;
  will-change: var(--will-change-default);
}

/* ==================== ACCESSIBILITY IN ANIMATIONS ==================== */

/* Respect reduced motion preferences */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
  
  .dn-btn::before,
  .dn-ripple {
    display: none !important;
  }
  
  .dn-btn:hover,
  .dn-card:hover {
    transform: none !important;
  }
}

/* High contrast mode adjustments */
@media (forced-colors: active) {
  .dn-btn::before,
  .dn-ripple {
    display: none;
  }
  
  .dn-focus-glow:focus-visible {
    box-shadow: 0 0 0 2px Highlight;
    outline: 2px solid transparent;
  }
}

/* ==================== ANIMATION BUG FIXES ==================== */

/* Fix for Safari transform z-index issues */
.dn-btn,
.dn-card {
  -webkit-transform-style: preserve-3d;
  transform-style: preserve-3d;
}

/* Fix for Chrome animation flicker */
.dn-gpu-accelerated {
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
  -webkit-perspective: 1000px;
  perspective: 1000px;
}

/* Fix for Firefox transition on hidden elements */
.dn-btn[hidden],
.dn-card[hidden] {
  display: none !important;
}

/* Fix for iOS touch delay */
.dn-btn,
.dn-card {
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
}

/* Fix for animation jank during scroll */
.dn-scroll-reveal {
  will-change: transform, opacity;
}

/* ==================== INTERACTION STATES ==================== */

/* Loading state */
.dn-loading {
  pointer-events: none;
  opacity: 0.7;
  position: relative;
}

.dn-loading::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 16px;
  height: 16px;
  margin: -8px 0 0 -8px;
  border: 2px solid transparent;
  border-top: 2px solid currentColor;
  border-radius: 50%;
  animation: dn-spin 1s var(--ease-linear) infinite;
}

/* Disabled state */
.dn-disabled {
  opacity: 0.5;
  pointer-events: none;
  filter: grayscale(0.5);
}

/* Active state with ripple */
.dn-active {
  position: relative;
  overflow: hidden;
}

.dn-active::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: currentColor;
  opacity: 0.1;
  border-radius: inherit;
}

/* ==================== ADVANCED ANIMATION PATTERNS ==================== */

/* Morphing animations with CSS properties */
.dn-morph {
  --morph-progress: 0;
  transition: 
    --morph-progress var(--duration-normal) var(--ease-in-out),
    border-radius var(--duration-normal) var(--ease-in-out);
}

/* Staggered children animations */
.dn-stagger-container > * {
  opacity: 0;
  transform: translateY(20px);
  animation: dn-fade-in var(--duration-normal) var(--ease-out) forwards;
}

.dn-stagger-container > *:nth-child(1) { animation-delay: 0ms; }
.dn-stagger-container > *:nth-child(2) { animation-delay: 50ms; }
.dn-stagger-container > *:nth-child(3) { animation-delay: 100ms; }
.dn-stagger-container > *:nth-child(4) { animation-delay: 150ms; }
.dn-stagger-container > *:nth-child(5) { animation-delay: 200ms; }

/* Typewriter effect */
.dn-typewriter {
  overflow: hidden;
  border-right: 2px solid var(--color-primary);
  white-space: nowrap;
  animation: 
    dn-typewriter 3s steps(40, end) var(--ease-in-out),
    dn-blink-caret 0.75s step-end infinite;
}

@keyframes dn-typewriter {
  from { width: 0; }
  to { width: 100%; }
}

@keyframes dn-blink-caret {
  from, to { border-color: transparent; }
  50% { border-color: var(--color-primary); }
}

/* ==================== ANIMATION DEBUGGING UTILITIES ==================== */

/* Development-only animation controls */
.dn-animation-debug:not([data-env="production"]) {
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: var(--z-tooltip);
  background: var(--surface-primary);
  border: 1px solid var(--border-accent);
  border-radius: var(--radius-md);
  padding: var(--space-sm);
  font-size: var(--text-xs);
}

.dn-animation-debug input[type="range"] {
  width: 100px;
}

/* ==========================================================================
   End of Animation & Interaction System
   ========================================================================== */
   
/* ==========================================================================
   Dark Nebula Theme - Utility & Helper System
   Version: 3.0.0
   ========================================================================== */

/* ==================== UTILITY SYSTEM ARCHITECTURE ==================== */

:root {
  /* === UTILITY SPECIFICITY MANAGEMENT === */
  --utility-important: !important;
  --utility-prefix: 'dn-';
  
  /* === RESPONSIVE BREAKPOINTS === */
  --breakpoint-sm: 640px;
  --breakpoint-md: 768px;
  --breakpoint-lg: 1024px;
  --breakpoint-xl: 1280px;
  --breakpoint-2xl: 1536px;
  
  /* === Z-INDEX LAYERS === */
  --z-auto: auto;
  --z-0: 0;
  --z-10: 10;
  --z-20: 20;
  --z-30: 30;
  --z-40: 40;
  --z-50: 50;
}

/* ==================== SPACING UTILITIES ==================== */

/* Margin utilities with logical properties */
.dn-m-0 { margin: 0 var(--utility-important); }
.dn-m-xs { margin: var(--space-xs) var(--utility-important); }
.dn-m-sm { margin: var(--space-sm) var(--utility-important); }
.dn-m-md { margin: var(--space-md) var(--utility-important); }
.dn-m-lg { margin: var(--space-lg) var(--utility-important); }
.dn-m-xl { margin: var(--space-xl) var(--utility-important); }
.dn-m-auto { margin: auto var(--utility-important); }

/* Margin - Logical directions */
.dn-m-inline-0 { margin-inline: 0 var(--utility-important); }
.dn-m-inline-xs { margin-inline: var(--space-xs) var(--utility-important); }
.dn-m-inline-auto { margin-inline: auto var(--utility-important); }

.dn-m-block-0 { margin-block: 0 var(--utility-important); }
.dn-m-block-xs { margin-block: var(--space-xs) var(--utility-important); }
.dn-m-block-auto { margin-block: auto var(--utility-important); }

/* Margin - Individual sides with fallbacks */
.dn-mt-0 { margin-top: 0 var(--utility-important); }
.dn-mt-xs { margin-top: var(--space-xs) var(--utility-important); }
.dn-mt-sm { margin-top: var(--space-sm) var(--utility-important); }
.dn-mt-md { margin-top: var(--space-md) var(--utility-important); }
.dn-mt-lg { margin-top: var(--space-lg) var(--utility-important); }
.dn-mt-auto { margin-top: auto var(--utility-important); }

.dn-mr-0 { margin-right: 0 var(--utility-important); }
.dn-mr-xs { margin-right: var(--space-xs) var(--utility-important); }
.dn-mr-sm { margin-right: var(--space-sm) var(--utility-important); }
.dn-mr-md { margin-right: var(--space-md) var(--utility-important); }
.dn-mr-lg { margin-right: var(--space-lg) var(--utility-important); }
.dn-mr-auto { margin-right: auto var(--utility-important); }

.dn-mb-0 { margin-bottom: 0 var(--utility-important); }
.dn-mb-xs { margin-bottom: var(--space-xs) var(--utility-important); }
.dn-mb-sm { margin-bottom: var(--space-sm) var(--utility-important); }
.dn-mb-md { margin-bottom: var(--space-md) var(--utility-important); }
.dn-mb-lg { margin-bottom: var(--space-lg) var(--utility-important); }
.dn-mb-auto { margin-bottom: auto var(--utility-important); }

.dn-ml-0 { margin-left: 0 var(--utility-important); }
.dn-ml-xs { margin-left: var(--space-xs) var(--utility-important); }
.dn-ml-sm { margin-left: var(--space-sm) var(--utility-important); }
.dn-ml-md { margin-left: var(--space-md) var(--utility-important); }
.dn-ml-lg { margin-left: var(--space-lg) var(--utility-important); }
.dn-ml-auto { margin-left: auto var(--utility-important); }

/* Padding utilities */
.dn-p-0 { padding: 0 var(--utility-important); }
.dn-p-xs { padding: var(--space-xs) var(--utility-important); }
.dn-p-sm { padding: var(--space-sm) var(--utility-important); }
.dn-p-md { padding: var(--space-md) var(--utility-important); }
.dn-p-lg { padding: var(--space-lg) var(--utility-important); }
.dn-p-xl { padding: var(--space-xl) var(--utility-important); }

/* Padding - Logical directions */
.dn-p-inline-0 { padding-inline: 0 var(--utility-important); }
.dn-p-inline-xs { padding-inline: var(--space-xs) var(--utility-important); }
.dn-p-inline-sm { padding-inline: var(--space-sm) var(--utility-important); }
.dn-p-inline-md { padding-inline: var(--space-md) var(--utility-important); }

.dn-p-block-0 { padding-block: 0 var(--utility-important); }
.dn-p-block-xs { padding-block: var(--space-xs) var(--utility-important); }
.dn-p-block-sm { padding-block: var(--space-sm) var(--utility-important); }
.dn-p-block-md { padding-block: var(--space-md) var(--utility-important); }

/* Gap utilities */
.dn-gap-0 { gap: 0 var(--utility-important); }
.dn-gap-xs { gap: var(--space-xs) var(--utility-important); }
.dn-gap-sm { gap: var(--space-sm) var(--utility-important); }
.dn-gap-md { gap: var(--space-md) var(--utility-important); }
.dn-gap-lg { gap: var(--space-lg) var(--utility-important); }

/* ==================== TYPOGRAPHY UTILITIES ==================== */

/* Font family utilities */
.dn-font-sans { font-family: var(--font-sans) var(--utility-important); }
.dn-font-serif { font-family: var(--font-serif) var(--utility-important); }
.dn-font-mono { font-family: var(--font-mono) var(--utility-important); }

/* Font size utilities */
.dn-text-xs { font-size: var(--text-xs) var(--utility-important); }
.dn-text-sm { font-size: var(--text-sm) var(--utility-important); }
.dn-text-base { font-size: var(--text-base) var(--utility-important); }
.dn-text-lg { font-size: var(--text-lg) var(--utility-important); }
.dn-text-xl { font-size: var(--text-xl) var(--utility-important); }
.dn-text-2xl { font-size: var(--text-2xl) var(--utility-important); }
.dn-text-3xl { font-size: var(--text-3xl) var(--utility-important); }

/* Font weight utilities */
.dn-font-thin { font-weight: var(--font-thin) var(--utility-important); }
.dn-font-light { font-weight: var(--font-light) var(--utility-important); }
.dn-font-normal { font-weight: var(--font-normal) var(--utility-important); }
.dn-font-medium { font-weight: var(--font-medium) var(--utility-important); }
.dn-font-semibold { font-weight: var(--font-semibold) var(--utility-important); }
.dn-font-bold { font-weight: var(--font-bold) var(--utility-important); }
.dn-font-extrabold { font-weight: var(--font-extrabold) var(--utility-important); }

/* Line height utilities */
.dn-leading-none { line-height: var(--leading-none) var(--utility-important); }
.dn-leading-tight { line-height: var(--leading-tight) var(--utility-important); }
.dn-leading-snug { line-height: var(--leading-snug) var(--utility-important); }
.dn-leading-normal { line-height: var(--leading-normal) var(--utility-important); }
.dn-leading-relaxed { line-height: var(--leading-relaxed) var(--utility-important); }
.dn-leading-loose { line-height: var(--leading-loose) var(--utility-important); }

/* Text alignment utilities */
.dn-text-left { text-align: left var(--utility-important); }
.dn-text-center { text-align: center var(--utility-important); }
.dn-text-right { text-align: right var(--utility-important); }
.dn-text-justify { text-align: justify var(--utility-important); }
.dn-text-start { text-align: start var(--utility-important); }
.dn-text-end { text-align: end var(--utility-important); }

/* Text color utilities */
.dn-text-primary { color: var(--text-primary) var(--utility-important); }
.dn-text-secondary { color: var(--text-secondary) var(--utility-important); }
.dn-text-tertiary { color: var(--text-tertiary) var(--utility-important); }
.dn-text-accent { color: var(--text-accent) var(--utility-important); }
.dn-text-inverse { color: var(--text-inverse) var(--utility-important); }
.dn-text-success { color: var(--color-success) var(--utility-important); }
.dn-text-warning { color: var(--color-warning) var(--utility-important); }
.dn-text-error { color: var(--color-error) var(--utility-important); }
.dn-text-info { color: var(--color-info) var(--utility-important); }

/* Text decoration utilities */
.dn-underline { text-decoration: underline var(--utility-important); }
.dn-line-through { text-decoration: line-through var(--utility-important); }
.dn-no-underline { text-decoration: none var(--utility-important); }

/* Text transform utilities */
.dn-uppercase { text-transform: uppercase var(--utility-important); }
.dn-lowercase { text-transform: lowercase var(--utility-important); }
.dn-capitalize { text-transform: capitalize var(--utility-important); }
.dn-normal-case { text-transform: none var(--utility-important); }

/* Text overflow utilities */
.dn-truncate {
  overflow: hidden var(--utility-important);
  text-overflow: ellipsis var(--utility-important);
  white-space: nowrap var(--utility-important);
}

.dn-text-ellipsis {
  text-overflow: ellipsis var(--utility-important);
}

.dn-text-clip {
  text-overflow: clip var(--utility-important);
}

/* White space utilities */
.dn-whitespace-normal { white-space: normal var(--utility-important); }
.dn-whitespace-nowrap { white-space: nowrap var(--utility-important); }
.dn-whitespace-pre { white-space: pre var(--utility-important); }
.dn-whitespace-pre-line { white-space: pre-line var(--utility-important); }
.dn-whitespace-pre-wrap { white-space: pre-wrap var(--utility-important); }

/* Word break utilities */
.dn-break-normal {
  overflow-wrap: normal var(--utility-important);
  word-break: normal var(--utility-important);
}

.dn-break-words {
  overflow-wrap: break-word var(--utility-important);
}

.dn-break-all {
  word-break: break-all var(--utility-important);
}

.dn-break-keep {
  word-break: keep-all var(--utility-important);
}

/* ==================== LAYOUT UTILITIES ==================== */

/* Display utilities */
.dn-block { display: block var(--utility-important); }
.dn-inline-block { display: inline-block var(--utility-important); }
.dn-inline { display: inline var(--utility-important); }
.dn-flex { display: flex var(--utility-important); }
.dn-inline-flex { display: inline-flex var(--utility-important); }
.dn-grid { display: grid var(--utility-important); }
.dn-inline-grid { display: inline-grid var(--utility-important); }
.dn-contents { display: contents var(--utility-important); }
.dn-list-item { display: list-item var(--utility-important); }
.dn-hidden { display: none var(--utility-important); }

/* Position utilities */
.dn-static { position: static var(--utility-important); }
.dn-fixed { position: fixed var(--utility-important); }
.dn-absolute { position: absolute var(--utility-important); }
.dn-relative { position: relative var(--utility-important); }
.dn-sticky { position: sticky var(--utility-important); }

/* Position values */
.dn-inset-0 { inset: 0 var(--utility-important); }
.dn-inset-auto { inset: auto var(--utility-important); }

.dn-top-0 { top: 0 var(--utility-important); }
.dn-top-auto { top: auto var(--utility-important); }
.dn-right-0 { right: 0 var(--utility-important); }
.dn-right-auto { right: auto var(--utility-important); }
.dn-bottom-0 { bottom: 0 var(--utility-important); }
.dn-bottom-auto { bottom: auto var(--utility-important); }
.dn-left-0 { left: 0 var(--utility-important); }
.dn-left-auto { left: auto var(--utility-important); }

/* Z-index utilities */
.dn-z-auto { z-index: var(--z-auto) var(--utility-important); }
.dn-z-0 { z-index: var(--z-0) var(--utility-important); }
.dn-z-10 { z-index: var(--z-10) var(--utility-important); }
.dn-z-20 { z-index: var(--z-20) var(--utility-important); }
.dn-z-30 { z-index: var(--z-30) var(--utility-important); }
.dn-z-40 { z-index: var(--z-40) var(--utility-important); }
.dn-z-50 { z-index: var(--z-50) var(--utility-important); }

/* ==================== FLEXBOX UTILITIES ==================== */

/* Flex direction */
.dn-flex-row { flex-direction: row var(--utility-important); }
.dn-flex-row-reverse { flex-direction: row-reverse var(--utility-important); }
.dn-flex-col { flex-direction: column var(--utility-important); }
.dn-flex-col-reverse { flex-direction: column-reverse var(--utility-important); }

/* Flex wrapping */
.dn-flex-wrap { flex-wrap: wrap var(--utility-important); }
.dn-flex-nowrap { flex-wrap: nowrap var(--utility-important); }
.dn-flex-wrap-reverse { flex-wrap: wrap-reverse var(--utility-important); }

/* Flex properties */
.dn-flex-1 { flex: 1 1 0% var(--utility-important); }
.dn-flex-auto { flex: 1 1 auto var(--utility-important); }
.dn-flex-initial { flex: 0 1 auto var(--utility-important); }
.dn-flex-none { flex: none var(--utility-important); }

.dn-flex-grow { flex-grow: 1 var(--utility-important); }
.dn-flex-grow-0 { flex-grow: 0 var(--utility-important); }
.dn-flex-shrink { flex-shrink: 1 var(--utility-important); }
.dn-flex-shrink-0 { flex-shrink: 0 var(--utility-important); }

/* Justify content */
.dn-justify-start { justify-content: flex-start var(--utility-important); }
.dn-justify-end { justify-content: flex-end var(--utility-important); }
.dn-justify-center { justify-content: center var(--utility-important); }
.dn-justify-between { justify-content: space-between var(--utility-important); }
.dn-justify-around { justify-content: space-around var(--utility-important); }
.dn-justify-evenly { justify-content: space-evenly var(--utility-important); }

/* Align items */
.dn-items-start { align-items: flex-start var(--utility-important); }
.dn-items-end { align-items: flex-end var(--utility-important); }
.dn-items-center { align-items: center var(--utility-important); }
.dn-items-baseline { align-items: baseline var(--utility-important); }
.dn-items-stretch { align-items: stretch var(--utility-important); }

/* Align self */
.dn-self-auto { align-self: auto var(--utility-important); }
.dn-self-start { align-self: flex-start var(--utility-important); }
.dn-self-end { align-self: flex-end var(--utility-important); }
.dn-self-center { align-self: center var(--utility-important); }
.dn-self-stretch { align-self: stretch var(--utility-important); }
.dn-self-baseline { align-self: baseline var(--utility-important); }

/* ==================== GRID UTILITIES ==================== */

/* Grid template columns */
.dn-grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)) var(--utility-important); }
.dn-grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)) var(--utility-important); }
.dn-grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)) var(--utility-important); }
.dn-grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)) var(--utility-important); }
.dn-grid-cols-5 { grid-template-columns: repeat(5, minmax(0, 1fr)) var(--utility-important); }
.dn-grid-cols-6 { grid-template-columns: repeat(6, minmax(0, 1fr)) var(--utility-important); }
.dn-grid-cols-7 { grid-template-columns: repeat(7, minmax(0, 1fr)) var(--utility-important); }
.dn-grid-cols-8 { grid-template-columns: repeat(8, minmax(0, 1fr)) var(--utility-important); }
.dn-grid-cols-9 { grid-template-columns: repeat(9, minmax(0, 1fr)) var(--utility-important); }
.dn-grid-cols-10 { grid-template-columns: repeat(10, minmax(0, 1fr)) var(--utility-important); }
.dn-grid-cols-11 { grid-template-columns: repeat(11, minmax(0, 1fr)) var(--utility-important); }
.dn-grid-cols-12 { grid-template-columns: repeat(12, minmax(0, 1fr)) var(--utility-important); }
.dn-grid-cols-none { grid-template-columns: none var(--utility-important); }

/* Grid column span */
.dn-col-auto { grid-column: auto var(--utility-important); }
.dn-col-span-full { grid-column: 1 / -1 var(--utility-important); }

/* Grid template rows */
.dn-grid-rows-1 { grid-template-rows: repeat(1, minmax(0, 1fr)) var(--utility-important); }
.dn-grid-rows-2 { grid-template-rows: repeat(2, minmax(0, 1fr)) var(--utility-important); }
.dn-grid-rows-3 { grid-template-rows: repeat(3, minmax(0, 1fr)) var(--utility-important); }
.dn-grid-rows-4 { grid-template-rows: repeat(4, minmax(0, 1fr)) var(--utility-important); }
.dn-grid-rows-5 { grid-template-rows: repeat(5, minmax(0, 1fr)) var(--utility-important); }
.dn-grid-rows-6 { grid-template-rows: repeat(6, minmax(0, 1fr)) var(--utility-important); }
.dn-grid-rows-none { grid-template-rows: none var(--utility-important); }

/* Grid row span */
.dn-row-auto { grid-row: auto var(--utility-important); }
.dn-row-span-full { grid-row: 1 / -1 var(--utility-important); }

/* Grid auto flow */
.dn-grid-flow-row { grid-auto-flow: row var(--utility-important); }
.dn-grid-flow-col { grid-auto-flow: column var(--utility-important); }
.dn-grid-flow-dense { grid-auto-flow: dense var(--utility-important); }
.dn-grid-flow-row-dense { grid-auto-flow: row dense var(--utility-important); }
.dn-grid-flow-col-dense { grid-auto-flow: column dense var(--utility-important); }

/* ==================== BACKGROUND UTILITIES ==================== */

/* Background color utilities */
.dn-bg-transparent { background-color: transparent var(--utility-important); }
.dn-bg-primary { background-color: var(--surface-primary) var(--utility-important); }
.dn-bg-secondary { background-color: var(--surface-secondary) var(--utility-important); }
.dn-bg-tertiary { background-color: var(--surface-tertiary) var(--utility-important); }
.dn-bg-accent { background-color: var(--surface-accent) var(--utility-important); }
.dn-bg-elevated { background-color: var(--surface-elevated) var(--utility-important); }

.dn-bg-success { background-color: var(--color-success) var(--utility-important); }
.dn-bg-warning { background-color: var(--color-warning) var(--utility-important); }
.dn-bg-error { background-color: var(--color-error) var(--utility-important); }
.dn-bg-info { background-color: var(--color-info) var(--utility-important); }

/* Background ghost variants */
.dn-bg-primary-ghost { background-color: var(--color-primary-ghost) var(--utility-important); }
.dn-bg-success-ghost { background-color: var(--color-success-ghost) var(--utility-important); }
.dn-bg-warning-ghost { background-color: var(--color-warning-ghost) var(--utility-important); }
.dn-bg-error-ghost { background-color: var(--color-error-ghost) var(--utility-important); }
.dn-bg-info-ghost { background-color: var(--color-info-ghost) var(--utility-important); }

/* Background size utilities */
.dn-bg-auto { background-size: auto var(--utility-important); }
.dn-bg-cover { background-size: cover var(--utility-important); }
.dn-bg-contain { background-size: contain var(--utility-important); }

/* Background position utilities */
.dn-bg-center { background-position: center var(--utility-important); }
.dn-bg-top { background-position: top var(--utility-important); }
.dn-bg-right { background-position: right var(--utility-important); }
.dn-bg-bottom { background-position: bottom var(--utility-important); }
.dn-bg-left { background-position: left var(--utility-important); }

/* Background repeat utilities */
.dn-bg-repeat { background-repeat: repeat var(--utility-important); }
.dn-bg-no-repeat { background-repeat: no-repeat var(--utility-important); }
.dn-bg-repeat-x { background-repeat: repeat-x var(--utility-important); }
.dn-bg-repeat-y { background-repeat: repeat-y var(--utility-important); }
.dn-bg-repeat-round { background-repeat: round var(--utility-important); }
.dn-bg-repeat-space { background-repeat: space var(--utility-important); }

/* ==================== BORDER UTILITIES ==================== */

/* Border style utilities */
.dn-border-solid { border-style: solid var(--utility-important); }
.dn-border-dashed { border-style: dashed var(--utility-important); }
.dn-border-dotted { border-style: dotted var(--utility-important); }
.dn-border-double { border-style: double var(--utility-important); }
.dn-border-none { border-style: none var(--utility-important); }

/* Border width utilities */
.dn-border-0 { border-width: 0 var(--utility-important); }
.dn-border { border-width: 1px var(--utility-important); }
.dn-border-2 { border-width: 2px var(--utility-important); }
.dn-border-4 { border-width: 4px var(--utility-important); }
.dn-border-8 { border-width: 8px var(--utility-important); }

/* Border color utilities */
.dn-border-transparent { border-color: transparent var(--utility-important); }
.dn-border-primary { border-color: var(--border-primary) var(--utility-important); }
.dn-border-secondary { border-color: var(--border-secondary) var(--utility-important); }
.dn-border-accent { border-color: var(--border-accent) var(--utility-important); }
.dn-border-focus { border-color: var(--border-focus) var(--utility-important); }

/* Border radius utilities */
.dn-rounded-none { border-radius: 0 var(--utility-important); }
.dn-rounded-sm { border-radius: var(--radius-sm) var(--utility-important); }
.dn-rounded { border-radius: var(--radius-md) var(--utility-important); }
.dn-rounded-md { border-radius: var(--radius-md) var(--utility-important); }
.dn-rounded-lg { border-radius: var(--radius-lg) var(--utility-important); }
.dn-rounded-xl { border-radius: var(--radius-xl) var(--utility-important); }
.dn-rounded-2xl { border-radius: var(--radius-2xl) var(--utility-important); }
.dn-rounded-full { border-radius: 50% var(--utility-important); }

/* Individual border radius */
.dn-rounded-t-none { border-top-left-radius: 0 var(--utility-important); border-top-right-radius: 0 var(--utility-important); }
.dn-rounded-r-none { border-top-right-radius: 0 var(--utility-important); border-bottom-right-radius: 0 var(--utility-important); }
.dn-rounded-b-none { border-bottom-right-radius: 0 var(--utility-important); border-bottom-left-radius: 0 var(--utility-important); }
.dn-rounded-l-none { border-top-left-radius: 0 var(--utility-important); border-bottom-left-radius: 0 var(--utility-important); }

/* ==================== EFFECT UTILITIES ==================== */

/* Opacity utilities */
.dn-opacity-0 { opacity: 0 var(--utility-important); }
.dn-opacity-5 { opacity: 0.05 var(--utility-important); }
.dn-opacity-10 { opacity: 0.1 var(--utility-important); }
.dn-opacity-20 { opacity: 0.2 var(--utility-important); }
.dn-opacity-25 { opacity: 0.25 var(--utility-important); }
.dn-opacity-30 { opacity: 0.3 var(--utility-important); }
.dn-opacity-40 { opacity: 0.4 var(--utility-important); }
.dn-opacity-50 { opacity: 0.5 var(--utility-important); }
.dn-opacity-60 { opacity: 0.6 var(--utility-important); }
.dn-opacity-70 { opacity: 0.7 var(--utility-important); }
.dn-opacity-75 { opacity: 0.75 var(--utility-important); }
.dn-opacity-80 { opacity: 0.8 var(--utility-important); }
.dn-opacity-90 { opacity: 0.9 var(--utility-important); }
.dn-opacity-95 { opacity: 0.95 var(--utility-important); }
.dn-opacity-100 { opacity: 1 var(--utility-important); }

/* Shadow utilities */
.dn-shadow-none { box-shadow: none var(--utility-important); }
.dn-shadow-sm { box-shadow: var(--shadow-sm) var(--utility-important); }
.dn-shadow { box-shadow: var(--shadow-md) var(--utility-important); }
.dn-shadow-md { box-shadow: var(--shadow-md) var(--utility-important); }
.dn-shadow-lg { box-shadow: var(--shadow-lg) var(--utility-important); }
.dn-shadow-xl { box-shadow: var(--shadow-xl) var(--utility-important); }

/* Blend mode utilities */
.dn-blend-normal { mix-blend-mode: normal var(--utility-important); }
.dn-blend-multiply { mix-blend-mode: multiply var(--utility-important); }
.dn-blend-screen { mix-blend-mode: screen var(--utility-important); }
.dn-blend-overlay { mix-blend-mode: overlay var(--utility-important); }
.dn-blend-darken { mix-blend-mode: darken var(--utility-important); }
.dn-blend-lighten { mix-blend-mode: lighten var(--utility-important); }

/* Filter utilities */
.dn-filter-none { filter: none var(--utility-important); }
.dn-blur-none { filter: blur(0) var(--utility-important); }
.dn-blur-sm { filter: blur(4px) var(--utility-important); }
.dn-blur { filter: blur(8px) var(--utility-important); }
.dn-blur-md { filter: blur(12px) var(--utility-important); }
.dn-blur-lg { filter: blur(16px) var(--utility-important); }
.dn-blur-xl { filter: blur(24px) var(--utility-important); }

/* Backdrop filter utilities */
.dn-backdrop-blur-none { backdrop-filter: blur(0) var(--utility-important); }
.dn-backdrop-blur-sm { backdrop-filter: blur(4px) var(--utility-important); }
.dn-backdrop-blur { backdrop-filter: blur(8px) var(--utility-important); }
.dn-backdrop-blur-md { backdrop-filter: blur(12px) var(--utility-important); }
.dn-backdrop-blur-lg { backdrop-filter: blur(16px) var(--utility-important); }
.dn-backdrop-blur-xl { backdrop-filter: blur(24px) var(--utility-important); }

/* ==================== INTERACTION UTILITIES ==================== */

/* Pointer events utilities */
.dn-pointer-events-none { pointer-events: none var(--utility-important); }
.dn-pointer-events-auto { pointer-events: auto var(--utility-important); }

/* User select utilities */
.dn-select-none { user-select: none var(--utility-important); }
.dn-select-text { user-select: text var(--utility-important); }
.dn-select-all { user-select: all var(--utility-important); }
.dn-select-auto { user-select: auto var(--utility-important); }

/* Cursor utilities */
.dn-cursor-auto { cursor: auto var(--utility-important); }
.dn-cursor-default { cursor: default var(--utility-important); }
.dn-cursor-pointer { cursor: pointer var(--utility-important); }
.dn-cursor-wait { cursor: wait var(--utility-important); }
.dn-cursor-text { cursor: text var(--utility-important); }
.dn-cursor-move { cursor: move var(--utility-important); }
.dn-cursor-help { cursor: help var(--utility-important); }
.dn-cursor-not-allowed { cursor: not-allowed var(--utility-important); }
.dn-cursor-none { cursor: none var(--utility-important); }

/* Resize utilities */
.dn-resize-none { resize: none var(--utility-important); }
.dn-resize { resize: both var(--utility-important); }
.dn-resize-y { resize: vertical var(--utility-important); }
.dn-resize-x { resize: horizontal var(--utility-important); }

/* ==================== ACCESSIBILITY UTILITIES ==================== */

/* Screen reader only utilities */
.dn-sr-only {
  position: absolute var(--utility-important);
  width: 1px var(--utility-important);
  height: 1px var(--utility-important);
  padding: 0 var(--utility-important);
  margin: -1px var(--utility-important);
  overflow: hidden var(--utility-important);
  clip: rect(0, 0, 0, 0) var(--utility-important);
  white-space: nowrap var(--utility-important);
  border: 0 var(--utility-important);
}

.dn-not-sr-only {
  position: static var(--utility-important);
  width: auto var(--utility-important);
  height: auto var(--utility-important);
  padding: 0 var(--utility-important);
  margin: 0 var(--utility-important);
  overflow: visible var(--utility-important);
  clip: auto var(--utility-important);
  white-space: normal var(--utility-important);
}

/* Focus utilities */
.dn-focus-not-outlined:focus {
  outline: 2px solid transparent var(--utility-important);
  outline-offset: 2px var(--utility-important);
}

.dn-focus-outline-none:focus {
  outline: 0 var(--utility-important);
}

/* ==================== RESPONSIVE UTILITIES ==================== */

/* Responsive breakpoint system */
@media (min-width: 640px) {
  .dn-sm-hidden { display: none var(--utility-important); }
  .dn-sm-block { display: block var(--utility-important); }
  .dn-sm-flex { display: flex var(--utility-important); }
  .dn-sm-grid { display: grid var(--utility-important); }
}

@media (min-width: 768px) {
  .dn-md-hidden { display: none var(--utility-important); }
  .dn-md-block { display: block var(--utility-important); }
  .dn-md-flex { display: flex var(--utility-important); }
  .dn-md-grid { display: grid var(--utility-important); }
}

@media (min-width: 1024px) {
  .dn-lg-hidden { display: none var(--utility-important); }
  .dn-lg-block { display: block var(--utility-important); }
  .dn-lg-flex { display: flex var(--utility-important); }
  .dn-lg-grid { display: grid var(--utility-important); }
}

@media (min-width: 1280px) {
  .dn-xl-hidden { display: none var(--utility-important); }
  .dn-xl-block { display: block var(--utility-important); }
  .dn-xl-flex { display: flex var(--utility-important); }
  .dn-xl-grid { display: grid var(--utility-important); }
}

/* ==================== PRINT UTILITIES ==================== */

@media print {
  .dn-print-hidden { display: none var(--utility-important); }
  .dn-print-block { display: block var(--utility-important); }
  .dn-print-inline { display: inline var(--utility-important); }
  .dn-print-inline-block { display: inline-block var(--utility-important); }
  
  .dn-print-black { color: black var(--utility-important); }
  .dn-print-white { background-color: white var(--utility-important); }
}

/* ==================== PERFORMANCE UTILITIES ==================== */

/* Containment utilities */
.dn-contain-none { contain: none var(--utility-important); }
.dn-contain-layout { contain: layout var(--utility-important); }
.dn-contain-paint { contain: paint var(--utility-important); }
.dn-contain-size { contain: size var(--utility-important); }
.dn-contain-content { contain: content var(--utility-important); }
.dn-contain-strict { contain: strict var(--utility-important); }

/* Will-change utilities */
.dn-will-change-auto { will-change: auto var(--utility-important); }
.dn-will-change-scroll { will-change: scroll-position var(--utility-important); }
.dn-will-change-contents { will-change: contents var(--utility-important); }
.dn-will-change-transform { will-change: transform var(--utility-important); }

/* ==================== DEBUG UTILITIES ==================== */

/* Development-only debug utilities */
.dn-debug:not([data-env="production"]) {
  outline: 2px dashed #ff4444 var(--utility-important);
  position: relative var(--utility-important);
}

.dn-debug::before {
  content: 'DEBUG' var(--utility-important);
  position: absolute var(--utility-important);
  top: -12px var(--utility-important);
  left: 0 var(--utility-important);
  background: #ff4444 var(--utility-important);
  color: white var(--utility-important);
  padding: 2px 4px var(--utility-important);
  font-size: 10px var(--utility-important);
  border-radius: 2px var(--utility-important);
  z-index: var(--z-tooltip) var(--utility-important);
}

/* Grid debug overlay */
.dn-debug-grid:not([data-env="production"]) {
  background-image: 
    linear-gradient(rgba(255, 0, 0, 0.1) 1px, transparent 1px),
    linear-gradient(90deg, rgba(255, 0, 0, 0.1) 1px, transparent 1px) var(--utility-important);
  background-size: 8px 8px var(--utility-important);
}

/* ==========================================================================
   End of Utility & Helper System
   ========================================================================== */
   
/* ==========================================================================
   Dark Nebula Theme - Theming & Customization System
   Version: 3.0.0
   ========================================================================== */

/* ==================== THEME SYSTEM ARCHITECTURE ==================== */

:root {
  /* === THEME METADATA === */
  --theme-version: '3.0.0';
  --theme-namespace: 'dn-theme';
  --theme-mode: 'auto'; /* auto | light | dark | system */
  
  /* === DYNAMIC THEME PROPERTIES === */
  --theme-hue: 265;
  --theme-saturation: 0.75;
  --theme-lightness: 0.65;
  --theme-contrast: 1.0;
  
  /* === THEME TRANSITION SETTINGS === */
  --theme-transition-duration: 0.5s;
  --theme-transition-easing: cubic-bezier(0.4, 0, 0.2, 1);
  
  /* === CUSTOMIZATION BOUNDARIES === */
  --min-hue: 0;
  --max-hue: 360;
  --min-saturation: 0.1;
  --max-saturation: 1.0;
  --min-lightness: 0.1;
  --max-lightness: 0.9;
  --min-contrast: 0.8;
  --max-contrast: 2.0;
}

/* ==================== DYNAMIC THEME PROPERTIES ==================== */

/* CSS Houdini properties for advanced theming */
@property --theme-primary {
  syntax: '<color>';
  inherits: true;
  initial-value: hsl(var(--theme-hue) calc(var(--theme-saturation) * 100%) calc(var(--theme-lightness) * 100%));
}

@property --theme-primary-dark {
  syntax: '<color>';
  inherits: true;
  initial-value: hsl(var(--theme-hue) calc(var(--theme-saturation) * 100%) calc(var(--theme-lightness) * 100% / 1.4));
}

@property --theme-primary-light {
  syntax: '<color>';
  inherits: true;
  initial-value: hsl(var(--theme-hue) calc(var(--theme-saturation) * 100%) calc(var(--theme-lightness) * 100% * 1.3));
}

@property --theme-secondary {
  syntax: '<color>';
  inherits: true;
  initial-value: hsl(calc(var(--theme-hue) + 60) calc(var(--theme-saturation) * 100%) calc(var(--theme-lightness) * 100%));
}

@property --theme-tertiary {
  syntax: '<color>';
  inherits: true;
  initial-value: hsl(calc(var(--theme-hue) + 120) calc(var(--theme-saturation) * 100%) calc(var(--theme-lightness) * 100%));
}

/* ==================== THEME MODE SYSTEM ==================== */

/* Auto theme detection */
@media (prefers-color-scheme: light) {
  :root:not([data-theme-mode]),
  [data-theme-mode="auto"] {
    --theme-mode: 'light';
    color-scheme: light;
  }
}

@media (prefers-color-scheme: dark) {
  :root:not([data-theme-mode]),
  [data-theme-mode="auto"] {
    --theme-mode: 'dark';
    color-scheme: dark;
  }
}

/* Manual theme modes */
[data-theme-mode="light"] {
  --theme-mode: 'light';
  color-scheme: light;
}

[data-theme-mode="dark"] {
  --theme-mode: 'dark';
  color-scheme: dark;
}

[data-theme-mode="system"] {
  --theme-mode: 'auto';
  color-scheme: light dark;
}

/* ==================== DARK THEME IMPLEMENTATION ==================== */

[data-theme-mode="dark"],
.theme-dark {
  /* === SEMANTIC COLOR MAPPING - DARK === */
  --color-primary: var(--theme-primary);
  --color-secondary: var(--theme-secondary);
  --color-tertiary: var(--theme-tertiary);
  
  /* === SURFACE COLORS - DARK === */
  --surface-base: oklch(15% 0.02 var(--theme-hue));
  --surface-primary: color-mix(in oklch, var(--surface-base) 95%, white 5%);
  --surface-secondary: color-mix(in oklch, var(--surface-base) 90%, white 10%);
  --surface-tertiary: color-mix(in oklch, var(--surface-base) 85%, white 15%);
  --surface-elevated: color-mix(in oklch, var(--surface-base) 80%, white 20%);
  --surface-accent: var(--theme-primary);
  
  /* === TEXT COLORS - DARK === */
  --text-primary: oklch(98% 0.01 var(--theme-hue));
  --text-secondary: oklch(75% 0.02 var(--theme-hue));
  --text-tertiary: oklch(55% 0.03 var(--theme-hue));
  --text-accent: var(--theme-primary);
  --text-inverse: oklch(15% 0.02 var(--theme-hue));
  --text-on-accent: oklch(98% 0.01 var(--theme-hue));
  
  /* === BORDER COLORS - DARK === */
  --border-primary: color-mix(in oklch, var(--surface-base) 60%, white 40% / 0.2);
  --border-secondary: color-mix(in oklch, var(--surface-base) 70%, white 30% / 0.15);
  --border-accent: var(--theme-primary);
  --border-focus: color-mix(in oklch, var(--theme-primary) 80%, white 20%);
  
  /* === SHADOW SYSTEM - DARK === */
  --shadow-color: 0 0% 0%;
  --shadow-strength: 0.25;
  
  /* === SCROLLBAR COLORS - DARK === */
  --scrollbar-thumb: color-mix(in oklch, var(--surface-base) 70%, white 30% / 0.4);
  --scrollbar-track: color-mix(in oklch, var(--surface-base) 95%, white 5% / 0.1);
}

/* ==================== LIGHT THEME IMPLEMENTATION ==================== */

[data-theme-mode="light"],
.theme-light {
  /* === SEMANTIC COLOR MAPPING - LIGHT === */
  --color-primary: var(--theme-primary-dark);
  --color-secondary: var(--theme-secondary);
  --color-tertiary: var(--theme-tertiary);
  
  /* === SURFACE COLORS - LIGHT === */
  --surface-base: oklch(98% 0.01 var(--theme-hue));
  --surface-primary: color-mix(in oklch, var(--surface-base) 95%, black 5%);
  --surface-secondary: color-mix(in oklch, var(--surface-base) 90%, black 10%);
  --surface-tertiary: color-mix(in oklch, var(--surface-base) 85%, black 15%);
  --surface-elevated: color-mix(in oklch, var(--surface-base) 80%, black 20%);
  --surface-accent: var(--theme-primary);
  
  /* === TEXT COLORS - LIGHT === */
  --text-primary: oklch(15% 0.05 var(--theme-hue));
  --text-secondary: oklch(35% 0.04 var(--theme-hue));
  --text-tertiary: oklch(55% 0.03 var(--theme-hue));
  --text-accent: var(--theme-primary-dark);
  --text-inverse: oklch(98% 0.01 var(--theme-hue));
  --text-on-accent: oklch(98% 0.01 var(--theme-hue));
  
  /* === BORDER COLORS - LIGHT === */
  --border-primary: color-mix(in oklch, var(--surface-base) 60%, black 40% / 0.15);
  --border-secondary: color-mix(in oklch, var(--surface-base) 70%, black 30% / 0.1);
  --border-accent: var(--theme-primary-dark);
  --border-focus: color-mix(in oklch, var(--theme-primary-dark) 80%, black 20%);
  
  /* === SHADOW SYSTEM - LIGHT === */
  --shadow-color: var(--theme-hue) 50% 30%;
  --shadow-strength: 0.08;
  
  /* === SCROLLBAR COLORS - LIGHT === */
  --scrollbar-thumb: color-mix(in oklch, var(--surface-base) 70%, black 30% / 0.3);
  --scrollbar-track: color-mix(in oklch, var(--surface-base) 95%, black 5% / 0.05);
}

/* ==================== HIGH CONTRAST THEME VARIANTS ==================== */

[data-contrast="high"] {
  --theme-contrast: 1.5;
  
  /* Enhanced contrast adjustments */
  --text-primary: oklch(100% 0 0);
  --text-secondary: oklch(85% 0 0);
  --text-tertiary: oklch(70% 0 0);
  
  --border-primary: oklch(60% 0 0);
  --border-secondary: oklch(50% 0 0);
  
  /* Force higher contrast ratios */
  --min-contrast-ratio: 7.0;
}

[data-theme-mode="light"][data-contrast="high"] {
  --text-primary: oklch(0% 0 0);
  --text-secondary: oklch(20% 0 0);
  --text-tertiary: oklch(40% 0 0);
  
  --border-primary: oklch(20% 0 0);
  --border-secondary: oklch(30% 0 0);
}

/* ==================== COLOR PRESET SYSTEM ==================== */

/* Neon Preset (Default) */
[data-color-preset="neon"] {
  --theme-hue: 265; /* Purple */
  --theme-saturation: 0.85;
  --theme-lightness: 0.65;
}

/* Ocean Preset */
[data-color-preset="ocean"] {
  --theme-hue: 200; /* Blue */
  --theme-saturation: 0.80;
  --theme-lightness: 0.60;
}

/* Forest Preset */
[data-color-preset="forest"] {
  --theme-hue: 145; /* Green */
  --theme-saturation: 0.75;
  --theme-lightness: 0.55;
}

/* Sunset Preset */
[data-color-preset="sunset"] {
  --theme-hue: 25; /* Orange */
  --theme-saturation: 0.90;
  --theme-lightness: 0.65;
}

/* Midnight Preset */
[data-color-preset="midnight"] {
  --theme-hue: 280; /* Deep Purple */
  --theme-saturation: 0.70;
  --theme-lightness: 0.50;
}

/* Monochrome Preset */
[data-color-preset="monochrome"] {
  --color-primary: oklch(50% 0 0);
  --color-secondary: oklch(40% 0 0);
  --color-tertiary: oklch(30% 0 0);
  
  --theme-primary: oklch(50% 0 0);
  --theme-secondary: oklch(40% 0 0);
  --theme-tertiary: oklch(30% 0 0);
}

/* ==================== DENSITY PRESET SYSTEM ==================== */

[data-density="compact"] {
  --space-xs: 0.25rem;
  --space-sm: 0.375rem;
  --space-md: 0.5rem;
  --space-lg: 0.75rem;
  --space-xl: 1rem;
  
  --text-base: 0.875rem;
  --text-sm: 0.75rem;
  --text-xs: 0.625rem;
  
  --radius-sm: 0.125rem;
  --radius-md: 0.25rem;
  --radius-lg: 0.375rem;
}

[data-density="comfortable"] {
  --space-xs: 0.625rem;
  --space-sm: 0.875rem;
  --space-md: 1.25rem;
  --space-lg: 1.75rem;
  --space-xl: 2.5rem;
  
  --text-base: 1.125rem;
  --text-lg: 1.375rem;
  --text-xl: 1.625rem;
  
  --radius-md: 0.5rem;
  --radius-lg: 0.75rem;
  --radius-xl: 1rem;
}

/* ==================== CUSTOMIZATION SYSTEM ==================== */

/* Custom color properties for user customization */
@property --custom-hue {
  syntax: '<number>';
  inherits: true;
  initial-value: 265;
}

@property --custom-saturation {
  syntax: '<number>';
  inherits: true;
  initial-value: 0.75;
}

@property --custom-lightness {
  syntax: '<number>';
  inherits: true;
  initial-value: 0.65;
}

/* Custom theme application */
[data-theme-custom="true"] {
  --theme-hue: var(--custom-hue, 265);
  --theme-saturation: var(--custom-saturation, 0.75);
  --theme-lightness: var(--custom-lightness, 0.65);
}

/* Custom theme boundaries */
.dn-theme-customizer {
  --custom-hue: clamp(var(--min-hue), var(--custom-hue), var(--max-hue));
  --custom-saturation: clamp(var(--min-saturation), var(--custom-saturation), var(--max-saturation));
  --custom-lightness: clamp(var(--min-lightness), var(--custom-lightness), var(--max-lightness));
  --custom-contrast: clamp(var(--min-contrast), var(--custom-contrast), var(--max-contrast));
}

/* ==================== THEME TRANSITION SYSTEM ==================== */

/* Smooth theme transitions */
.dn-theme-transition {
  transition-duration: var(--theme-transition-duration);
  transition-timing-function: var(--theme-transition-easing);
  transition-property: 
    color,
    background-color,
    border-color,
    box-shadow,
    text-shadow,
    fill,
    stroke;
}

/* Apply transitions to all theme-aware elements */
.dn-theme-transition,
.dn-theme-transition *,
.dn-theme-transition *::before,
.dn-theme-transition *::after {
  transition: inherit;
}

/* Reduced motion support for theme switching */
@media (prefers-reduced-motion: reduce) {
  .dn-theme-transition,
  .dn-theme-transition * {
    transition-duration: 0.01ms !important;
    transition-delay: 0.01ms !important;
  }
}

/* View Transitions API for theme switching */
@view-transition {
  navigation: auto;
}

::view-transition-old(root),
::view-transition-new(root) {
  animation-duration: var(--theme-transition-duration);
  animation-timing-function: var(--theme-transition-easing);
}

/* ==================== OBSIDIAN THEME INTEGRATION ==================== */

/* Map our theme system to Obsidian's CSS variables */
.theme-dark {
  --background-primary: var(--surface-primary);
  --background-primary-alt: var(--surface-secondary);
  --background-secondary: var(--surface-tertiary);
  --background-modifier-border: var(--border-primary);
  --background-modifier-border-hover: var(--border-secondary);
  --background-modifier-border-focus: var(--border-focus);
  --background-modifier-form-field: var(--surface-secondary);
  
  --text-normal: var(--text-primary);
  --text-muted: var(--text-secondary);
  --text-faint: var(--text-tertiary);
  --text-accent: var(--text-accent);
  --text-accent-hover: var(--color-secondary);
  --text-on-accent: var(--text-on-accent);
  
  --interactive-normal: var(--surface-secondary);
  --interactive-hover: var(--surface-tertiary);
  --interactive-accent: var(--color-primary);
  --interactive-accent-hover: var(--color-primary-dark);
  
  --scrollbar-bg: var(--scrollbar-track);
  --scrollbar-thumb-bg: var(--scrollbar-thumb);
  --scrollbar-active-thumb-bg: var(--color-primary);
}

.theme-light {
  --background-primary: var(--surface-primary);
  --background-primary-alt: var(--surface-secondary);
  --background-secondary: var(--surface-tertiary);
  --background-modifier-border: var(--border-primary);
  --background-modifier-border-hover: var(--border-secondary);
  --background-modifier-border-focus: var(--border-focus);
  --background-modifier-form-field: var(--surface-secondary);
  
  --text-normal: var(--text-primary);
  --text-muted: var(--text-secondary);
  --text-faint: var(--text-tertiary);
  --text-accent: var(--text-accent);
  --text-accent-hover: var(--color-secondary);
  --text-on-accent: var(--text-on-accent);
  
  --interactive-normal: var(--surface-secondary);
  --interactive-hover: var(--surface-tertiary);
  --interactive-accent: var(--color-primary);
  --interactive-accent-hover: var(--color-primary-dark);
  
  --scrollbar-bg: var(--scrollbar-track);
  --scrollbar-thumb-bg: var(--scrollbar-thumb);
  --scrollbar-active-thumb-bg: var(--color-primary);
}

/* ==================== SCROLLBAR THEMING ==================== */

/* Custom scrollbar styling */
.workspace ::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

.workspace ::-webkit-scrollbar-track {
  background: var(--scrollbar-track);
  border-radius: var(--radius-sm);
}

.workspace ::-webkit-scrollbar-thumb {
  background: var(--scrollbar-thumb);
  border-radius: var(--radius-sm);
  transition: background-color var(--duration-fast) var(--ease-out);
}

.workspace ::-webkit-scrollbar-thumb:hover {
  background: var(--color-primary);
}

.workspace ::-webkit-scrollbar-corner {
  background: var(--surface-primary);
}

/* Firefox scrollbar theming */
@-moz-document url-prefix() {
  .workspace {
    scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);
    scrollbar-width: thin;
  }
}

/* ==================== BROWSER-SPECIFIC THEME FIXES ==================== */

/* Safari color space fixes */
@supports (background: oklch(0% 0 0)) {
  [data-theme-mode="dark"] {
    --surface-base: oklch(15% 0.02 var(--theme-hue));
    --text-primary: oklch(98% 0.01 var(--theme-hue));
  }
  
  [data-theme-mode="light"] {
    --surface-base: oklch(98% 0.01 var(--theme-hue));
    --text-primary: oklch(15% 0.05 var(--theme-hue));
  }
}

/* Firefox color-mix fallback */
@-moz-document url-prefix() {
  [data-theme-mode="dark"] {
    --surface-primary: color-mix(in srgb, var(--surface-base) 95%, white 5%);
  }
  
  [data-theme-mode="light"] {
    --surface-primary: color-mix(in srgb, var(--surface-base) 95%, black 5%);
  }
}

/* High contrast mode for Windows */
@media (forced-colors: active) {
  [data-theme-mode="dark"] {
    --text-primary: CanvasText;
    --surface-primary: Canvas;
    --border-primary: ButtonBorder;
  }
  
  [data-theme-mode="light"] {
    --text-primary: CanvasText;
    --surface-primary: Canvas;
    --border-primary: ButtonBorder;
  }
}

/* ==================== THEME VALIDATION SYSTEM ==================== */

/* Theme validation and fallbacks */
.dn-theme-validator {
  /* Check if custom properties are supported */
  background: linear-gradient(
    45deg,
    oklch(from var(--color-primary) l c h),
    oklch(from var(--color-secondary) l c h),
    oklch(from var(--color-tertiary) l c h)
  );
}

@supports not (background: oklch(0% 0 0)) {
  .dn-theme-validator {
    background: linear-gradient(
      45deg,
      var(--color-primary),
      var(--color-secondary),
      var(--color-tertiary)
    );
  }
}

/* Theme contrast validation */
.dn-contrast-check {
  position: relative;
}

.dn-contrast-check::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(
    45deg,
    transparent 0%,
    rgba(255, 255, 255, 0.1) 50%,
    transparent 100%
  );
  pointer-events: none;
  opacity: 0;
  transition: opacity var(--duration-fast) var(--ease-out);
}

.dn-contrast-check:hover::after {
  opacity: 1;
}

/* ==================== THEME EXPORT/IMPORT SYSTEM ==================== */

/* Theme data attribute for serialization */
[data-theme-export] {
  --export-hue: var(--theme-hue);
  --export-saturation: var(--theme-saturation);
  --export-lightness: var(--theme-lightness);
  --export-contrast: var(--theme-contrast);
  --export-mode: var(--theme-mode);
}

/* Theme import preview */
.dn-theme-import-preview {
  background: 
    linear-gradient(135deg, var(--surface-primary) 0%, var(--surface-secondary) 100%),
    radial-gradient(circle at top right, var(--color-primary) 0%, transparent 50%),
    radial-gradient(circle at bottom left, var(--color-secondary) 0%, transparent 50%);
  border: 2px solid var(--border-primary);
  border-radius: var(--radius-lg);
  padding: var(--space-lg);
  position: relative;
  overflow: hidden;
}

.dn-theme-import-preview::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(
    45deg,
    transparent 0%,
    rgba(255, 255, 255, 0.05) 50%,
    transparent 100%
  );
  pointer-events: none;
}

/* ==================== PERFORMANCE OPTIMIZATIONS ==================== */

/* GPU acceleration for theme transitions */
.dn-theme-transition {
  transform: translateZ(0);
  backface-visibility: hidden;
  perspective: 1000px;
}

/* Containment for theme-aware components */
.dn-theme-aware {
  contain: style layout;
  will-change: contents;
}

/* ==================== DEBUG UTILITIES ==================== */

/* Theme debug panel */
.dn-theme-debug:not([data-env="production"]) {
  position: fixed;
  bottom: 20px;
  left: 20px;
  background: var(--surface-primary);
  border: 1px solid var(--border-accent);
  border-radius: var(--radius-md);
  padding: var(--space-md);
  font-family: var(--font-mono);
  font-size: var(--text-xs);
  z-index: var(--z-tooltip);
  box-shadow: var(--shadow-lg);
}

.dn-theme-debug-item {
  display: flex;
  justify-content: space-between;
  gap: var(--space-sm);
  padding: var(--space-xs) 0;
  border-bottom: 1px solid var(--border-secondary);
}

.dn-theme-debug-item:last-child {
  border-bottom: none;
}

/* Color palette preview */
.dn-theme-palette {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: var(--space-xs);
  margin: var(--space-md) 0;
}

.dn-theme-swatch {
  aspect-ratio: 1;
  border-radius: var(--radius-sm);
  border: 1px solid var(--border-primary);
  position: relative;
  overflow: hidden;
}

.dn-theme-swatch::before {
  content: attr(data-name);
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  background: var(--surface-primary);
  color: var(--text-primary);
  padding: 2px;
  font-size: 0.5rem;
  text-align: center;
}

/* ==========================================================================
   End of Theming & Customization System
   ========================================================================== */
   
/* ==========================================================================
   Dark Nebula Theme - Plugin Integration System
   Version: 3.0.0
   ========================================================================== */

/* ==================== PLUGIN INTEGRATION ARCHITECTURE ==================== */

:root {
  /* === PLUGIN DETECTION VARIABLES === */
  --plugin-calendar-enabled: false;
  --plugin-kanban-enabled: false;
  --plugin-dataview-enabled: false;
  --plugin-templater-enabled: false;
  --plugin-excalidraw-enabled: false;
  --plugin-slides-enabled: false;
  
  /* === PLUGIN SPECIFIC OVERRIDES === */
  --plugin-z-index-base: 100;
  --plugin-transition-duration: var(--duration-normal);
}

/* ==================== CALENDAR PLUGIN INTEGRATION ==================== */

/* Calendar plugin detection and styling */
[data-type="calendar"] {
  --plugin-calendar-enabled: true;
}

/* Calendar container */
.calendar {
  background: var(--surface-primary);
  border-radius: var(--radius-lg);
  border: 1px solid var(--border-primary);
  font-family: var(--font-sans);
}

/* Calendar header */
.calendar .nav {
  background: var(--surface-secondary);
  border-bottom: 1px solid var(--border-primary);
  padding: var(--space-md);
  border-radius: var(--radius-lg) var(--radius-lg) 0 0;
}

.calendar .nav .title {
  color: var(--text-primary);
  font-weight: var(--font-semibold);
  font-size: var(--text-lg);
}

/* Calendar grid */
.calendar .day {
  background: var(--surface-primary);
  border: 1px solid var(--border-secondary);
  color: var(--text-primary);
  transition: all var(--duration-fast) var(--ease-out);
  position: relative;
}

.calendar .day:hover {
  background: var(--surface-secondary);
  border-color: var(--border-accent);
  transform: translateY(-1px);
  z-index: 1;
}

.calendar .day.other-month {
  color: var(--text-tertiary);
  background: var(--surface-tertiary);
  opacity: 0.6;
}

.calendar .day.today {
  background: var(--color-primary-ghost);
  border-color: var(--color-primary);
  color: var(--text-accent);
  font-weight: var(--font-semibold);
}

.calendar .day.has-note::after {
  content: '';
  position: absolute;
  bottom: 2px;
  left: 50%;
  transform: translateX(-50%);
  width: 4px;
  height: 4px;
  background: var(--color-primary);
  border-radius: 50%;
}

/* Calendar events */
.calendar .event {
  background: var(--color-primary-ghost);
  border: 1px solid var(--color-primary);
  color: var(--text-accent);
  border-radius: var(--radius-sm);
  padding: var(--space-2xs) var(--space-xs);
  margin: 1px 0;
  font-size: var(--text-xs);
  line-height: var(--leading-tight);
}

.calendar .event.all-day {
  background: var(--color-secondary-ghost);
  border-color: var(--color-secondary);
}

/* ==================== KANBAN PLUGIN INTEGRATION ==================== */

/* Kanban plugin detection */
.kanban-plugin {
  --plugin-kanban-enabled: true;
}

/* Kanban board container */
.kanban-plugin__board {
  background: var(--surface-primary);
  padding: var(--space-md);
  gap: var(--space-md);
  min-height: 400px;
}

/* Kanban lanes/columns */
.kanban-plugin__lane {
  background: var(--surface-secondary);
  border: 1px solid var(--border-primary);
  border-radius: var(--radius-lg);
  padding: var(--space-md);
  min-width: 280px;
  transition: all var(--duration-normal) var(--ease-out);
}

.kanban-plugin__lane:hover {
  border-color: var(--border-accent);
  box-shadow: var(--shadow-md);
}

.kanban-plugin__lane-header {
  background: var(--surface-tertiary);
  border-bottom: 1px solid var(--border-primary);
  padding: var(--space-sm) var(--space-md);
  margin: calc(-1 * var(--space-md)) calc(-1 * var(--space-md)) var(--space-md);
  border-radius: var(--radius-lg) var(--radius-lg) 0 0;
}

.kanban-plugin__lane-title {
  color: var(--text-primary);
  font-weight: var(--font-semibold);
  font-size: var(--text-base);
}

/* Kanban cards */
.kanban-plugin__item {
  background: var(--surface-primary);
  border: 1px solid var(--border-secondary);
  border-radius: var(--radius-md);
  padding: var(--space-sm);
  margin-bottom: var(--space-sm);
  box-shadow: var(--shadow-sm);
  transition: all var(--duration-fast) var(--ease-out);
  position: relative;
}

.kanban-plugin__item:hover {
  border-color: var(--border-accent);
  box-shadow: var(--shadow-md);
  transform: translateY(-1px);
}

.kanban-plugin__item-content {
  color: var(--text-primary);
  font-size: var(--text-sm);
  line-height: var(--leading-normal);
}

.kanban-plugin__item-metadata {
  color: var(--text-tertiary);
  font-size: var(--text-xs);
  margin-top: var(--space-xs);
}

/* Kanban drag and drop states */
.kanban-plugin__lane.drag-over {
  background: var(--color-primary-ghost);
  border-color: var(--color-primary);
  border-style: dashed;
}

.kanban-plugin__item.is-dragging {
  opacity: 0.8;
  transform: rotate(2deg);
  box-shadow: var(--shadow-lg);
}

/* ==================== DATAVIEW PLUGIN INTEGRATION ==================== */

/* Dataview plugin detection */
.dataview {
  --plugin-dataview-enabled: true;
}

/* Dataview tables */
.table-view-table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  background: var(--surface-primary);
  border-radius: var(--radius-lg);
  border: 1px solid var(--border-primary);
  overflow: hidden;
}

.table-view-table > thead > tr > th {
  background: var(--surface-secondary);
  color: var(--text-primary);
  font-weight: var(--font-semibold);
  padding: var(--space-sm) var(--space-md);
  border-bottom: 1px solid var(--border-primary);
  text-align: left;
  font-size: var(--text-sm);
}

.table-view-table > tbody > tr > td {
  padding: var(--space-sm) var(--space-md);
  border-bottom: 1px solid var(--border-secondary);
  color: var(--text-primary);
  font-size: var(--text-sm);
  line-height: var(--leading-normal);
}

.table-view-table > tbody > tr:last-child > td {
  border-bottom: none;
}

.table-view-table > tbody > tr:hover {
  background: var(--surface-secondary);
}

/* Dataview lists */
.dataview.list-view-ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.dataview.list-view-li {
  background: var(--surface-primary);
  border: 1px solid var(--border-secondary);
  border-radius: var(--radius-md);
  padding: var(--space-sm) var(--space-md);
  margin-bottom: var(--space-sm);
  transition: all var(--duration-fast) var(--ease-out);
}

.dataview.list-view-li:hover {
  border-color: var(--border-accent);
  background: var(--surface-secondary);
  transform: translateX(4px);
}

.dataview.list-view-li .list-view-title {
  color: var(--text-primary);
  font-weight: var(--font-medium);
  font-size: var(--text-base);
}

.dataview.list-view-li .list-view-note {
  color: var(--text-secondary);
  font-size: var(--text-sm);
  margin-top: var(--space-xs);
}

/* Dataview inline queries */
.dataview.inline-field {
  background: var(--surface-secondary);
  border: 1px solid var(--border-primary);
  border-radius: var(--radius-sm);
  padding: 1px 4px;
  font-family: var(--font-mono);
  font-size: 0.875em;
  color: var(--text-accent);
}

/* ==================== TEMPLATER PLUGIN INTEGRATION ==================== */

/* Templater plugin detection */
.templater-command,
.templater-script {
  --plugin-templater-enabled: true;
}

/* Templater command blocks */
.templater-command {
  background: var(--surface-tertiary);
  border: 1px solid var(--border-primary);
  border-radius: var(--radius-md);
  padding: var(--space-sm);
  margin: var(--space-md) 0;
  font-family: var(--font-mono);
  font-size: var(--text-sm);
  position: relative;
}

.templater-command::before {
  content: '📋 Templater';
  position: absolute;
  top: -10px;
  left: var(--space-sm);
  background: var(--surface-primary);
  color: var(--text-accent);
  padding: 2px 6px;
  font-size: var(--text-xs);
  font-weight: var(--font-bold);
  border-radius: var(--radius-sm);
  border: 1px solid var(--border-primary);
}

.templater-command .templater-divider {
  border-color: var(--border-primary);
  margin: var(--space-sm) 0;
}

/* Templater script buttons */
.templater-script {
  background: var(--color-primary);
  color: var(--text-on-accent);
  border: none;
  border-radius: var(--radius-md);
  padding: var(--space-xs) var(--space-sm);
  font-size: var(--text-sm);
  font-weight: var(--font-medium);
  cursor: pointer;
  transition: all var(--duration-fast) var(--ease-out);
}

.templater-script:hover {
  background: var(--color-primary-dark);
  transform: translateY(-1px);
  box-shadow: var(--shadow-sm);
}

/* ==================== EXCALIDRAW PLUGIN INTEGRATION ==================== */

/* Excalidraw plugin detection */
.excalidraw-plugin {
  --plugin-excalidraw-enabled: true;
}

/* Excalidraw canvas container */
.excalidraw-wrapper {
  background: var(--surface-primary);
  border: 1px solid var(--border-primary);
  border-radius: var(--radius-lg);
  overflow: hidden;
}

.excalidraw-wrapper .excalidraw {
  background: var(--surface-primary) !important;
}

/* Excalidraw toolbar */
.excalidraw .ToolIcon {
  background: var(--surface-secondary) !important;
  border: 1px solid var(--border-primary) !important;
  color: var(--text-primary) !important;
}

.excalidraw .ToolIcon:hover {
  background: var(--surface-tertiary) !important;
  border-color: var(--border-accent) !important;
}

.excalidraw .ToolIcon__icon {
  color: var(--text-primary) !important;
}

/* Excalidraw context menu */
.excalidraw .context-menu {
  background: var(--surface-primary) !important;
  border: 1px solid var(--border-primary) !important;
  border-radius: var(--radius-md) !important;
  box-shadow: var(--shadow-lg) !important;
}

.excalidraw .context-menu li {
  color: var(--text-primary) !important;
}

.excalidraw .context-menu li:hover {
  background: var(--surface-secondary) !important;
  color: var(--text-accent) !important;
}

/* ==================== SLIDES PLUGIN INTEGRATION ==================== */

/* Slides plugin detection */
.reveal {
  --plugin-slides-enabled: true;
}

/* Slides container */
.reveal .slides {
  background: var(--surface-primary);
  color: var(--text-primary);
}

.reveal .slides section {
  background: var(--surface-primary);
  border-radius: var(--radius-lg);
  padding: var(--space-xl);
}

/* Slide headings */
.reveal .slides h1,
.reveal .slides h2,
.reveal .slides h3,
.reveal .slides h4,
.reveal .slides h5,
.reveal .slides h6 {
  color: var(--text-primary);
  border-bottom: none;
}

.reveal .slides h1 {
  color: var(--text-accent);
  font-size: var(--text-3xl);
}

/* Slide content */
.reveal .slides p,
.reveal .slides li {
  color: var(--text-primary);
  font-size: var(--text-lg);
  line-height: var(--leading-relaxed);
}

.reveal .slides code {
  background: var(--surface-secondary);
  color: var(--text-primary);
  border-radius: var(--radius-sm);
  padding: 2px 4px;
}

.reveal .slides pre {
  background: var(--surface-tertiary);
  border: 1px solid var(--border-primary);
  border-radius: var(--radius-md);
  padding: var(--space-md);
}

/* Slide controls */
.reveal .controls {
  color: var(--color-primary) !important;
}

.reveal .progress {
  background: var(--surface-secondary) !important;
  color: var(--color-primary) !important;
}

/* ==================== COMMUNITY PLUGIN COMMON PATTERNS ==================== */

/* Modal dialogs for various plugins */
.plugin-modal {
  background: var(--surface-primary) !important;
  border: 1px solid var(--border-primary) !important;
  border-radius: var(--radius-lg) !important;
  box-shadow: var(--shadow-xl) !important;
  backdrop-filter: blur(20px) !important;
}

.plugin-modal .modal-header {
  background: var(--surface-secondary) !important;
  border-bottom: 1px solid var(--border-primary) !important;
  border-radius: var(--radius-lg) var(--radius-lg) 0 0 !important;
  padding: var(--space-md) !important;
}

.plugin-modal .modal-title {
  color: var(--text-primary) !important;
  font-weight: var(--font-semibold) !important;
  font-size: var(--text-lg) !important;
}

.plugin-modal .modal-content {
  background: var(--surface-primary) !important;
  color: var(--text-primary) !important;
  padding: var(--space-md) !important;
}

/* Settings tabs for plugins */
.plugin-settings .setting-item {
  border-bottom: 1px solid var(--border-secondary) !important;
  padding: var(--space-md) 0 !important;
}

.plugin-settings .setting-item:last-child {
  border-bottom: none !important;
}

.plugin-settings .setting-item-name {
  color: var(--text-primary) !important;
  font-weight: var(--font-medium) !important;
}

.plugin-settings .setting-item-description {
  color: var(--text-secondary) !important;
  font-size: var(--text-sm) !important;
}

/* Button styles for plugins */
.plugin-button {
  background: var(--color-primary) !important;
  color: var(--text-on-accent) !important;
  border: none !important;
  border-radius: var(--radius-md) !important;
  padding: var(--space-xs) var(--space-sm) !important;
  font-size: var(--text-sm) !important;
  font-weight: var(--font-medium) !important;
  cursor: pointer !important;
  transition: all var(--duration-fast) var(--ease-out) !important;
}

.plugin-button:hover {
  background: var(--color-primary-dark) !important;
  transform: translateY(-1px) !important;
  box-shadow: var(--shadow-sm) !important;
}

.plugin-button-secondary {
  background: var(--surface-secondary) !important;
  color: var(--text-primary) !important;
  border: 1px solid var(--border-primary) !important;
}

.plugin-button-secondary:hover {
  background: var(--surface-tertiary) !important;
  border-color: var(--border-accent) !important;
}

/* ==================== PLUGIN PERFORMANCE OPTIMIZATIONS ==================== */

/* Containment for plugin containers */
.kanban-plugin__board,
.calendar,
.dataview,
.excalidraw-wrapper,
.reveal .slides {
  contain: layout style;
  will-change: transform;
}

/* GPU acceleration for plugin animations */
.kanban-plugin__item,
.calendar .day,
.dataview.list-view-li {
  transform: translateZ(0);
  backface-visibility: hidden;
}

/* Reduced motion for plugin interactions */
@media (prefers-reduced-motion: reduce) {
  .kanban-plugin__item,
  .calendar .day,
  .dataview.list-view-li,
  .plugin-button {
    transition: none !important;
    transform: none !important;
  }
}

/* ==================== PLUGIN ACCESSIBILITY ==================== */

/* High contrast mode for plugins */
@media (forced-colors: active) {
  .calendar .day,
  .kanban-plugin__lane,
  .kanban-plugin__item,
  .table-view-table > thead > tr > th,
  .dataview.list-view-li {
    border: 1px solid ButtonBorder !important;
  }
  
  .calendar .day.today,
  .kanban-plugin__item.is-dragging {
    border: 2px solid Highlight !important;
  }
}

/* Focus styles for plugin interactive elements */
.plugin-button:focus-visible,
.kanban-plugin__item:focus-visible,
.calendar .day:focus-visible {
  outline: 2px solid var(--border-focus) !important;
  outline-offset: 2px !important;
}

/* Screen reader support for plugin content */
.plugin-sr-only {
  position: absolute !important;
  width: 1px !important;
  height: 1px !important;
  padding: 0 !important;
  margin: -1px !important;
  overflow: hidden !important;
  clip: rect(0, 0, 0, 0) !important;
  white-space: nowrap !important;
  border: 0 !important;
}

/* ==================== PLUGIN CONFLICT RESOLUTION ==================== */

/* Specificity management for plugin overrides */
.workspace-leaf-content[data-type="kanban"] .kanban-plugin {
  /* Ensure Kanban styles take precedence */
  z-index: var(--plugin-z-index-base);
}

.workspace-leaf-content[data-type="calendar"] .calendar {
  /* Ensure Calendar styles take precedence */
  z-index: var(--plugin-z-index-base);
}

/* Important flag management */
.dn-plugin-override {
  /* Use CSS variables to manage !important flags */
  --plugin-important: !important;
}

/* Namespacing to prevent conflicts */
.dn-plugin-calendar .calendar,
.dn-plugin-kanban .kanban-plugin,
.dn-plugin-dataview .dataview {
  /* Namespaced plugin containers */
  isolation: isolate;
}

/* ==================== PLUGIN DEBUG UTILITIES ==================== */

/* Plugin detection debug panel */
.dn-plugin-debug:not([data-env="production"]) {
  position: fixed;
  top: 20px;
  right: 20px;
  background: var(--surface-primary);
  border: 1px solid var(--border-accent);
  border-radius: var(--radius-md);
  padding: var(--space-md);
  font-family: var(--font-mono);
  font-size: var(--text-xs);
  z-index: calc(var(--z-tooltip) + 1000);
  box-shadow: var(--shadow-lg);
}

.dn-plugin-debug-item {
  display: flex;
  justify-content: space-between;
  gap: var(--space-sm);
  padding: var(--space-xs) 0;
  border-bottom: 1px solid var(--border-secondary);
}

.dn-plugin-debug-item:last-child {
  border-bottom: none;
}

.dn-plugin-enabled {
  color: var(--color-success);
  font-weight: var(--font-bold);
}

.dn-plugin-disabled {
  color: var(--text-tertiary);
}

/* Plugin conflict detection */
.dn-plugin-conflict-warning {
  background: var(--color-warning-ghost);
  border: 1px solid var(--color-warning);
  border-radius: var(--radius-md);
  padding: var(--space-sm);
  margin: var(--space-sm) 0;
  font-size: var(--text-sm);
}

.dn-plugin-conflict-warning::before {
  content: '⚠️ PLUGIN CONFLICT';
  font-weight: var(--font-bold);
  color: var(--color-warning);
  display: block;
  margin-bottom: var(--space-xs);
}

/* ==================== PLUGIN FALLBACK SYSTEM ==================== */

/* Fallback styles for missing plugin detection */
.dn-plugin-fallback {
  /* Basic styling for undetected plugins */
  background: var(--surface-primary);
  border: 1px solid var(--border-primary);
  border-radius: var(--radius-md);
  padding: var(--space-md);
}

.dn-plugin-fallback .plugin-content {
  color: var(--text-primary);
  font-family: var(--font-sans);
}

/* Graceful degradation for plugin CSS loading */
.dn-plugin-loading {
  position: relative;
  min-height: 100px;
  background: var(--surface-secondary);
  border-radius: var(--radius-md);
  display: flex;
  align-items: center;
  justify-content: center;
}

.dn-plugin-loading::after {
  content: '🔄 Loading Plugin...';
  color: var(--text-tertiary);
  font-size: var(--text-sm);
}

/* ==========================================================================
   End of Plugin Integration System
   ========================================================================== */
   

